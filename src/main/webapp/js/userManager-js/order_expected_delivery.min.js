ec.pkg("ec.order");ec.load("ec.box");ec.load("ec.dh");ec.load("ec.aes");ec.load("ec.rc4");var selectAddrId="";var _defaultTimeOut=1e4;ec.order.selectAddress=function(id,district){if(ec.order.isSupportDisTime=="0"){return}var orderType=$("#orderType").val();if(orderType==18){return}ec.order.processSupportDisplayDilieryTime()};ec.order.processSupportDisplayDilieryTime=function(){if($(".order-main").find("ul").eq(0).find("a").eq(0).text().trim().substring(0,2)=="套餐"){ec.order.hiddenTips();return}if(ec.order.shippingDate!=""&&ec.order.shippingDate!=undefined){$("#order_confirm_tipsMsg").html(ec.order.shippingDate);$("#order_confirm_tips").html("<b>订单按照支付顺序发货，预计发货时间在支付全部完成前可能变更；预计发货时间根据商品库存信息计算得出，受诸多因素影响可能会产生偏差，我们会为您积极备货。</b>");ec.order.showTips();return}if(ec.order.isSupportDisTime=="0"){return}ec.order.hiddenTips();ec.order.processExpectDelivery()};ec.order.processExpectDelivery=function(){if(ec.order.shopCode!=ec.order.productSeCode||ec.order.isAllPrdVirtual=="true"){return}if(ec.order.shippingDate!=""&&ec.order.shippingDate!=undefined){$("#order_confirm_tipsMsg").html(ec.order.shippingDate);$("#order_confirm_tips").html("<b>订单按照支付顺序发货，预计发货时间在支付全部完成前可能变更；预计发货时间根据商品库存信息计算得出，受诸多因素影响可能会产生偏差，我们会为您积极备货。</b>");ec.order.showTips();return}selectAddrId=$("#order-address-list li.current input[name='myAddress']").attr("data-district");if(selectAddrId==""){return}var titleType=$("#order-titleTypeVMALL-HUAWEIDEVICE").val();if(titleType==null||titleType==""){titleType="1"}var amount=$("#order-price-VMALL-HUAWEIDEVICE").html();if(amount==null){amount=""}var imgUrlsClassList=$(".skuCodeQuanClass");var skuCodeList="";var countTemp="";for(var i=0;i<imgUrlsClassList.length;i++){if(i!=imgUrlsClassList.length-1){skuCodeList+=imgUrlsClassList[i].id+",";countTemp+=imgUrlsClassList[i].value+","}else{skuCodeList+=imgUrlsClassList[i].id;countTemp+=imgUrlsClassList[i].value}}ec.prescription.getEstimateGetOrderTime2(ec.order.showSupportDisplayDilieryTime,selectAddrId,amount,titleType,skuCodeList,countTemp)};ec.order.showSupportDisplayDilieryTimeTemp=function(deadlineTime,earlyArrivalTime,lateArrivalTime,beforeAndAfterFlag,isException){var tips="";if(!isException){var timeTemp="";var toDate="";if(beforeAndAfterFlag=="1"){timeTemp=earlyArrivalTime;toDate="今天"}else{timeTemp=lateArrivalTime;toDate="明天"}var effectivenessTimeAndWeek=ec.order.getEffectivenessTime(timeTemp,deadlineTime);tips=toDate+deadlineTime+"前付款，"+"预计"+effectivenessTimeAndWeek+"送达"}$("#order_confirm_tipsMsg").html(tips);if(null!=deadlineTime&&deadlineTime!=""){ec.order.showTips()}else{ec.order.hiddenTips()}if(isException){$("#order_confirm_tips").hide()}};ec.order.showSupportDisplayDilieryTime=function(json,isException){var tips="";if(!isException){if(json.info){var deadlineTime=json.info.deadlineTime;var timeTemp="";var toDate="";if(json.beforeAndAfterFlag=="1"){timeTemp=json.info.earlyArrivalTime;toDate="今天"}else{timeTemp=json.info.lateArrivalTime;toDate="明天"}var effectivenessTimeAndWeek=ec.order.getEffectivenessTime(timeTemp,deadlineTime);tips=toDate+deadlineTime+"前付款，"+"预计"+effectivenessTimeAndWeek+"送达"}}$("#order_confirm_tipsMsg").html(tips);if(null!=json.info&&json.info!=""){ec.order.showTips()}else{ec.order.hiddenTips()}if(isException){$("#order_confirm_tips").hide()}};ec.order.newCount=function(){var totalPrice=0;var orderType=$("#orderType").val();if(orderType==18&&ec.order.balancePrice!=0){totalPrice=((ec.order.totalOriginalPrice||0)+(ec.order.deliveryCharge||0)-(ec.order.couponDiscount||0)-(ec.order.depositAmount||0)-(ec.order.depositDiscount||0)-(ec.order.petalAmount||0)-(ec.order.pointAmount||0)).toFixed(2);$("#balanceAmountIDD").html(totalPrice)}else{ec.order.totalPrice=(ec.order.totalOriginalPrice+(ec.order.deliveryCharge||0)-(ec.order.discountTotalPrice||0)-(ec.order.couponDiscount||0)-(ec.order.petalAmount||0)-(ec.order.pointAmount||0)).toFixed(2);var proxyCouponDeduct=0;$("input[id^='coupon-first-']").each(function(){if($(this).val()!=undefined&&$(this).val()!=""){var couponInfo=$(this).val().split("|");proxyCouponDeduct=proxyCouponDeduct+parseFloat(couponInfo[3])}});totalPrice=((ec.order.allTotalOriginalPrice||0)+(ec.order.deliveryCharge||0)-(ec.order.allTotalDiscountPrice||0)-(ec.order.couponDiscount||0)-(ec.order.petalAmount||0)-(ec.order.pointAmount||0)-proxyCouponDeduct).toFixed(2)}if(ec.order.totalPrice<0){ec.order.totalPrice=0}$("#order-price-VMALL-HUAWEIDEVICE").html(ec.order.totalPrice).attr("data-oldval",ec.order.totalPrice);if(totalPrice<0){totalPrice=0}$("#payableTotal").html(totalPrice)};ec.order.hiddenTips=function(){$("#order_confirm_tipsMsg").hide();$("#order_confirm_sp_tips").hide();$("#order_confirm_tips").hide()};ec.order.showTips=function(){$("#order_confirm_tipsMsg").show();$("#order_confirm_sp_tips").show();$("#order_confirm_tips").css("display","inline-block")};ec.order.getEffectivenessTime=function(effectivenessTime,deadlineTime){var effectivenessTimeAndWeek;var _now=ec.order.getSysDate();var nowHours=_now.getHours();var date=_now.getTime();var newEffectiveTime=new Date;newEffectiveTime.setTime(date);deadlineTime=deadlineTime.substring(0,2);if(nowHours>=0&&nowHours<deadlineTime){newEffectiveTime.setHours(parseInt(deadlineTime)+parseInt(effectivenessTime))}else{newEffectiveTime.setHours(parseInt(deadlineTime)+parseInt(effectivenessTime))}var result=parseInt(newEffectiveTime.getMonth())+1+"月"+newEffectiveTime.getDate()+"日（"+ec.order.getWeekByTime(newEffectiveTime)+"）";return result};ec.order.getWeekByTime=function(effectivenessTime){var day=effectivenessTime.getDay();var week="";switch(day){case 0:week="周日";break;case 1:week="周一";break;case 2:week="周二";break;case 3:week="周三";break;case 4:week="周四";break;case 5:week="周五";break;case 6:week="周六";break}var now=new Date;var dateTemp=now.diff(effectivenessTime);if(dateTemp==0){week="今天"}if(dateTemp==1){week="明天"}return week};Date.prototype.diff=function(date){return Math.floor((date.getTime()-new Date((new Date).setHours(0,0,0,0)).getTime())/(24*60*60*1e3))};ec.order.getSysDate=function(){var now=new Date;(new ec.ajax).get({async:false,url:"/system/getSysDate.json?"+(new Date).getTime(),timeout:_defaultTimeOut,successFunction:function(json){if(!ec.util.isEmpty(json.now)){now.setTime(json.now.parseDate("yyyy-MM-dd HH:mm:ss"))}}});return now};