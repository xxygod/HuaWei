ec.load("ajax");ec.load("ec.linkSelect.region");ec.pkg("ec.order.invoice");ec.order.invoice.optValidateCompany=function(a){return a.replace(/(^\s*)|(\s*$)/g,"").replace(/\uff08/g,"(").replace(/\uff09/g,")")};ec.order.invoice.optCompany=function(a){return a.replace(/(^\s*)|(\s*$)/g,"")};$.extend(ec.form.validator.defaults,{errorClass:"error",autoFocus:false,errorFunction:function(c,a){var b="report-errors",d=a.msg[a.type]||a.msg["default"];d=(d.length<=0)?"&nbsp;":d;switch(a.type){case"require":b="report-errors";break;case"invoiceCompany":if(""!=d){if(d.indexOf("$name")!=-1){var f=/\$name/gi;d=d.replace(f,c.val())}}break}d=$("<div/>").text(d).html();if(a.msg_ct){$(a.msg_ct).addClass("report-errors").html(ec.encodeForHTML(d))}else{var e=(c.attr("id")||c.attr("name"))+"-msg";$("#"+e).remove();c.after("<div id='"+e+"' class='report-errors "+b+"'>"+ec.encodeForHTML(d)+"</div>")}if(a.autoFocus){c.focus()}},successFunction:function(b,a){if(!$(a.msg_ct).hasClass("filter")){if(a.msg_ct){$(a.msg_ct).html("").removeClass("label-error")}else{$("#"+(b.attr("id")||b.attr("name"))+"-msg").remove()}}}});ec.form.validator.register("invoiceCompany",function(d){d=ec.order.invoice.optValidateCompany(d);var c=$("input[id^=invoiceLimitCorp-]").length;var a=$("#invoiceCorpMsg").val();for(var b=0;b<c;b++){if(d===$("#invoiceLimitCorp-"+b).val()){return false}}return true});ec.form.validator.register("lengthOfChar",function(c,a){if(a.allowEmpty){return true}if(!(a.min||a.max)){h("length","need parameter of 'min' or 'max'!");return false}var b=c.replace(/[^\x00-\xff]/g,"rr").len();if(a.min&&b<a.min){return false}if(a.max&&b>a.max){return false}return true});var invoiceFlag=true;$("#vatInvoice-companyName").live("compositionstart",function(){invoiceFlag=false});$("#vatInvoice-companyName").live("compositionend",function(){invoiceFlag=true});var invoiceXhr;ec.order.invoice.autoFillForm=function(){$(".invoice-new-company").remove();clearTimeout(b);if(invoiceXhr){invoiceXhr.abort()}var a=$("#vatInvoice-companyName").val();var b=setTimeout(function(){var c=$("#vatInvoice-companyName").val();if(invoiceFlag&&a==c&&a!=""&&c.match(/[\u4E00-\u9FA5]+/g)){invoiceXhr=$.ajax({url:domainMain+"/member/queryInvoice.json",dataType:"json",timeout:3000,data:{invoiceName:c.replace(/[^\u4E00-\u9FA5]+/g,"")},success:function(f){$(".invoice-new-company").remove();if(f.invoiceInfo){var d=JSON.parse(f.invoiceInfo).datas.slice(0,5);if(d!=null&&d.length){$("#vatInvoice-companyName").after('<div class="invoice-new-company"><ul></ul><div class="invoice-new-company-btn"><a href="javascript:;">\u5173\u95ed</a></div></div>');for(var e=0;e<d.length;e++){$(".invoice-new-company ul").append('<li><a href="javascript:;">'+ec.encodeForHTML(d[e].name)+"</a></li>")}$.each(d,function(g,i){$(".invoice-new-company li a").eq(g).click(function(){$(".invoice-new-company").remove();$("#vatInvoice-companyName").val(i.name).removeClass("error").next().text("");$("#vatInvoice-taxpayerIdentityNum").val(i.taxNo).removeClass("error").next().text("");$("#vatInvoice-registeredAddress").val(i.address).removeClass("error").next().text("");$("#vatInvoice-registeredTelephone").val(i.telephone).removeClass("error").next().text("");$("#vatInvoice-depositBank").val(i.buyerBankAcc).removeClass("error").next().text("");$("#vatInvoice-bankAccount").val(i.buyerBankNum).removeClass("error").next().text("")})})}}},error:function(d){}})}},500);$("#order-invoice-edit,.ol_box_mask").live("click",function(c){$(".invoice-new-company").remove()})};ec.order.invoice.select=function(a){UIController.changeTitleType(a)};ec.order.invoice.popup={box:{},list:{},edit:function(a){$("#myAddress-add-new-box").remove();$("#myAddress-edit-new-box").remove();ec.address.processType="1";UIController.showBox(a);ec.address.bindSeelctEvent(1)},select:function(a){UIController.changeTab($("#order-shopCode").val(),a,1)},save:function(a){UIController.checkViewBoxAndToCache($("#order-shopCode").val())},validateNormal:function(a){var b=ec.form.validator.bind;b(a.find("#invoice-normal-company"),{type:["require","invoiceForbidChar","invoiceCompany","lengthOfChar"],validOnChange:true,allowEmpty:false,min:2,max:100,msg_ct:a.find("#normalCompanyError"),msg:{require:"\u8bf7\u8f93\u5165\u5355\u4f4d\u540d\u79f0",invoiceForbidChar:"\u4e0d\u80fd\u542b\u6709\u975e\u6cd5\u5b57\u7b26",invoiceCompany:$("#invoiceCorpMsg").val(),lengthOfChar:"\u5355\u4f4d\u540d\u79f0\u53ea\u652f\u63012~100\u4f4d\u4e2d\u82f1\u6587\u5b57\u7b26"},});b(a.find("#invoice-normal-taxpayerIdentityNum"),{type:["regex"],validOnChange:true,regex:/^(?!^[A-Z]+$)[0-9A-Z]{15}$|^(?!^[A-Z]+$)[0-9A-Z]{18}$|^(?!^[A-Z]+$)[0-9A-Z]{17}$|^(?!^[A-Z]+$)[0-9A-Z]{20}$/,msg_ct:a.find("#invoice-normal-taxpayerIdentityNum-error"),msg:{regex:"\u7eb3\u7a0e\u4eba\u8bc6\u522b\u53f7\u4e3a15\uff0c17\uff0c18\uff0c20\u4f4d\u7684\u6570\u5b57\u6216\u5927\u5199\u5b57\u6bcd+\u6570\u5b57"}})},validateElectronic:function(a){var b=ec.form.validator.bind;b(a.find("#invoice-electronic-company"),{type:["require","lengthOfChar","invoiceForbidChar","invoiceCompany"],validOnChange:true,allowEmpty:false,min:2,max:100,msg_ct:a.find("#elecCompanyError"),msg:{lengthOfChar:"\u5355\u4f4d\u540d\u79f0\u53ea\u652f\u63012~100\u4f4d\u4e2d\u82f1\u6587\u5b57\u7b26",invoiceForbidChar:"\u4e0d\u80fd\u542b\u6709\u975e\u6cd5\u5b57\u7b26",require:"\u8bf7\u8f93\u5165\u5355\u4f4d\u540d\u79f0",invoiceCompany:$("#invoiceCorpMsg").val()}});b(a.find("#invoice-electronic-taxpayerIdentityNum"),{type:["require","regex"],validOnChange:true,regex:/^(?!^[A-Z]+$)[0-9A-Z]{15}$|^(?!^[A-Z]+$)[0-9A-Z]{17}$|^(?!^[A-Z]+$)[0-9A-Z]{18}$|^(?!^[A-Z]+$)[0-9A-Z]{20}$/,msg_ct:a.find("#invoice-electronic-taxpayerIdentityNum-error"),msg:{regex:"\u7eb3\u7a0e\u4eba\u8bc6\u522b\u53f7\u4e3a15\uff0c17\uff0c18\uff0c20\u4f4d\u7684\u6570\u5b57\u6216\u5927\u5199\u5b57\u6bcd+\u6570\u5b57",require:"\u8bf7\u586b\u5199\u7eb3\u7a0e\u4eba\u8bc6\u522b\u53f7"}});b(a.find("#invoice-electronic-person-phone"),{type:["mobile"],validOnChange:true,msg_ct:a.find("#elecPhoneError-person"),msg:{"default":"\u8bf7\u586b\u5199\u6b63\u786e\u768411\u4f4d\u624b\u673a\u53f7\u7801\uff0c\u4f8b\u5982\uff1a13XXXXXXXXX",}});b(a.find("#invoice-electronic-unit-phone"),{type:["mobile"],validOnChange:true,msg_ct:a.find("#elecPhoneError-unit"),msg:{"default":"\u8bf7\u586b\u5199\u6b63\u786e\u768411\u4f4d\u624b\u673a\u53f7\u7801\uff0c\u4f8b\u5982\uff1a13XXXXXXXXX",}});ec.form.input.label(a.find("#vatInvoice-mobile"),"\u8bf7\u8f93\u516511\u4f4d\u624b\u673a\u53f7\u7801")},validatePerson:function(a){var b=ec.form.validator.bind;b(a.find("#vatInvoice-consignee"),{type:["require","lengthOfChar","regex"],validOnChange:true,regex:/^[\uFF21-\uFF3A\uFF41-\uFF5A\u4E00-\u9FA5\s\u3000A-Za-z]+$/,min:2,max:20,msg_ct:a.find("#vatInvoice-consignee-error"),msg:{lengthOfChar:"\u4e13\u7528\u53d1\u7968\u6536\u7968\u4eba\u53ea\u652f\u63012-20\u4f4d\u4e2d\u82f1\u6587\u5b57\u7b26",regex:"\u6536\u8d27\u4eba\u53ea\u80fd\u586b\u5199\u4e2d\u6587\u548c\u82f1\u6587\u5b57\u7b26",require:"\u8bf7\u586b\u5199\u6536\u8d27\u4eba"}});b(a.find("#vatInvoice-address"),{type:["require","length","forbidChar2"],validOnChange:true,max:100,msg_ct:a.find("#vatInvoice-address-error"),msg:{forbidChar2:"\u4e0d\u80fd\u542b\u6709\u975e\u6cd5\u5b57\u7b26",length:"\u8be6\u7ec6\u5730\u5740\u6700\u957f\u4e3a100\u4e2a\u5b57\u7b26\uff0c\u4e00\u4e2a\u6c49\u5b57\u4e3a\u4e24\u4e2a\u5b57\u7b26",require:"\u8bf7\u586b\u5199\u8be6\u7ec6\u5730\u5740"}});b(a.find("#vatInvoice-mobile"),{type:["mobile","require"],validOnChange:true,msg_ct:a.find("#vatInvoice-mobile-error"),msg:{"default":"\u8bf7\u586b\u5199\u6b63\u786e\u768411\u4f4d\u624b\u673a\u53f7\u7801\uff0c\u4f8b\u5982\uff1a13XXXXXXXXX",require:"\u8bf7\u586b\u5199\u624b\u673a\u53f7\u7801",}});ec.form.input.label(a.find("#vatInvoice-mobile"),"\u8bf7\u8f93\u516511\u4f4d\u624b\u673a\u53f7\u7801")},validateCompany:function(a){var b=ec.form.validator.bind;b(a.find("#vatInvoice-companyName"),{type:["require","lengthOfChar","invoiceForbidChar","invoiceCompany"],validOnChange:true,allowEmpty:false,min:2,max:100,msg_ct:a.find("#vatInvoice-companyName-error"),msg:{invoiceForbidChar:"\u4e0d\u80fd\u542b\u6709\u975e\u6cd5\u5b57\u7b26",lengthOfChar:"\u4e13\u7528\u5355\u4f4d\u540d\u79f0\u53ea\u652f\u63012~100\u4f4d\u4e2d\u82f1\u6587\u5b57\u7b26",require:"\u8bf7\u586b\u5199\u5355\u4f4d\u540d\u79f0",invoiceCompany:$("#invoiceCorpMsg").val()}});b(a.find("#vatInvoice-taxpayerIdentityNum"),{type:["require","regex"],validOnChange:true,regex:/^(?!^[A-Z]+$)[0-9A-Z]{15}$|^(?!^[A-Z]+$)[0-9A-Z]{17}$|^(?!^[A-Z]+$)[0-9A-Z]{18}$|^(?!^[A-Z]+$)[0-9A-Z]{20}$/,msg_ct:a.find("#vatInvoice-taxpayerIdentityNum-error"),msg:{regex:"\u7eb3\u7a0e\u4eba\u8bc6\u522b\u53f7\u4e3a15\uff0c17\uff0c18\uff0c20\u4f4d\u7684\u6570\u5b57\u6216\u5927\u5199\u5b57\u6bcd+\u6570\u5b57",require:"\u8bf7\u586b\u5199\u7eb3\u7a0e\u4eba\u8bc6\u522b\u53f7"}});b(a.find("#vatInvoice-registeredAddress"),{type:["require","length","forbidChar2"],validOnChange:true,max:80,msg_ct:a.find("#vatInvoice-registeredAddress-error"),msg:{forbidChar2:"\u4e0d\u80fd\u542b\u6709\u975e\u6cd5\u5b57\u7b26",length:"\u6ce8\u518c\u5730\u5740\u6700\u957f\u4e3a80\u4e2a\u5b57\u7b26\uff0c\u4e00\u4e2a\u6c49\u5b57\u4e3a\u4e24\u4e2a\u5b57\u7b26",require:"\u8bf7\u586b\u5199\u6ce8\u518c\u5730\u5740"}});b(a.find("#vatInvoice-registeredTelephone"),{type:["require","regex"],validOnChange:true,regex:/^[-\d]{10,20}$/,min:10,max:20,msg_ct:a.find("#vatInvoice-registeredTelephone-error"),msg:{require:"\u8bf7\u586b\u5199\u6ce8\u518c\u7535\u8bdd",regex:"\u6ce8\u518c\u7535\u8bdd\u53ea\u80fd\u662f\u6570\u5b57\u548c-\uff0c\u6700\u5c1110\u4f4d\uff0c\u6700\u957f20\u4f4d"}});b(a.find("#vatInvoice-depositBank"),{type:["require","length","forbidChar"],validOnChange:true,max:100,msg_ct:a.find("#vatInvoice-depositBank-error"),msg:{forbidChar:"\u4e0d\u80fd\u542b\u6709\u975e\u6cd5\u5b57\u7b26",length:"\u5f00\u6237\u94f6\u884c\u6700\u957f\u4e3a100\u4e2a\u5b57\u7b26\uff0c\u4e00\u4e2a\u6c49\u5b57\u4e3a\u4e24\u4e2a\u5b57\u7b26",require:"\u8bf7\u586b\u5199\u5f00\u6237\u94f6\u884c"}});b(a.find("#vatInvoice-bankAccount"),{type:["require","regex"],validOnChange:true,regex:/^[0-9]{6,50}$/,msg_ct:a.find("#vatInvoice-bankAccount-error"),msg:{regex:"\u94f6\u884c\u8d26\u6237\u4e3a\u5927\u4e8e5\u4f4d\u5c0f\u4e8e\u7b49\u4e8e50\u4f4d\u7684\u6570\u5b57",require:"\u8bf7\u586b\u5199\u94f6\u884c\u8d26\u6237"}})}};UcInterface={newShopInvoice:function(b,e){var d={};var a=e.invoiceInfoVOList;var j=e.lastInvoiceInfo||[];var g=$("#order-titleType"+b).val();if(g=="50"){g="2"}for(var c=0;c<j.length;c++){if(j[c].carrierCode==b){if(j[c].invoiceType==g){d.lastInvoiceType=j[c].invoiceType;d.lastInvoiceTitleType=j[c].titleType;break}}else{d.lastInvoiceType=g;d.lastInvoiceTitleType="1"}}for(var c=0;c<a.length;c++){var f=a[c];if(f.carrierCode==b){if(f.invoiceType=="1"){d.normal=f.company;d.normalTaxpayerIdentityNum=f.taxpayerId;if(d.normal==null||d.normal.length<=0){if(f.invoiceType==g){d.lastInvoiceTitleType="1"}}}if(f.invoiceType=="2"||f.invoiceType=="50"){d.electronic=f.company;d.electronicTaxpayerIdentityNum=f.taxpayerId;if(d.electronic==null||d.electronic.length<=0){if(f.invoiceType==g){d.lastInvoiceTitleType="1"}}d.electronicSendWayPhoneP=f.recvMobile;d.electronicSendWayEmailP=f.recvEmail;d.electronicSendWayPhoneU=f.recvMobile;d.electronicSendWayEmailU=f.recvEmail}if(f.invoiceType=="3"){d.vat={};d.vat.taxpayerIdentityNum=f.taxpayInvoiceInfoVO.taxpayerId;d.vat.registeredAddress=f.taxpayInvoiceInfoVO.regAddress;d.vat.registeredTelephone=f.taxpayInvoiceInfoVO.regTelephone;d.vat.depositBank=f.taxpayInvoiceInfoVO.bank;d.vat.bankAccount=f.taxpayInvoiceInfoVO.bankAccount;d.vat.companyName=f.company;d.vat.consignee=f.taxpayInvoiceInfoVO.checkTaker;d.vat.province=f.taxpayInvoiceInfoVO.takerProvince;d.vat.city=f.taxpayInvoiceInfoVO.takerCity;d.vat.district=f.taxpayInvoiceInfoVO.takerDistrict;d.vat.street=f.taxpayInvoiceInfoVO.takerStreet;d.vat.address=f.taxpayInvoiceInfoVO.takerAddress;d.vat.mobile=f.taxpayInvoiceInfoVO.takerMobile;d.vat.zipcode=f.taxpayInvoiceInfoVO.takerZipcode}}}return d},update2UC:function(c){var b={};b.invoiceType=c.lastInvoiceType;b.titleType=c.lastInvoiceTitleType;b.carrierCode=c.shopCode;if(c.lastInvoiceType=="1"){b.company=c.normal;b.taxpayerId=c.normalTaxpayerIdentityNum}if(c.lastInvoiceType=="2"){b.company=c.electronic;b.taxpayerId=c.electronicTaxpayerIdentityNum;if(c.lastInvoiceTitleType=="1"){b.recvMobile=c.electronicSendWayPhoneP;b.recvEmail=c.electronicSendWayEmailP}else{b.recvMobile=c.electronicSendWayPhoneU;b.recvEmail=c.electronicSendWayEmailU}}if(c.lastInvoiceType=="3"){b.checkTaker=c.vat.consignee;b.takerProvince=c.vat.province;b.takerCity=c.vat.city;b.takerDistrict=c.vat.district;b.takerStreet=c.vat.street;b.takerAddress=c.vat.address;b.takerMobile=c.vat.mobile;b.takerZipcode=c.vat.zipcode;b.company=c.vat.companyName;b.taxpayerId=c.vat.taxpayerIdentityNum;b.regAddress=c.vat.registeredAddress;b.regTelephone=c.vat.registeredTelephone;b.bankAccount=c.vat.bankAccount;b.bank=c.vat.depositBank}var d={userId:ec.util.cookie.get("uid"),invoiceType:b.invoiceType,TitleType:b.titleType,company:b.company,taxpayerId:b.taxpayerId,};if($("#invoice_click_2").hasClass("current")){if(c.lastInvoiceTitleType=="1"){d.recvMobile=c.electronicSendWayPhoneP;d.recvEmail=c.electronicSendWayEmailP}else{d.recvMobile=c.electronicSendWayPhoneU;d.recvEmail=c.electronicSendWayEmailU}}if($("#invoice_click_3").hasClass("current")){var a={taxpayerId:b.taxpayerId,bank:b.bank,bankAccount:b.bankAccount,regAddress:b.regAddress,regTelephone:b.regTelephone,checkTaker:b.checkTaker,takerProvince:b.takerProvince,takerCity:b.takerCity,takerDistrict:b.takerDistrict,takerStreet:b.takerStreet,takerAddress:b.takerAddress,takerMobile:b.takerMobile};d.taxpayInvoiceInfoVO=JSON.stringify(a)}d.carrierCode=$("#order-shopCode").val();$.ajax({type:"post",url:openApiDomain+"/uc/invoice/updateInvoiceInfo.json",dataType:"json",data:JSON.stringify(d),timeout:10000,xhrFields:{withCredentials:true},beforeSend:function(e){e.withCredentials=true;e.setRequestHeader("CsrfToken",csrftoken)},success:function(){}})},queryUC:function(b,a,c){$.ajax({url:openApiDomain+"/uc/invoice/queryInvoiceList.json",dataType:"json",timeout:10000,beforeSend:function(d){d.withCredentials=true;d.setRequestHeader("CsrfToken",csrftoken)},data:{userId:ec.util.cookie.get("uid")},success:function(e){if(e.resultCode=="200000"&&e.data){for(var d=0;d<b.length;d++){var f=b[d];a[f]=UcInterface.newShopInvoice(f,e.data)}if(c){c()}}}})}};UIController={showBox:function(a){$("#order-shopCode").val(a);ec.order.invoice.popup.box=new ec.box($("#invoice-edit-box").val(),{boxid:"order-invoice-edit",boxclass:"ol_box_4",title:'\u53d1\u7968\u4fe1\u606f<em style="font-size: 14px;color: #BBBBBB;"></em>',width:700,showButton:false,onopen:function(b){InvoiceManager.queryCfg(a);UIController.cacheToBoxView(InvoiceManager.getInvoice(a));ec.order.invoice.popup.validatePerson($("#vatinvoice-person-form"));ec.order.invoice.popup.validateCompany($("#vatinvoice-company-form"));ec.order.invoice.popup.validateNormal($("#invoice-normal-form"));ec.order.invoice.popup.validateElectronic($("#invoice-electronic-form"));ec.order.invoice.popup.validateElectronic($("#invoice-electronic-form-person"));b.setPosition()}}).open()},disableTab:function(b){for(var c=0;c<4;c++){if(InvoiceManager.isUneffective(b,c)){$("#invoice_click_"+c).addClass("disabled");$("#invoice_click_"+c).attr("dis-flag","1");var a="\u8ba2\u5355\u5305\u542b\u4e0d\u652f\u6301\u5f00"+$("#invoice_click_"+c).html().replace('<em class="a-tip"></em>',"")+"\u7684\u5546\u54c1\u3002";$("#invoice_click_"+c).attr("title",a);switch(c){case 0:break;case 1:$("#invoice-info-normal").find("input").each(function(){$(this).attr("disabled","disabled")});$("#invoice-info-normal").find("i").each(function(){$(this).removeAttr("onclick");if($(this).attr("class")=="icon-radio-normal"){$(this).addClass("disabled")}});break;case 2:$("#invoice-info-electronic").find("input").each(function(){$(this).attr("disabled","disabled")});$("#invoice-info-electronic").find("i").each(function(){$(this).removeAttr("onclick");if($(this).attr("class")=="icon-radio-normal"){$(this).addClass("disabled")}});break;case 3:$("#invoice-info-add").find("input").each(function(){$(this).attr("disabled","disabled")});$("#current-address").parent().addClass("disabled");$("#current-address").unbind("click");break;default:break}}}},maskTab:function(a){$("#invoice_click_1").hide();$("#invoice_click_2").hide();$("#invoice_click_3").hide();$("#invoice_click_0").hide();if(InvoiceManager.isEffective(a,"1")){$("#invoice_click_1").show()}if(InvoiceManager.isEffective(a,"2")){$("#invoice_click_2").show()}if(InvoiceManager.isEffective(a,"3")){$("#invoice_click_3").show()}if(InvoiceManager.isEffective(a,"0")){$("#invoice_click_0").show()}},changeTab:function(e,d,g){if(InvoiceManager.isEffective(e,"1")&&d==1){if($("#invoice_click_1").attr("dis-flag")!="0"){return}$("#invoice_click_1").attr("class","current");$("#invoice_click_2").removeClass("current");$("#invoice_click_3").removeClass("current");$("#invoice_click_0").removeClass("current");$("#invoice-info-normal").removeClass("hide");$("#invoice-info-electronic").addClass("hide");$("#invoice-info-notuse").addClass("hide");$("#invoice-info-add").addClass("hide");$("#invoice_save_step").show();$("#invoice_return_step").hide();$("#invoice_next_step").hide();$("#invoice_mid_step").hide();$("#invoiceMemoText1,#invoiceMemoText2,#invoiceMemoText3,#invoiceMemoText0").hide();if($("#invoiceMemoText1").html()){$("#invoiceMemoText1").show();$("#invoiceMemoText1").parent().show()}else{$("#invoiceMemoText1").parent().hide()}$("#invoiceTitle-elecPerson").addClass("icon-radio");$("#invoice-electronic-form").hide();if(g=="1"){$("#invoiceTitle-normalPerson").addClass("icon-radio");$("#invoiceTitle-normalCompany").removeClass("icon-radio");$("#invoice-normal-form").hide()}else{$("#invoiceTitle-normalPerson").removeClass("icon-radio");$("#invoiceTitle-normalCompany").addClass("icon-radio");$("#invoice-normal-form").show()}if(InvoiceManager.isUneffective(e,1)){$("#invoice_save_step").hide();var c="\u8ba2\u5355\u5305\u542b\u4e0d\u652f\u6301\u5f00"+$("#invoice_click_1").html().replace('<em class="a-tip"></em>',"")+"\u7684\u5546\u54c1\u3002";$("#invoice-unsupport-tips").html(ec.encodeForHTML(c));$("#invoice-unsupport-tips").removeClass("hide")}else{$("#invoice-unsupport-tips").html("");$("#invoice-unsupport-tips").addClass("hide")}}if(InvoiceManager.isEffective(e,"2")&&d==2){if($("#invoice_click_2").attr("dis-flag")!="0"){return}$("#invoice_click_2").attr("class","current");$("#invoice_click_1").removeClass("current");$("#invoice_click_3").removeClass("current");$("#invoice_click_0").removeClass("current");$("#invoice-info-normal").addClass("hide");$("#invoice-info-electronic").removeClass("hide");$("#invoice-info-notuse").addClass("hide");$("#invoice-info-add").addClass("hide");$("#invoice_save_step").show();$("#invoice_return_step").hide();$("#invoice_next_step").hide();$("#invoice_mid_step").hide();if(!$("#MoreUnSelfSendWay").hasClass("hide")){$("#MoreUnSelfSendWay").addClass("hide")}$("#invoiceMemoText1,#invoiceMemoText2,#invoiceMemoText3,#invoiceMemoText0").hide();if($("#invoiceMemoText2").html()){$("#invoiceMemoText2").show();$("#invoiceMemoText2").parent().show()}else{$("#invoiceMemoText2").parent().hide()}$("#sendWay-person").hide();$("#sendWay-unit").hide();$("#invoiceTitle-normalPerson").addClass("icon-radio");$("#invoice-normal-form").hide();if(g=="1"){$("#invoiceTitle-elecPerson").addClass("icon-radio");$("#invoiceTitle-elecCompany").removeClass("icon-radio");$("#invoice-electronic-form").hide()}else{$("#invoiceTitle-elecPerson").removeClass("icon-radio");$("#invoiceTitle-elecCompany").addClass("icon-radio");$("#invoice-electronic-form").show()}var b=InvoiceManager.isUneffective(e,2);if(b){$("#invoice_save_step").hide();var c="\u8ba2\u5355\u5305\u542b\u4e0d\u652f\u6301\u5f00"+$("#invoice_click_2").html().replace('<em class="a-tip"></em>',"")+"\u7684\u5546\u54c1\u3002";$("#invoice-unsupport-tips").html(ec.encodeForHTML(c));$("#invoice-unsupport-tips").removeClass("hide")}else{$("#invoice-unsupport-tips").html("");$("#invoice-unsupport-tips").addClass("hide")}if(!b&&e!="VMALL-HUAWEIDEVICE"){if(InvoiceManager.invoiceCfgList[e]!=null){if(InvoiceManager.invoiceCfgList[e].electronicReceiveMode!=null&&InvoiceManager.invoiceCfgList[e].electronicReceiveMode.length>0){$("#showPhone-person-tips").hide();$("#showPhone-person-content").hide();$("#showPhone-unit-tips").hide();$("#showPhone-unit-content").hide();$("#sendWay-unit").show();$("#showEmail-person-tips").hide();$("#showEmail-person-content").hide();$("#showEmail-unit-tips").hide();$("#showEmail-unit-content").hide();var a=InvoiceManager.invoiceCfgList[e].electronicReceiveMode;for(var f=0;f<a.length;f++){if(a[f]=="P"){$("#showPhone-person-tips").show();$("#showPhone-person-content").show();$("#showPhone-unit-tips").show();$("#showPhone-unit-content").show()}else{$("#showEmail-person-tips").show();$("#showEmail-person-content").show();$("#showEmail-unit-tips").show();$("#showEmail-unit-content").show()}}if(g=="1"){$("#sendWay-person").show()}else{$("#sendWay-unit").show()}}}}}if(InvoiceManager.isEffective(e,"0")&&(d==0)){if($("#invoice_click_0").attr("dis-flag")!="0"){return}$("#invoice_click_0").attr("class","current");$("#invoice_click_1").removeClass("current");$("#invoice_click_2").removeClass("current");$("#invoice_click_3").removeClass("current");$("#invoice-info-normal").addClass("hide");$("#invoice-info-electronic").addClass("hide");$("#invoice-info-notuse").removeClass("hide");$("#invoice-info-add").addClass("hide");$("#invoice_save_step").show();$("#invoice_return_step").hide();$("#invoice_next_step").hide();$("#invoice_mid_step").hide();$("#invoiceMemoText1,#invoiceMemoText2,#invoiceMemoText3,#invoiceMemoText0").hide();$("#invoiceMemoText0").hide();if($("#invoiceMemoText0").html()){$("#invoiceMemoText0").show();$("#invoiceMemoText0").parent().show()}else{$("#invoiceMemoText0").parent().hide()}ec.order.invoice.select(0);if(InvoiceManager.isUneffective(e,0)){$("#invoice_save_step").hide();var c="\u8ba2\u5355\u5305\u542b\u4e0d\u652f\u6301\u5f00"+$("#invoice_click_0").html().replace('<em class="a-tip"></em>',"")+"\u7684\u5546\u54c1\u3002";$("#invoice-unsupport-tips").html(ec.encodeForHTML(c));$("#invoice-unsupport-tips").removeClass("hide")}else{$("#invoice-unsupport-tips").html("");$("#invoice-unsupport-tips").addClass("hide")}}if(InvoiceManager.isEffective(e,"3")&&d==3){if($("#invoice_click_3").attr("dis-flag")!="0"){return}$("#invoice_click_3").attr("class","current");$("#invoice_click_1").removeClass("current");$("#invoice_click_2").removeClass("current");$("#invoice_click_0").removeClass("current");$("#invoice-info-normal").addClass("hide");$("#invoice-info-electronic").addClass("hide");$("#invoice-info-notuse").addClass("hide");$("#invoice-info-add").removeClass("hide");$("#addTitle").show();$("#invoice-company").removeClass("hide");$("#invoice-person").addClass("hide");$("#vat-step-1").addClass("current");$("#vat-step-2").removeClass("current");if(!$("#specialInvoiceMidPage").hasClass("hide")){$("#specialInvoiceMidPage").addClass("hide")}$("#invoice_return_step").hide();$("#invoice_mid_step").hide();$("#invoice_next_step").show();$("#invoice_save_step").hide();if(InvoiceManager.isUneffective(e,3)){$("#invoice_next_step").hide();var c="\u8ba2\u5355\u5305\u542b\u4e0d\u652f\u6301\u5f00"+$("#invoice_click_3").html().replace('<em class="a-tip"></em>',"")+"\u7684\u5546\u54c1\u3002";$("#invoice-unsupport-tips").html(ec.encodeForHTML(c));$("#invoice-unsupport-tips").removeClass("hide")}else{$("#invoice-unsupport-tips").html("");$("#invoice-unsupport-tips").addClass("hide")}$("#invoiceMemoText1,#invoiceMemoText2,#invoiceMemoText3,#invoiceMemoText0").hide();if($("#invoiceMemoText3").html()){$("#invoiceMemoText3").show();$("#invoiceMemoText3").parent().show()}else{$("#invoiceMemoText3").parent().hide()}$("#invoiceTitle-normalPerson").addClass("icon-radio");$("#invoiceTitle-normalCompany").removeClass("icon-radio");$("#invoice-normal-form").hide();$("#invoiceTitle-elecPerson").addClass("icon-radio");$("#invoiceTitle-elecCompany").removeClass("icon-radio");$("#invoice-electronic-form").hide()}if(InvoiceManager.isEffective(e,"3")&&d==7){if(!ec.form.validator($("#vatinvoice-company-form"),true)){return}$("#invoice_next_step").removeAttr("typePage");$("#invoice-company").addClass("hide");$("#specialInvoiceMidPage").removeClass("hide");$("#addTitle").hide();$("#invoiceTips").hide();$("#invoice_next_step").hide();$("#invoice_mid_step").show()}if(InvoiceManager.isEffective(e,"3")&&d==4){if(!ec.form.validator($("#vatinvoice-company-form"),true)){return}if(!$("#specialInvoiceMidPage").hasClass("hide")){$("#specialInvoiceMidPage").addClass("hide")}$("#addTitle").show();$("#invoice_mid_step").hide();$("#invoiceTips").show();$("#invoice-info-add").removeClass("hide");$("#invoice-company").addClass("hide");$("#invoice-person").removeClass("hide");$("#vat-step-1").removeClass("current");$("#vat-step-2").addClass("current");$("#invoice_return_step").show();$("#invoice_save_step").show();$("#invoice_next_step").hide();if(InvoiceManager.isUneffective(e,3)){$("#invoice_save_step").hide()}}if(InvoiceManager.isEffective(e,"3")&&d==5){if(!ec.form.validator($("#vatinvoice-person-form"),true)){return}$("#invoice-info-add").removeClass("hide");$("#invoice-company").removeClass("hide");$("#invoice-person").addClass("hide");$("#vat-step-1").addClass("current");$("#vat-step-2").removeClass("current");$("#invoice_return_step").hide();$("#invoice_save_step").hide();$("#invoice_next_step").show()}UIController.disableTab(e)},checkViewBoxAndToCache:function(a){if($("#invoice_click_3").attr("class")=="current"){var b=$("#vatinvoice-person-form").find("input[name=districtG]").attr("value");var c=$("#vatinvoice-person-form").find("input[name=streetG]").attr("value");if(!c){ec.address.queryData(ec.address.parseUrl(children_url,b),true,0,function(d){if(!d||!d.data||d.data.length<1){$("#vatInvoice-myAddress-error").removeClass("report-errors");$("#vatInvoice-myAddress-error").hide();UIController.viewBoxToCache(a);return}$("#vatInvoice-myAddress-error").addClass("report-errors");$("#vatInvoice-myAddress-error").text("\u8bf7\u9009\u62e9\u5b8c\u6574\u7684\u5730\u533a\u4fe1\u606f");$("#vatInvoice-myAddress-error").show()});return}}UIController.viewBoxToCache(a)},cacheToBoxView:function(c){var b=InvoiceManager.invoiceCfgList[c.shopCode];if(b){$("#invoiceMemoText1").html(b.paperMemo);$("#invoiceMemoText2").html(b.electronicMemo);$("#invoiceMemoText3").html(b.vatMemo);$("#invoiceMemoText0").html(b.noInvoiceMemo)}$("#invoice-address-detail").append('<th><span class="red">*</span><label>\u8be6\u7ec6\u5730\u5740</label></th><td><input id="vatInvoice-address" type="text" class="invoice-new-text"><div id="vatInvoice-address-error"></div></td>');$("#invoice-normal-company").val(c.normal);$("#invoice-normal-taxpayerIdentityNum").val(c.normalTaxpayerIdentityNum);$("#invoice-electronic-company").val(c.electronic);$("#invoice-electronic-taxpayerIdentityNum").val(c.electronicTaxpayerIdentityNum);if(b!=null){if(b.electronicReceiveMode!=null&&b.electronicReceiveMode.length>0){$("#invoice-electronic-person-phone").val(c.electronicSendWayPhoneP);if($("#invoice-electronic-person-phone").length>0&&$("#invoice-electronic-person-phone").val()!=""){$("#showPhone-person-tips span").show()}$("#invoice-electronic-email-person").val(c.electronicSendWayEmailP);if($("#invoice-electronic-email-person").length>0&&$("#invoice-electronic-email-person").val()!=""){$("#showEmail-person-tips span").show()}$("#invoice-electronic-unit-phone").val(c.electronicSendWayPhoneU);if($("#invoice-electronic-unit-phone").length>0&&$("#invoice-electronic-unit-phone").val()!=""){$("#showPhone-unit-tips span").show()}$("#invoice-electronic-email-unit").val(c.electronicSendWayEmailU);if($("#invoice-electronic-email-unit").length>0&&$("#invoice-electronic-email-unit").val()!=""){$("#showEmail-unit-tips span").show()}if((b.electronicReceiveModeStr.indexOf("P")<0)){$("#invoice-electronic-person-phone").val("");$("#invoice-electronic-unit-phone").val("")}if((b.electronicReceiveModeStr.indexOf("E")<0)){$("#invoice-electronic-email-person").val("");$("#invoice-electronic-email-unit").val("")}}else{$("#invoice-electronic-person-phone").val("");$("#invoice-electronic-unit-phone").val("");$("#invoice-electronic-email-person").val("");$("#invoice-electronic-email-unit").val("")}}var a;if(c.vat!=null){$("#vatInvoice-companyName").val(c.vat.companyName);$("#vatInvoice-taxpayerIdentityNum").val(c.vat.taxpayerIdentityNum);$("#vatInvoice-registeredAddress").val(c.vat.registeredAddress);$("#vatInvoice-registeredTelephone").val(c.vat.registeredTelephone);$("#vatInvoice-depositBank").val(c.vat.depositBank);$("#vatInvoice-bankAccount").val(c.vat.bankAccount);$("#vatInvoice-consignee").val(c.vat.consignee);$("#vatInvoice-zipcode").val(c.vat.zipcode);$("#vatInvoice-address").val(c.vat.address);$("#vatInvoice-mobile").val(c.vat.mobile);a=c.vat.district;if(c.vat.street!=null&&c.vat.street!=""){a=c.vat.street}$("#myAddress-add-new-box").remove();$("#myAddress-edit-new-box").remove();if(a){ec.address.setValue(c.vat);ec.address.queryData(ec.address.parseUrl(tree_url,a),true,1,ec.address.getCitydistrict)}}$("#myAddress-msg").removeClass("icon-error");UIController.maskTab(c.shopCode);UIController.changeTab(c.shopCode,c.lastInvoiceType,c.lastInvoiceTitleType)},viewBoxToCache:function(a){var b=InvoiceManager.getInvoice(a);if($("#invoice_click_1").hasClass("current")){b.lastInvoiceType="1";if($("#invoiceTitle-normalPerson").hasClass("icon-radio")){b.lastInvoiceTitleType="1"}if($("#invoiceTitle-normalCompany").hasClass("icon-radio")){if(!ec.form.validator($("#invoice-normal-form"),true)){return}b.lastInvoiceTitleType="2";b.normal=ec.order.invoice.optCompany($("#invoice-normal-company").val());b.normalTaxpayerIdentityNum=$("#invoice-normal-taxpayerIdentityNum").val()}}if($("#invoice_click_2").hasClass("current")){b.lastInvoiceType="2";if($("#invoiceTitle-elecPerson").hasClass("icon-radio")){b.lastInvoiceTitleType="1";if(InvoiceManager.invoiceCfgList[a]!=null){if(InvoiceManager.invoiceCfgList[a].electronicReceiveMode!=null&&InvoiceManager.invoiceCfgList[a].electronicReceiveMode.length>0){if(!ec.form.validator($("#invoice-electronic-form-person"),true)){return}if($("#elecEmailError-person").hasClass("eWayErro")){return}if($("#invoice-electronic-person-phone").val()!=null&&$("#invoice-electronic-person-phone").val()!=""){b.electronicSendWayPhoneP=$("#invoice-electronic-person-phone").val()}else{b.electronicSendWayPhoneP=""}if($("#invoice-electronic-email-person").val()!=null&&$("#invoice-electronic-email-person").val()!=""){b.electronicSendWayEmailP=$("#invoice-electronic-email-person").val()}else{b.electronicSendWayEmailP=""}}else{b.electronicSendWayEmailU="";b.electronicSendWayPhoneU="";b.electronicSendWayEmailP="";b.electronicSendWayPhoneP=""}}}if($("#invoiceTitle-elecCompany").hasClass("icon-radio")){if(!ec.form.validator($("#invoice-electronic-form"),true)){return}if(!ec.form.validator($("#invoice-electronic-NewSendWay-form"),true)){return}b.lastInvoiceTitleType="2";b.electronic=ec.order.invoice.optCompany($("#invoice-electronic-company").val());b.electronicTaxpayerIdentityNum=$("#invoice-electronic-taxpayerIdentityNum").val();if(InvoiceManager.invoiceCfgList[a]!=null){if(InvoiceManager.invoiceCfgList[a].electronicReceiveMode!=null&&InvoiceManager.invoiceCfgList[a].electronicReceiveMode.length>0){if(!ec.form.validator($("#invoice-electronic-form-person"),true)){return}if($("#elecEmailError-unit").hasClass("eWayErro")){return}if($("#invoice-electronic-unit-phone").val()!=null&&$("#invoice-electronic-unit-phone").val()!=""){b.electronicSendWayPhoneU=$("#invoice-electronic-unit-phone").val()}else{b.electronicSendWayPhoneU=""}if($("#invoice-electronic-email-unit").val()!=null&&$("#invoice-electronic-email-unit").val()!=""){b.electronicSendWayEmailU=$("#invoice-electronic-email-unit").val()}else{b.electronicSendWayEmailU=""}}else{b.electronicSendWayEmailU="";b.electronicSendWayPhoneU="";b.electronicSendWayEmailP="";b.electronicSendWayPhoneP=""}}}}if($("#invoice_click_0").hasClass("current")){b.lastInvoiceType="0"}if($("#invoice_click_3").hasClass("current")){if(!ec.form.validator($("#vatinvoice-company-form"),true)){ec.order.invoice.popup.select(5);return}if(!ec.form.validator($("#vatinvoice-person-form"),true)){ec.order.invoice.popup.select(4);return}if(""!=$("input[name=provinceG]").val()&&""!=$("input[name=cityG]").val()&&""!=$("input[name=districtG]").val()){$("#vatInvoice-myAddress-error").removeClass("report-errors");$("#vatInvoice-myAddress-error").hide()}else{$("#vatInvoice-myAddress-error").addClass("report-errors");$("#vatInvoice-myAddress-error").text("\u8bf7\u9009\u62e9\u5b8c\u6574\u7684\u5730\u533a\u4fe1\u606f");$("#vatInvoice-myAddress-error").show();return}b.lastInvoiceType="3";b.vat.taxpayerIdentityNum=$("#vatInvoice-taxpayerIdentityNum").val();b.vat.registeredAddress=$("#vatInvoice-registeredAddress").val();b.vat.registeredTelephone=$("#vatInvoice-registeredTelephone").val();b.vat.depositBank=$("#vatInvoice-depositBank").val();b.vat.bankAccount=$("#vatInvoice-bankAccount").val();b.vat.companyName=ec.order.invoice.optCompany($("#vatInvoice-companyName").val());b.vat.consignee=$("#vatInvoice-consignee").val();b.vat.province=$("input[name=provinceG]").val();b.vat.city=$("input[name=cityG]").val();b.vat.district=$("input[name=districtG]").val();b.vat.street=$("input[name=streetG]").val();b.vat.address=$("#vatInvoice-address").val();b.vat.mobile=$("#vatInvoice-mobile").val();b.vat.zipcode=$("#vatInvoice-zipcode").val()}UIController.cacheToPageViewOne(b);ec.order.invoice.popup.box.close();UcInterface.update2UC(b)},changeTitleType:function(a){switch(""+a){case"11":$("#invoice-normal-form").hide();$("#invoiceTitle-normalPerson").addClass("icon-radio");$("#invoiceTitle-normalCompany").removeClass("icon-radio");break;case"12":$("#invoice-normal-form").show();$("#invoiceTitle-normalPerson").removeClass("icon-radio");$("#invoiceTitle-normalCompany").addClass("icon-radio");break;case"21":$("#invoice-electronic-form").hide();$("#invoiceTitle-elecPerson").addClass("icon-radio");$("#invoiceTitle-elecCompany").removeClass("icon-radio");if($("#order-shopCode").val()!="VMALL-HUAWEIDEVICE"){if(InvoiceManager.invoiceCfgList[$("#order-shopCode").val()]!=null){if(InvoiceManager.invoiceCfgList[$("#order-shopCode").val()].electronicReceiveModeStr.length>0){$("#sendWay-unit").hide();$("#sendWay-person").show();$("#showPhone-person-tips").hide();$("#showPhone-person-content").hide();$("#showEmail-person-tips").hide();$("#showEmail-person-content").hide();ec.order.newSendShow("P")}}}break;case"22":$("#invoice-electronic-form").show();$("#invoiceTitle-elecPerson").removeClass("icon-radio");$("#invoiceTitle-elecCompany").addClass("icon-radio");if($("#order-shopCode").val()!="VMALL-HUAWEIDEVICE"){if(InvoiceManager.invoiceCfgList[$("#order-shopCode").val()]!=null){if(InvoiceManager.invoiceCfgList[$("#order-shopCode").val()].electronicReceiveModeStr.length>0){$("#sendWay-person").hide();$("#sendWay-unit").show();$("#showEmail-unit-tips").hide();$("#showEmail-unit-content").hide();$("#showPhone-unit-tips").hide();$("#showPhone-unit-content").hide();ec.order.newSendShow("U")}}}break;case"0":$("#invoiceTitle-notuse").addClass("icon-radio");break}},cacheToPageViewOne:function(a){if(!a){return}if(InvoiceManager.isUneffective(a.shopCode,a.lastInvoiceType)){$("#invoice-info-type"+a.shopCode).hide();$("#invoice-info-title"+a.shopCode).hide();$("#invoiceEdit"+a.shopCode).html("\u9009\u62e9\u53d1\u7968\u7c7b\u578b");return}switch(""+a.lastInvoiceType){case"1":$("#invoice-info-type"+a.shopCode).text("\u7eb8\u8d28\u666e\u901a\u53d1\u7968");$("#order-titleType"+a.shopCode).val("1");$("#invoice-info-title"+a.shopCode).text("\u4e2a\u4eba");$("#order-invoiceTitle"+a.shopCode).val("\u4e2a\u4eba");$("#order-taxpayerIdentityNum"+a.shopCode).val("");if(a.lastInvoiceTitleType=="2"){$("#invoice-info-title"+a.shopCode).text(a.normal);$("#order-invoiceTitle"+a.shopCode).val(a.normal);$("#order-taxpayerIdentityNum"+a.shopCode).val(a.normalTaxpayerIdentityNum)}break;case"2":$("#invoice-info-type"+a.shopCode).text("\u7535\u5b50\u666e\u901a\u53d1\u7968");$("#order-titleType"+a.shopCode).val("50");$("#invoice-info-title"+a.shopCode).text("\u4e2a\u4eba");$("#order-invoiceTitle"+a.shopCode).val("\u4e2a\u4eba");$("#order-taxpayerIdentityNum"+a.shopCode).val("");if(a.lastInvoiceTitleType=="2"){$("#invoice-info-title"+a.shopCode).text(a.electronic);$("#order-invoiceTitle"+a.shopCode).val(a.electronic);$("#order-taxpayerIdentityNum"+a.shopCode).val(a.electronicTaxpayerIdentityNum)}if(a.lastInvoiceTitleType=="1"){if(a.electronicSendWayPhoneP!=null){$("#order-SendWayPhone"+a.shopCode).val(a.electronicSendWayPhoneP)}if(a.electronicSendWayEmailP!=null){$("#order-SendWayEmail"+a.shopCode).val(a.electronicSendWayEmailP)}}else{if(a.electronicSendWayPhoneU!=null){$("#order-SendWayPhone"+a.shopCode).val(a.electronicSendWayPhoneU)}if(a.electronicSendWayEmailU!=null){$("#order-SendWayEmail"+a.shopCode).val(a.electronicSendWayEmailU)}}break;case"0":$("#invoice-info-type"+a.shopCode).text("\u4e0d\u5f00\u53d1\u7968");$("#invoice-info-title"+a.shopCode).text("");$("#order-titleType"+a.shopCode).val("0");$("#order-invoiceTitle"+a.shopCode).val("");break;case"3":$("#invoice-info-type"+a.shopCode).text("\u4e13\u7528\u53d1\u7968");$("#invoice-info-title"+a.shopCode).text(a.vat.companyName);$("#order-titleType"+a.shopCode).val("3");$("#order-invoiceTitle"+a.shopCode).val(a.vat.companyName);$("#order-vatInvoiceJson"+a.shopCode).val(ec.lang.json.stringify(InvoiceManager.newVatInvoice(a)));$("#order-vatInvoiceCompany"+a.shopCode).val((InvoiceManager.newVatInvoice(a).companyName));$("#order-vatInvoiceDeliveryJson"+a.shopCode).val(ec.lang.json.stringify(InvoiceManager.newVatInvoiceDelivery(a)));break}$("#invoice-info-type"+a.shopCode).show();$("#invoice-info-title"+a.shopCode).show();$("#invoiceEdit"+a.shopCode).html("\u4fee\u6539")},cacheToPageView:function(){var a=InvoiceManager.shopCodeList;var c=InvoiceManager.invoiceList;for(var b=0;b<a.length;b++){var d=a[b],e=InvoiceManager.getInvoice(d);UIController.cacheToPageViewOne(e);if(!c[d].isMatch){$("#invoice-info-type"+d).hide();$("#invoice-info-title"+d).hide();$("#invoiceEdit"+d).html("\u9009\u62e9\u53d1\u7968\u7c7b\u578b")}}}};InvoiceManager={shopCodeList:[],invoiceList:{},userInvoiceList:{},orderInvoiceList:{},invoiceCfgList:{},getInvoice:function(a){return InvoiceManager.invoiceList[a]},newVatInvoice:function(b){var a={};a.companyName=b.vat.companyName;a.taxpayerIdentityNum=b.vat.taxpayerIdentityNum;a.registeredAddress=b.vat.registeredAddress;a.registeredTelephone=b.vat.registeredTelephone;a.depositBank=b.vat.depositBank;a.bankAccount=b.vat.bankAccount;return a},newVatInvoiceDelivery:function(a){var b={};b.consignee=a.vat.consignee;b.mobile=a.vat.mobile;b.zipCode=a.vat.zipcode;b.provinceId=a.vat.province;b.cityId=a.vat.city;b.districtId=a.vat.district;b.streetId=a.vat.street;b.address=a.vat.address;return b},isEffective:function(b,a){var c=InvoiceManager.invoiceList[b];if(!c||!c.effectiveList){return false}if(a==2){return c.effectiveList.indexOf("|50|")>=0}return c.effectiveList.indexOf("|"+a+"|")>=0},isUneffective:function(b,a){var c=InvoiceManager.invoiceList[b];if(!c||!c.uneffectiveList){return false}if(a==2){return c.uneffectiveList.indexOf("|50|")>=0}return c.uneffectiveList.indexOf("|"+a+"|")>=0},NoSelfShowMoreWay:function(b,a){var c=InvoiceManager.invoiceList[b];if(!c||!c.uneffectiveList){return false}},fromOrder:function(){InvoiceManager.shopCodeList=$("#order-shopCodes").val().split("|");for(var b=0;b<InvoiceManager.shopCodeList.length;b++){if(!InvoiceManager.shopCodeList[b]){InvoiceManager.shopCodeList.splice(b,1)}}var a=InvoiceManager.orderInvoiceList;var d=InvoiceManager.shopCodeList;for(var b=0;b<d.length;b++){var c=d[b];var e=$("#order-titleType"+c).val();e=e==50?2:e;a[c]={shopCode:c,defaultInvoiceType:e,effectiveList:"|"+$("#order-effectiveList"+c).val()+"|",uneffectiveList:"|"+$("#order-uneffectiveList"+c).val()+"|"}}},queryCfg:function(a){if(InvoiceManager.invoiceCfgList[a]){return}$.ajax({url:"/invoice/queryInvoiceCfg.json",dataType:"json",async:false,timeout:3000,data:{shopCode:a},success:function(b){if(b.invoiceConfig){InvoiceManager.invoiceCfgList[b.invoiceConfig.carrierCode]=b.invoiceConfig}}})},fromUC:function(){InvoiceManager.mergeInvoiceList();UIController.cacheToPageView();UcInterface.queryUC(InvoiceManager.shopCodeList,InvoiceManager.userInvoiceList,function(){InvoiceManager.mergeInvoiceList();UIController.cacheToPageView()})},mergeInvoiceList:function(){var c=InvoiceManager.shopCodeList,e=InvoiceManager.invoiceList,b=InvoiceManager.userInvoiceList,f=InvoiceManager.orderInvoiceList;for(var d=0;d<c.length;d++){var a=c[d];e[a]=$.extend({vat:{}},b[a],f[a]);e[a].isNull=parseInt(e[a].lastInvoiceType)>=0?false:true;e[a].isMatch=e[a].lastInvoiceType==e[a].defaultInvoiceType;e[a].lastInvoiceType=e[a].defaultInvoiceType;e[a].lastInvoiceTitleType=e[a].isMatch?e[a].lastInvoiceTitleType:"1";e[a].isMatch=e[a].isNull||e[a].isMatch}},initialize:function(){InvoiceManager.fromOrder();InvoiceManager.fromUC()}};ec.ready(function(){InvoiceManager.initialize()});ec.order.invoice.checkEmailSuccess=function(e){var f;var a;var d;if(e==1){f=$("#invoice-electronic-email-person").val();a=$("#elecEmailError-person");$WayTips=$("#showEmail-person-tips span")}else{f=$("#invoice-electronic-email-unit").val();a=$("#elecEmailError-unit");$WayTips=$("#showEmail-unit-tips span")}if(f!=""){var c=/^(\w)+(\.\w+)*@(\w)+((\.[a-zA-Z]+)+)$/;var b=c.test(f);if(!b){a.text("\u90ae\u7bb1\u683c\u5f0f\u4e0d\u6b63\u786e");$WayTips.show();if(!a.hasClass("eWayErro")){a.addClass("eWayErro")}return false}else{a.text("");$WayTips.show();if(a.hasClass("eWayErro")){a.removeClass("eWayErro")}return true}}if(f==""){a.text("");$WayTips.hide();if(a.hasClass("eWayErro")){a.removeClass("eWayErro")}return true}};ec.order.newSendShow=function(d){var b=$("#order-shopCode").val();var a=InvoiceManager.invoiceCfgList[b].electronicReceiveMode;for(var c=0;c<a.length;c++){if(a[c]=="P"){if(d=="P"){$("#showPhone-person-tips").show();$("#showPhone-person-content").show()}else{$("#showPhone-unit-tips").show();$("#showPhone-unit-content").show()}}else{if(d=="P"){$("#showEmail-person-tips").show();$("#showEmail-person-content").show()}else{$("#showEmail-unit-tips").show();$("#showEmail-unit-content").show()}}}};ec.order.showSendWayWhat=function(a){if($(a).val()!=null&&$(a).val()!=""){$(a).parent().prev().children().show()}else{$(a).parent().prev().children().hide()}};ec.order.invoice.inputChange=function(){$("#invoice_next_step").attr("typePage","7")};ec.order.invoice.selectWhich=function(){if($("#invoice_next_step").attr("typePage")==7){ec.order.invoice.popup.select(7)}else{ec.order.invoice.popup.select(4)}};ec.order.invoice.guideToSpecialVat=function(b){var a;var c;if(InvoiceManager.isUneffective($("#order-shopCode").val(),3)){return}if(!InvoiceManager.isEffective($("#order-shopCode").val(),"3")){return}if(b==1){a=$("#invoice-normal-taxpayerIdentityNum");c=a.val();if(!ec.form.validator($("#invoice-normal-taxpayerIdentityNum"),true)){return}}else{a=$("#invoice-electronic-taxpayerIdentityNum");c=a.val();if(!ec.form.validator($("#invoice-electronic-taxpayerIdentityNum"),true)){return}}setTimeout(function(){new ec.ajax().get({url:"/invoice/queryTaxNum.json",data:{taxNum:c},timeout:10000,successFunction:function(d){if(d.success){if(d.msg!="noTips"){a.siblings().html(ec.encodeForHTML(d.msg));if(!a.siblings().hasClass("report-errors")){a.siblings().addClass("report-errors")}}}}})},300)};ec.order.invoice.getAllTaxNumber=function(){var b="";for(var a=0;a<InvoiceManager.shopCodeList.length;a++){if($("#order-titleType"+InvoiceManager.shopCodeList[a]).val()=="1"||$("#order-titleType"+InvoiceManager.shopCodeList[a]).val()=="2"||$("#order-titleType"+InvoiceManager.shopCodeList[a]).val()=="50"){if((!InvoiceManager.isUneffective(InvoiceManager.shopCodeList[a],3))&&(InvoiceManager.isEffective(InvoiceManager.shopCodeList[a],"3"))){if($("#order-taxpayerIdentityNum"+InvoiceManager.shopCodeList[a]).val()!=""&&$("#order-taxpayerIdentityNum"+InvoiceManager.shopCodeList[a]).val()!=null){b+=$("#order-taxpayerIdentityNum"+InvoiceManager.shopCodeList[a]).val()+"|"}}}}return b};
