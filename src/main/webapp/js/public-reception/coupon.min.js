ec.pkg("ec.product.remark");
ec.load("ajax");
ec.load("ec.box", {loadType: "lazy"});
ec.remark = {};
ec.remark.prefix = domainRms + "/comment";
var loadEvaluate = false;
var bFirstLoadEvaluate = false;
var pageSize = 10;
ec.product.remark.loadEvaluate = function (a) {
    $.ajax({
        url: openApiDomain + "/rms/comment/getCommentList.json?t=" + new Date().getTime(),
        data: JSON.stringify({
            pid: ec.product.id,
            type: a.type ? a.type : 0,
            extraType: a.extraType ? a.extraType : 1,
            pageSize: pageSize,
            pageNum: a.pageNumber
        }),
        type: "POST",
        dataType: "json",
        beforeSend: function (b) {
            b.withCredentials = true
        },
        success: function (r) {
            if (r.resultCode != "0") {
                commentFlag = true;
                $("#pro-tab-evaluate").hide();
                return
            }
            if (!r.data.comments || r.data.comments.length == 0) {
                commentFlag = true;
                $("#pro-tab-evaluate span").text("(" + r.data.count + ")");
                $("#pro-tab-evaluate").show();
                $("#pro-msg-list").hide();
                $("#pro-msg-pager").hide();
                $("#evaluatePageNumber").hide();
                if (a.extraType == "0" && r.data.defaultGoodCount != null && r.data.defaultGoodCount > 0) {
                    $("#product-remark-comment-no").html(+r.data.defaultGoodCount + "\u4f4d\u7528\u6237\u8fdb\u884c\u4e86\u9ed8\u8ba4\u597d\u8bc4")
                } else {
                    $("#product-remark-comment-no").html("\u8be5\u5546\u54c1\u6682\u65e0\u8bc4\u4ef7")
                }
                $("#product-remark-comment-no").show();
                return
            }
            commentFlag = false;
            $("#pro-tab-evaluate-content").show();
            $("#productCommentId").show();
            $("#pro-tab-evaluate").show();
            $("#product-remark-comment-no").hide();
            loadEvaluate = true;
            var f = [], b, o;
            for (var e = 0; e < r.data.comments.length; e++) {
                b = r.data.comments[e];
                f.push('<li class="clearfix"><div class="product-comment-user"><p class="product-comment-user-img">');
                var m = imagePath + "/echannel/misc/defaultface_user_small.png";
                if (b.headImage && $.trim(b.headImage) != "") {
                    m = b.headImage
                }
                f.push('<img src="' + ec.encodeForHTML(m) + '" alt="' + ec.encodeForHTML(m) + '">');
                var c = b.gradeCode == null ? 0 : b.gradeCode;
                f.push('<i class="icon-vip-level-' + c + '"></i></p>');
                f.push('<p class="product-comment-user-name">' + ec.util.escapeHtml(b.userName) + "</p></div>");
                f.push('<div class="product-user-comment"><div class="product-user-comment-detial"><div class="h clearfix">');
                f.push('<div class="product-star"><span class="starRating-area"><s style="width:' + (b.score * 20) + '%"></s></span>');
                f.push('</div><div class="product-user-comment-impress">');
                f.push("<dl>");
                for (var d = 0; d < b.tags.length; d++) {
                    f.push("<dd>" + ec.util.escapeHtml(b.tags[d]) + "</dd>")
                }
                f.push("</dl></div>");
                var n = b.likes;
                if (!n || n == null || $.trim(n) == "") {
                    n = 0
                }
                f.push('<div class="fr"><a href="javascript:;" class="product-praise-btn" pid="' + b.productId + '" commentId="' + b.commentId + '" type="0"><span>' + parseInt(n) + "</span></a></div>");
                f.push("</div>");
                f.push('<div class="product-user-comment-word" id="' + b.productId + "-" + b.commentId + '">');
                f.push((ec.util.escapeHtml(b.content) || ""));
                f.push("</div>");
                if (b.images.length > 0) {
                    f.push('<div class="user-comment-img">                           ');
                    f.push('	<p class="img-small clearfix">                                  ');
                    for (var d = 0; d < b.images.length; d++) {
                        var h = b.images[d];
                        f.push('<a href="javascript:;" ' + ec.remark.common.privewMin() + ' class="img-wrap" ><img id="' + h.id + '" image-large="' + ec.encodeForHTML(h.large) + '" src="' + ec.encodeForHTML(h.small) + '"></a> ')
                    }
                    f.push("	</p>                                                         ");
                    f.push('	<div class="clearfix">                                       ');
                    f.push(ec.remark.common.privewImg("view"));
                    f.push("	</div>                                                       ");
                    f.push("</div>                                                        ")
                }
                f.push('<div class="product-user-comment-time">');
                f.push(b.creationTime.substring(0, 19));
                f.push("</div></div>");
                f.push('<div class="product-reply">');
                f.push('<div class="product-reply-detail" replyCount=' + b.replyCount + ">");
                for (var d = 0; d < b.replies.length; d++) {
                    o = b.replies[d];
                    f.push('<div class="product-admin-reply clearfix" >');
                    f.push('<div class="admin-user-img">');
                    f.push('<img src="' + (ec.util.escapeHtml(o.headImage) || "") + '">');
                    f.push("</div>");
                    f.push("<dl>");
                    f.push('<dt class="red">' + (ec.util.escapeHtml(o.replyerName) || "") + "</dt>");
                    f.push("<dd>" + (ec.util.escapeHtml(o.replyContent) || "") + "</dd>");
                    var l = o.likes;
                    if (!l || l == null || $.trim(l) == "") {
                        l = 0
                    }
                    f.push('<dd><a href="javascript:;" class="product-admin-praise-btn" pid="' + b.productId + '" commentId="' + b.commentId + '" replyId="' + o.replyId + '" type="1">\u8d5e\u5ba2\u670d\uff08<span>' + parseInt(l) + "</span>\uff09</a><dd>");
                    f.push("</dl></div>")
                }
                if (b.replyCount > 3) {
                    f.push('<div class="product-reply-btn"><a target="_blank" href="/product/viewReply/' + b.productId + "/" + b.commentId + "?t=" + new Date().getTime() + '">\u67e5\u770b\u5168\u90e8<span>' + b.replyCount + "</span>\u6761\u56de\u590d</a></div>")
                } else {
                    f.push('<div class="product-reply-btn" style="display:none;"><a target="_blank" href="/product/viewReply/' + b.productId + "/" + b.commentId + "?t=" + new Date().getTime() + '">\u67e5\u770b\u5168\u90e8<span>' + b.replyCount + "</span>\u6761\u56de\u590d</a></div>")
                }
                f.push("</div>");
                f.push("</div></li>")
            }
            if (a.extraType == "0") {
                if (r.data.defaultGoodCount != null && r.data.defaultGoodCount > 0 && r.data.page.pageNum == r.data.page.totalPage) {
                    f.push('<div class="product-comment-default">\u8fd8\u6709<span>' + r.data.defaultGoodCount + "</span>\u4f4d\u7528\u6237\u7ed9\u4e86\u9ed8\u8ba4\u597d\u8bc4</div>")
                }
            }
            var g = $("#pro-msg-list");
            g.html(f.join(""));
            if (r.data.comments.length == 0) {
                g.hide();
                $("#product-remark-comment-no").show()
            } else {
                g.show()
            }
            $("#pro-tab-evaluate span").text("(" + r.data.count + ")");
            if (r.data.page.totalPage > 1) {
                $("#pro-msg-pager").show();
                $("#pro-msg-pager").pager({
                    pageNumber: r.data.page.pageNum,
                    pageCount: r.data.page.totalPage,
                    recordCount: r.data.page.totalRow,
                    type: 0,
                    extraType: a.extraType ? a.extraType : 1,
                    qpageSize: 10,
                    text: {first: "|&lt;", pre: "&lt", next: "&gt;", last: "&gt;|"},
                    item: ["first", "pre", "qpage", "next", "last", "quickPager"],
                    callBack: ec.product.remark.loadEvaluate
                })
            } else {
                $("#pro-msg-pager").hide()
            }
            $("#pro-msg-pager li.link").live("click", function () {
                $("html,body").animate({scrollTop: $("#pro-tab-evaluate-content").offset().top - $("#product-tab").height()}, 100)
            });
            $(".product-admin-praise-btn,.product-praise-btn").bind("click", function () {
                ec.product.remark.likes($(this))
            });
            $("#pro-msg-list li").each(function () {
                var u = $(this), i = 0, t = $(this).find(".img-wrap"), j = $(this).find(".img-big img"),
                    v = $(this).find(".img-big"), s = $(this).find(".cursor-prev"), p = $(this).find(".cursor-next");
                if (t.length) {
                    t.click(function () {
                        var w = $(this).find("img").attr("image-large");
                        i = $(this).index();
                        v.removeClass("none");
                        t.eq(i).addClass("selected").siblings().removeClass("selected");
                        q(t, j, i);
                        k(i, t.length, s, p)
                    });
                    $(this).bind("click", function (x) {
                        var w = x.target.className.split(" ")[0];
                        switch (w) {
                            case"cursor-small":
                                $(this).find(".img-big").addClass("none");
                                t.removeClass("selected");
                                i = 0;
                                break;
                            case"cursor-prev":
                                i <= 0 ? 0 : --i;
                                t.eq(i).addClass("selected").siblings().removeClass("selected");
                                q(t, j, i);
                                k(i, t.length, s, p);
                                break;
                            case"cursor-next":
                                i >= t.length - 1 ? t.length - 1 : ++i;
                                t.eq(i).addClass("selected").siblings().removeClass("selected");
                                q(t, j, i);
                                k(i, t.length, s, p);
                                break;
                            default:
                                break
                        }
                    })
                }
            });

            function q(i, j, p) {
                var s = i.eq(p).find("img").attr("image-large");
                j.attr("src", s)
            }

            function k(p, i, j, s) {
                p == i - 1 ? s.hide() : s.show();
                p == 0 ? j.hide() : j.show()
            }
        },
        error: function () {
            commentFlag = true;
            $("#pro-tab-evaluate-content").hide();
            $("#productCommentId").hide();
            $("#pro-tab-evaluate").hide();
            $(".product-comment-tab").hide()
        }
    })
};
ec.product.remark.loadEvaluateScore = function () {
    $.ajax({
        url: openApiDomain + "/rms/comment/getCommentScore.json?t=" + new Date().getTime(),
        type: "POST",
        dataType: "json",
        data: JSON.stringify({pid: ec.product.id}),
        beforeSend: function (a) {
            a.withCredentials = true
        },
        success: function (c) {
            if (c && c.resultCode == "0" && c.data) {
                if (c.data.goodRate) {
                    $("#pro-evaluate-avgSorce").html(parseInt(c.data.goodRate * 100) + "<em>%</em>")
                }
                if (c.data.hotTags) {
                    var d = [];
                    for (var b = 0; b < c.data.hotTags.length; b++) {
                        var e = c.data.hotTags[b];
                        if (e.count > 0) {
                            var a = '<li><a href="javascript:;"><em>' + ec.encodeForHTML(e.tagName) + "</em><span>" + e.count + "</span></a></li>";
                            d.push(a)
                        }
                    }
                    $("#pro-score-impress").html(d.join(""))
                }
            } else {
                return
            }
        }
    })
};
ec.product.remark.bindEvent = function () {
    $(".product-comment-tab").find("a").bind("click", function () {
        var a = $(this).attr("extraType");
        $(this).parent().addClass("current").siblings().removeClass("current");
        ec.product.remark.loadEvaluate({pageNumber: 1, type: 0, extraType: a})
    })
};
ec.product.remark.likes = function (e) {
    var d = e.attr("pid");
    var b = e.attr("commentId");
    var a = e.attr("replyId");
    var c = e.attr("type");
    $.ajax({
        url: openApiDomain + "/rms/comment/like.json?t=" + new Date().getTime(),
        type: "POST",
        data: JSON.stringify({pid: d, commentId: b, replyId: a, type: c}),
        dataType: "json",
        beforeSend: function (f) {
            f.withCredentials = true;
            f.setRequestHeader("CsrfToken", csrftoken)
        },
        success: function (h) {
            if (h && h != undefined && h.resultCode) {
                var g = h.resultCode;
                switch (g) {
                    case"0":
                        var f = e.find("span").text();
                        e.find("span").text(parseInt(f) + 1);
                        e.addClass("click");
                        e.unbind("click");
                        break;
                    case"42003":
                        ec.account.loginName = "";
                        ec.account.afterLogin(function () {
                            ec.product.remark.likes(e)
                        });
                        break;
                    case"60008":
                        ec.product.remark.showErrorMsg();
                        break;
                    default:
                        break
                }
                return
            }
        }
    })
};
ec.product.remark.loadProductInfoEvaluateScore = function () {
    $.ajax({
        url: openApiDomain + "/rms/comment/getCommentCount.json",
        type: "POST",
        dataType: "json",
        data: JSON.stringify({pid: ec.product.id}),
        beforeSend: function (a) {
            a.withCredentials = true
        },
        success: function (a) {
            if (a && a != undefined && a.resultCode == "0" && a.data) {
                $("#prd-remark-scoreAverage").attr("style", "width:" + (a.data.averageScore * 20) + "%");
                $("#prd-remark-scoreAverage").show();
                $("#prd-remark-jmptoremark").attr("title", "\u5171 " + a.data.count + " \u6761\u8bc4\u8bba");
                $("#prd-remark-jmptoremark").text("\u5171&nbsp;" + a.data.totalPrdCount + "&nbsp;\u6761\u8bc4\u8bba");
                $("#prd-remark-jmptoremark").show();
                $("#prd-remark-span-tab-evaluate").html("\u7528\u6237\u8bc4\u4ef7<em>\uff08" + a.data.totalPrdCount + "\uff09</em>");
                $("#prd-remark-span-tab-evaluate").show()
            }
        }
    })
};
ec.product.remark.showErrorMsg = function () {
    var a = [];
    a.push('<div class="box-errors-1">');
    a.push("<span>\u4e0d\u80fd\u91cd\u590d\u70b9\u8d5e</span>");
    a.push("</div>");
    a.push('<div class="box-button"><a href="javascript:;" class="box-ok"><span>\u786e\u5b9a</span></a></div>');
    var b = new ec.box(a.join(""), {
        boxid: "box_reply_error_msg",
        boxclass: "ol_box_4 small",
        title: "",
        showButton: false,
        onopen: function (c) {
            c.setPosition()
        },
        onok: function (c) {
            c.close()
        },
        onclose: function () {
        }
    }).open()
};
ec.pkg("ec.product.addReply");
ec.load("ajax");
ec.load("ec.box", {loadType: "lazy"});
ec.product.addReply.addCheck = function (b) {
    ec.product.addReply.productId = $(b).attr("productId");
    ec.product.addReply.commentId = $(b).attr("commentId");
    ec.product.addReply.type = $(b).attr("type");
    ec.product.addReply.content = $.trim($("#reply-" + ec.product.addReply.commentId).val());
    if (!ec.product.addReply.checkIllegalChar(ec.product.addReply.content)) {
        ec.product.addReply.showErrorMsg("\u56de\u590d\u5185\u5bb9\u4e0d\u80fd\u5305\u542b\u201c[]><&#\u201d\u7b49\u7279\u6b8a\u5b57\u7b26");
        return
    }
    var a = ec.product.addReply.length($.trim($("#reply-" + ec.product.addReply.commentId).val()));
    if (a > 600) {
        ec.product.addReply.showErrorMsg("\u8bc4\u8bba\u6700\u591a\u4e0d\u80fd\u8d85\u8fc7600\u4e2a\u5b57\u7b26");
        return
    }
    if (a == 0) {
        ec.product.addReply.showErrorMsg("\u56de\u590d\u4e0d\u80fd\u4e3a\u7a7a");
        return
    }
    ec.product.addReply.add(ec.product.addReply.productId, ec.product.addReply.commentId, ec.product.addReply.type)
};
ec.product.addReply.add = function (c, a, b) {
    $.ajax({
        url: openApiDomain + "/rms/comment/saveReply.json?t=" + new Date().getTime(),
        type: "POST",
        data: JSON.stringify({productId: c, commentId: a, userClient: 1, content: ec.product.addReply.content}),
        dataType: "json",
        timeout: 10000,
        beforeSend: function (d) {
            ec.ui.loading.show;
            d.withCredentials = true;
            d.setRequestHeader("CsrfToken", csrftoken)
        },
        success: function (e) {
            if (e != "" && e != undefined) {
                var d = ec.product.addReply.result(e, true);
                if (d.result) {
                    ec.product.addReply.showErrorMsg("\u56de\u590d\u6210\u529f", 1)
                } else {
                    ec.ui.loading.hide();
                    if (d.code == "42003") {
                        ec.account.loginName = ec.util.cookie.set("ac_loNa", null, {domain: ".vmall.com"});
                        ec.account.afterLogin(function () {
                            ec.product.addReply.add(c, a, b)
                        })
                    } else {
                        ec.product.addReply.showErrorMsg(d.msg);
                        return
                    }
                }
            } else {
                ec.product.addReply.showErrorMsg("\u6dfb\u52a0\u56de\u590d\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5");
                return
            }
        },
        error: function () {
            ec.product.addReply.showErrorMsg("\u6dfb\u52a0\u56de\u590d\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5");
            return
        }
    });
    $("#reply-" + a).val("")
};
ec.product.addReply.showErrorMsg = function (e, d) {
    var a = [];
    a.push('<div id="pro-add-success-mask" style="visibility:hidden;font-size:18px;width:348px;position: absolute;"></div>');
    var c = ec.product.addReply.compute($("#pro-add-success-mask"), e);
    if (d != null) {
        a.push('<div class="box-right-1">')
    } else {
        if (c.h > 27) {
            a.push('<div class="box-errors-2">')
        } else {
            a.push('<div class="box-errors-1">')
        }
    }
    a.push("<span>" + e + "</span>");
    a.push("</div>");
    a.push('<div class="box-button"><a href="javascript:;"  class="box-ok"><span>\u786e\u5b9a</span></a></div>');
    var b = new ec.box(a.join(""), {
        boxid: "box_reply_error_msg",
        boxclass: "ol_box_4 small",
        title: "",
        showButton: false,
        onopen: function (f) {
            f.setPosition()
        },
        onok: function (f) {
            f.close();
            if (d != null) {
                ec.product.addReply.addComment()
            }
        },
        onclose: function () {
        }
    }).open()
};
ec.product.addReply.compute = function (b, a) {
    b.text(a);
    return {w: b[0].offsetWidth, h: b[0].offsetHeight}
};
ec.product.addReply.result = function (e, b) {
    var d = {};
    var a = false;
    var f = "";
    var c = "";
    if (e != "" && e != undefined) {
        c = e.resultCode;
        switch (c) {
            case"0":
                a = true;
                break;
            case"42003":
                f = "\u7cfb\u7edf\u7e41\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5";
                break;
            case"42005":
                f = "\u7cfb\u7edf\u7e41\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5";
                break;
            case"42019":
                f = "\u7cfb\u7edf\u7e41\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5";
                break;
            case"60043":
                f = "\u56de\u590d\u5df2\u8d85\u8fc7\u6700\u957f\u5b57\u6570\u9650\u5236";
                break;
            case"60044":
                f = "\u56de\u590d\u5185\u5bb9\u4e0d\u80fd\u5305\u542b\u201c[]><&#\u201d\u7b49\u7279\u6b8a\u5b57\u7b26";
                break;
            case"60048":
                f = "\u60a8\u56de\u590d\u7684\u6b21\u6570\u8d85\u8fc7\u9650\u5236\uff0c\u65e0\u6cd5\u518d\u6b21\u56de\u590d";
                break;
            case"60049":
                f = "\u60a8\u53d1\u5e03\u4e0d\u5f53\u8a00\u8bba\u8fc7\u591a\uff0c\u88ab\u7981\u6b62\u53d1\u5e03\u56de\u590d";
                break;
            case"42019":
                f = "\u7cfb\u7edf\u7e41\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5";
                break;
            case"50999":
                f = "\u7cfb\u7edf\u7e41\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5";
                break;
            default:
                f = "\u7cfb\u7edf\u7e41\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5";
                break
        }
    } else {
        f = "\u7cfb\u7edf\u7e41\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5"
    }
    d.result = a;
    d.msg = f;
    d.code = c;
    return d
};
ec.product.addReply.length = function (d) {
    var a = 0;
    var b = d.length;
    var c = -1;
    for (var e = 0; e < b; e++) {
        c = d.charCodeAt(e);
        if (c >= 0 && c <= 128) {
            a += 1
        } else {
            a += 2
        }
    }
    return a
};
ec.product.addReply.getUserHeadUrl = function () {
    var a;
    new ec.ajax().get({
        url: domainMain + "/member/accountInfo.json",
        dataType: "json",
        timeout: 10000,
        async: false,
        timeoutFunction: function () {
            alert("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")
        },
        successFunction: function (b) {
            if (!b.success && b.code == "login") {
                ec.account.loginName = "";
                ec.account.afterLogin(function () {
                })
            } else {
                if (b.customerInfo.headPictureURL) {
                    a = b.customerInfo.headPictureURL
                } else {
                    a = imagePath + "/echannel/misc/img_logged_in.png"
                }
            }
        },
        error: function () {
            alert("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")
        }
    });
    return a
};
ec.product.addReply.addComment = function () {
    var b = $("#reply-" + ec.product.addReply.commentId).closest("li").find(".product-reply-detail");
    var e = 0;
    var d = ec.product.addReply.getUserHeadUrl();
    if (ec.util.isEmpty(d) || d == undefined) {
        d = imagePath + "/echannel/misc/img_logged_in.png"
    }
    e = b.children().find(".red").length;
    var c = '<div class="product-admin-reply clearfix"><div class="admin-user-img"><img src="' + ec.encodeForHTML(d) + '"></div><dl><dt>' + ec.encodeForHTML(ec.account.loginName) + "</dt><dd>" + ec.encodeForHTML(ec.product.addReply.content) + "</dd></dl></div>";
    var a = b.attr("replyCount");
    a = parseInt(a) + 1;
    b.attr("replyCount", a);
    if (ec.product.addReply.type == "remark") {
        b.find(".product-reply-btn span").text(a);
        if (a > 3) {
            if (b.find(".product-reply-btn").size() == 0) {
                $(b.children()[2]).after('<div class="product-reply-btn"><a target="_blank" href="/product/viewReply/' + ec.product.addReply.productId + "/" + ec.product.addReply.commentId + "?t=" + new Date().getTime() + '">\u67e5\u770b\u5168\u90e8<span>' + a + "</span>\u6761\u56de\u590d</a></div>")
            } else {
                b.find(".product-reply-btn").show()
            }
        }
        if (e < 3) {
            if (b.children().length > 2) {
                $(b.children()[2]).remove()
            }
            if (e == 0) {
                b.prepend(c)
            } else {
                $(b.children()[e - 1]).after(c)
            }
        }
    } else {
        if (e == 0) {
            b.prepend(c)
        } else {
            $(b.children()[e - 1]).after(c)
        }
    }
};
ec.product.addReply.checkIllegalChar = function (b) {
    var a = /(\[|\]|>|<|\\|"|&|#|')/;
    if (b != "" && b != null && a.test(b)) {
        return false
    }
    return true
};
ec.pkg("ec.remark.common");
ec.load("ajax");
ec.load("ec.box", {loadType: "lazy"});
var _remarkPrivate = {
    showError: function (b, a) {
        $("#error-area-" + a).show();
        $("#error-area-" + a).find("label").empty().html(b)
    }, hideError: function (a) {
        $("#error-area-" + a).hide()
    }, getSelectedLen: function (a) {
        return $("#tags-" + a).find(".selected").length
    }, getSelectedDiyLen: function (a) {
        return $("#tags-" + a).find(".tag-li-diy-item.selected").length
    }, checkTagNameRepeat: function (b, e) {
        var f = $("#tags-" + b).find("li .impress").find("a");
        var d = [];
        for (var c = 0; c < f.length; c++) {
            var a = f[c].text;
            if (a != "\u81ea\u5b9a\u4e49") {
                d.push(a)
            }
        }
        return $.inArray(e, d)
    }, check: function (a) {
        this.hideError(a);
        var b = ec.util.trim($("#tag-input-" + a).val());
        if (b.length == 0) {
            this.showError("\u8f93\u5165\u4e0d\u80fd\u4e3a\u7a7a", a);
            return false
        }
        if (/\s/.test(b)) {
            this.showError("\u6807\u7b7e\u4e2d\u4e0d\u53ef\u4ee5\u6709\u7a7a\u683c", a);
            return false
        }
        if (b.len() >= 13) {
            this.showError("\u6807\u7b7e\u4e0d\u53ef\u4ee5\u8d85\u8fc76\u4e2a\u6c49\u5b57", a);
            return false
        }
        return true
    }
};
ec.remark.common.checkSeletedTagNum = function (e, c, d) {
    var a = _remarkPrivate.getSelectedDiyLen(c);
    var f = _remarkPrivate.getSelectedLen(c);
    if (a >= 4 && !$(e).hasClass("selected")) {
        var b = true;
        switch (d) {
            case"tagOnclick":
                if (a == 4 && $(e).hasClass("tag-li-diy-item")) {
                    b = false
                } else {
                    if (f < 5) {
                        b = true
                    } else {
                        b = false
                    }
                }
                break;
            case"addTag":
                b = false;
                break;
            case"diyOnclick":
                if ($(e).hasClass("tag-li-diy-item")) {
                    b = false
                }
                break;
            default:
                b = false;
                break
        }
        if (!b) {
            if (f >= 5) {
                _remarkPrivate.showError("\u6700\u591a\u8d345\u4e2a\u6807\u7b7e\uff0c\u4f60\u5df2\u7ecf\u8d34\u6ee1\u4e86", c)
            } else {
                _remarkPrivate.showError("\u6700\u591a\u8d344\u4e2a\u81ea\u5b9a\u4e49\u6807\u7b7e\uff0c\u4f60\u5df2\u7ecf\u8d34\u6ee1\u4e86", c)
            }
        }
        return b
    }
    if (f >= 5 && !$(e).hasClass("selected")) {
        _remarkPrivate.showError("\u6700\u591a\u8d345\u4e2a\u6807\u7b7e\uff0c\u4f60\u5df2\u7ecf\u8d34\u6ee1\u4e86", c);
        return false
    }
    return true
};
ec.remark.common.tagOnclick = function (c) {
    var a = $(c).parent().attr("data-sku");
    if (ec.remark.common.checkSeletedTagNum(c, a, "tagOnclick")) {
        _remarkPrivate.hideError(a);
        $(c).toggleClass("selected");
        var b = $(c).find("input")[0];
        if (b) {
            if (b.checked) {
                b.checked = false
            } else {
                b.checked = true
            }
        }
    }
};
ec.remark.common.diyOnclick = function (b) {
    var a = $(b).parent().parent().parent().attr("data-sku");
    if (ec.remark.common.checkSeletedTagNum(b, a, "diyOnclick")) {
        $("#diy-area-" + a).addClass("current")
    }
};
ec.remark.common.addTag = function (e, a) {
    if (ec.remark.common.checkSeletedTagNum(e, a, "addTag") && _remarkPrivate.check(a)) {
        var d = ec.util.trim($("#tag-input-" + a).val());
        var c = _remarkPrivate.checkTagNameRepeat(a, d);
        if (c >= 0) {
            _remarkPrivate.showError("\u60a8\u8f93\u5165\u7684\u6807\u7b7e\u540d\u79f0\u5df2\u7ecf\u5b58\u5728", a);
            return
        } else {
            _remarkPrivate.hideError()
        }
        var b = [];
        b.push('<li class="ce-post-impress-item tag-li-diy-item selected" onclick="ec.remark.common.tagOnclick(this);">');
        b.push('<div class="impress">');
        b.push('<input type="checkbox" checked="true" name="diyTags-' + a + '" style="visibility: hidden; position: absolute;" value="' + ec.util.escapeHtml(d) + '" id="diyTags">');
        b.push('<a href="javascript:;" id="diyTags-a-' + a + '">' + ec.util.escapeHtml(d) + "</a><s></s></div></li>");
        $("#diy-area-" + a).before(b.join(""));
        $("#tag-input-" + a).val("");
        if (_remarkPrivate.getSelectedLen() >= 5) {
            $("#diy-area-" + a).removeClass("current")
        }
    }
};
ec.remark.common.login = function (a) {
    ec.account.afterLogin(function () {
        if (a) {
            a()
        }
    })
};
ec.remark.common.showErrorMsg = function (e, a) {
    if (!e || $.trim(e) == "") {
        e = ""
    }
    var c = '<a href="javascript:;" class="box-cancel"><span>\u786e\u5b9a</span></a>';
    switch (a) {
        case 1:
            c = '<a href="javascript:;" class="box-cancel"><span>\u786e\u5b9a</span></a>';
            break;
        case 2:
            c = '<a href="/member/prdRemarkView?t=' + (new Date()).getTime() + '" class="box-cancel" ><span>\u6211\u4e0d\u6539\u4e86</span></a><a href="' + serviceRobotim + '" target="_blank" class="box-ok"><span>\u8054\u7cfb\u5ba2\u670d</span></a>';
            break;
        default:
            c = '<a href="javascript:;" class="box-cancel"><span>\u786e\u5b9a</span></a>';
            break
    }
    var b = [];
    b.push('<div class="box-content" style="height: auto;">                                                         ');
    b.push('	<div class="box-prompt01-error">                                                                       ');
    b.push('		<div class="h">                                                                                    ');
    b.push("			<i></i>                                                                                        ");
    b.push("		</div>                                                                                             ");
    b.push('		<div class="b">                                                                                    ');
    b.push('			<p id="comments-msg-' + a + '">' + e + "</p>                                            ");
    b.push("		</div>                                                                                             ");
    b.push("	</div>                                                                                                 ");
    b.push('	<div class="box-button">                                                                               ');
    b.push(c);
    b.push("	</div>                                                                                                 ");
    b.push("</div>                                                                                                  ");
    var d = new ec.box(b.join(""), {
        boxid: "box_remark_tips_common_message",
        boxclass: "ol_box_4",
        showButton: false,
        showTitle: true,
        showCancel: false,
        showOk: false,
        width: 600,
        onclose: function (f) {
        },
        onopen: function (f) {
        },
        onok: function (f) {
        }
    });
    d.open()
};
ec.remark.common.privewImg = function (a) {
    var b = [];
    b.push('		<div class="img-big none">                       ');
    if ("view" != a) {
        b.push('        <a href="javascript:;" class="comment-img-delete">\u5220\u9664</a>')
    }
    b.push('			<img src="">                                 ');
    b.push('			<div class="cursor-prev" style="cursor:url(' + imagePath + '/echannel/icon/arrow-left.cur),auto;"></div>              ');
    b.push('			<div class="cursor-small" style="cursor:url(' + imagePath + '/echannel/icon/zoom-out.cur),auto;"></div>             ');
    b.push('			<div class="cursor-next" style="cursor:url(' + imagePath + '/echannel/icon/arrow-right.cur),auto;"></div>              ');
    b.push("		</div>                                           ");
    return b.join("")
};
ec.remark.common.privewMin = function () {
    return 'style="cursor:url(' + imagePath + '/echannel/icon/zoom-in.cur),auto;"'
};
ec.remark.common.check = function (a, e) {
    var b = false;
    var d = $("#tags-" + a);
    var f = $.trim($("#score-" + a).attr("data-score"));
    var c = $.trim($("#content-" + a).val());
    if (500 < c.length) {
        $("#commodity-content-msg-" + a).html("\u8bc4\u8bba\u6700\u591a\u4e0d\u80fd\u8d85\u8fc7500\u4e2a\u5b57\u54e6").css("display", "block");
        return false
    }
    if (!ec.remark.common.checkIllegalChar(c)) {
        $("#commodity-content-msg-" + a).html("\u60a8\u63d0\u4ea4\u7684\u8bc4\u8bba\u5305\u542b[]><\"&#'\u7b49\u7279\u6b8a\u5b57\u7b26,\u8bf7\u4fee\u6539").css("display", "block");
        return false
    }
    e.push(a);
    return true
};
ec.remark.common.checkIllegalChar = function (b) {
    var a = /(\[|\]|>|<|\\|"|&|#|')/;
    if (b != "" && b != null && a.test(b)) {
        return false
    }
    return true
};
ec.pkg("ec.product");
ec.load("ajax");
ec.load("ec.box", {loadType: "lazy"});
ec.load("ec.index");
ec.load("cloud-zoom", function () {
    setTimeout(function () {
        $("#product-img").CloudZoom()
    }, 200)
});
ec.load("ec.product.gift");
ec.load("ec.product.coupon");
ec.load("rush");
ec.load("deposit");
ec.load("jquery.fixed", function () {
    $(function () {
        $("#pro-tab-all").fixed()
    })
});
ec.ui.countdown2 = function (selector, options) {
    var obj = $(selector), timer = obj.data("countdown"), timeIndex = 0, preTarget, diff,
        diffMs = options.now.getTime() - (new Date).getTime(), diffSecs = 0, getNext = function () {
            if (timeIndex >= options.times.length) return false;
            preTarget = options.times[timeIndex];
            timeIndex++;
            return true
        }, getDiffSec = function () {
            diffSecs = Math.round((preTarget.parseDate("yyyy-MM-dd HH:mm:ss").getTime() - (new Date).getTime() - diffMs) / 1e3);
            diffSecs = diffSecs <= 0 ? 0 : diffSecs;
            return diffSecs
        }, render = function () {
            diffSecs--;
            if (diffSecs <= 0) {
                diffSecs = 0
            }
            diff = {
                day: Math.floor(diffSecs / (24 * 60 * 60)),
                hour: options.html.indexOf("{#day}") >= 0 ? Math.floor(diffSecs / 60 / 60) % 24 : Math.floor(diffSecs / 60 / 60),
                minute: Math.floor(diffSecs / 60) % 60,
                second: diffSecs % 60
            };
            var html = options.html.replace(/{#day}/g, diff.day > 9 ? diff.day : "0" + diff.day).replace(/{#hours}/g, diff.hour > 9 ? diff.hour : "0" + diff.hour).replace(/{#minutes}/g, diff.minute > 9 ? diff.minute : "0" + diff.minute).replace(/{#seconds}/g, diff.second > 9 ? diff.second : "0" + diff.second);
            obj.html(html);
            return diffSecs <= 0 ? false : true
        };
    if (!options.times) {
        options.times = [options.endTime]
    }
    clearInterval(timer);
    while (getNext()) {
        if (getDiffSec() <= 0) continue;
        break
    }
    if (!render()) {
        return
    }
    timer = setInterval(function () {
        if (!render()) {
            if (options.callback) {
                options.callback(options)
            }
            if (!getNext()) {
                clearInterval(timer)
            } else {
                getDiffSec()
            }
        }
    }, 1e3);
    obj.data("countdown", timer)
};
var detailContentHeigh = 0;
var productParameterHeight = 0;
var packageServiceHeight = 0;
var customerServiceHeight = 0;
var tit1 = 0;
var tit2 = 0;
var tit3 = 0;
var tit4 = 0;
var oTop = 0;
var clickFlag = false;
var packFlag = false;
var commentFlag = false;
var scollFlag = false;
var upDownButton = "";
var finished = true;
ec.product.packageList = {};
ec.product.warranty = {};
var playerArray = [];
$(function () {
    $(window).resize(function () {
        var sku = ec.product.getSku();
        var json = ec.product.getSkuInfo(sku);
        if (upDownButton == "true") {
            $("#pro-detail-content-" + json.id).height($("#kindPicture-" + json.id).height() + $("#pro-detail-up-btn-" + json.id).height() + 40)
        }
        if ($("#kindPicture-" + json.id).height() <= 2e3) {
            $("#pro-detail-content-" + json.id).height($("#kindPicture-" + json.id).height());
            $("#detail-content-button-" + json.id).hide();
            $("#pro-detail-up-btn-" + json.id).css("display", "none")
        } else {
            if (upDownButton == "true") {
                $("#detail-content-button-" + json.id).hide();
                $("#pro-detail-up-btn-" + json.id).css("display", "block")
            } else if (upDownButton == "false") {
                $("#detail-content-button-" + json.id).show();
                $("#pro-detail-up-btn-" + json.id).css("display", "none")
            } else {
                $("#pro-detail-content-" + json.id).height("2000");
                $("#detail-content-button-" + json.id).show();
                $("#pro-detail-down-btn-" + json.id).click(function () {
                    $("#pro-detail-content-" + json.id).height($("#kindPicture-" + json.id).height() + $("#pro-detail-up-btn-" + json.id).height() + 40);
                    $("#detail-content-button-" + json.id).hide();
                    $("#pro-detail-up-btn-" + json.id).css("display", "block");
                    upDownButton == "true"
                });
                $("#pro-detail-up-btn-" + json.id).click(function () {
                    $("#pro-detail-content-" + json.id).height("2000");
                    $("#detail-content-button-" + json.id).show();
                    $("#pro-detail-up-btn-" + json.id).css("display", "none");
                    $("body,html").animate({scrollTop: tit1 + 1575}, 0);
                    upDownButton == "false"
                })
            }
        }
    });
    $("#myConsultation").click(function () {
        $("#myConsultation").hide();
        $("#upUserAdvisory").removeClass("hide").addClass("show");
        $("#stopConsultationId").show()
    });
    oTop = $(".product-tab").offset().top;
    $("#pro-tab-feature").click(function () {
        if (!clickFlag) {
            tit1 = $(".tit1").offset().top - 150;
            if (scollFlag) {
                tit1 = $(".tit1").offset().top - 50
            }
            clickFlag = true
        }
        $("#pro-tab-feature").addClass("selected").siblings().removeClass("selected");
        $("body,html").animate({scrollTop: tit1 + 75}, 0)
    });
    $("#pro-tab-parameter").click(function () {
        if (!clickFlag) {
            tit1 = $(".tit1").offset().top - 150;
            if (scollFlag) {
                tit1 = $(".tit1").offset().top - 50
            }
            clickFlag = true
        }
        $("#pro-tab-parameter").addClass("selected").siblings().removeClass("selected");
        tit2 = tit1 + $("#pro-tab-feature-content").height() + $("#hr60Detail").height();
        $("body,html").animate({scrollTop: tit2}, 0)
    });
    $("#pro-tab-package-service").click(function () {
        if (!clickFlag) {
            tit1 = $(".tit1").offset().top - 150;
            if (scollFlag) {
                tit1 = $(".tit1").offset().top - 50
            }
            clickFlag = true
        }
        $("#pro-tab-package-service").addClass("selected").siblings().removeClass("selected");
        tit3 = tit1 + $("#pro-tab-feature-content").height() + $("#hr60Detail").height() + $("#productParameter").height() + $("#hr60Detail").height();
        $("body,html").animate({scrollTop: tit3}, 0)
    });
    $("#pro-tab-evaluate").click(function () {
        if (!clickFlag) {
            tit1 = $(".tit1").offset().top - 150;
            if (scollFlag) {
                tit1 = $(".tit1").offset().top - 50
            }
            clickFlag = true
        }
        $("#pro-tab-evaluate").addClass("selected").siblings().removeClass("selected");
        tit4 = tit1 + $("#pro-tab-feature-content").height() + $("#hr60Detail").height() + $("#productParameter").height() + $("#hr60Detail").height() + $("#packagId").height() + $("#customerServiceLocation").height() + $("#productDetailstips").height();
        $("body,html").animate({scrollTop: tit4}, 0)
    });
    $(window).scroll(function () {
        var top = $(this).scrollTop() + 1;
        detailContentHeight = $("#pro-tab-feature-content").height() + $("#hr60Detail").height();
        productParameterHeight = $("#productParameter").height() + $("#hr60Detail").height();
        packageServiceHeight = $("#packagId").height();
        customerServiceHeight = $("#customerServiceLocation").height() + $("#productDetailstips").height();
        if (top > oTop) {
            $(".product-tab").addClass("product-tab-top").css({
                position: "fixed",
                top: "0",
                background: "#fff",
                width: "100%",
                "z-index": "100"
            });
            $(".product-tab-btn").css({display: "block"});
            if (!clickFlag) {
                tit1 = $(".tit1").offset().top - 50
            }
            scollFlag = true
        } else {
            $(".product-tab").css({position: "static"});
            $(".product-tab-btn").css({display: "none"});
            $(".product-tab").removeClass("product-tab-top");
            if (!clickFlag) {
                tit1 = $(".tit1").offset().top - 150
            }
            scollFlag = false
        }
        if (top >= tit1 + 75 && top < tit1 + detailContentHeight) {
            $("#pro-tab-feature").addClass("selected").siblings().removeClass("selected")
        }
        if (packFlag == true) {
            if (top >= tit1 + detailContentHeight && top < tit1 + detailContentHeight + productParameterHeight + $("#productDetailstips").height()) {
                $("#pro-tab-parameter").addClass("selected").siblings().removeClass("selected")
            }
        } else {
            if (top >= tit1 + detailContentHeight && top < tit1 + detailContentHeight + productParameterHeight) {
                $("#pro-tab-parameter").addClass("selected").siblings().removeClass("selected")
            }
        }
        if (packFlag == false) {
            if (top >= tit1 + detailContentHeight + productParameterHeight && top < tit1 + detailContentHeight + productParameterHeight + packageServiceHeight + customerServiceHeight) {
                $("#pro-tab-package-service").addClass("selected").siblings().removeClass("selected")
            }
        }
        if (!commentFlag) {
            if (top >= tit1 + detailContentHeight + productParameterHeight + packageServiceHeight + customerServiceHeight) {
                $("#pro-tab-evaluate").addClass("selected").siblings().removeClass("selected")
            }
        }
    })
});
ec.ui.proNumer = function (selector, options) {
    var defaultOpt = {
        max: null,
        min: null,
        showButton: true,
        minusBtn: '<a id="pro-quantity-minus" href="javascript:;">&minus;</a>',
        plusBtn: '<a id="pro-quantity-plus" href="javascript:;">&#43;</a>'
    }, thix = $(selector), options = $.extend(defaultOpt, options), checkNumber = function (e) {
        var currentKey = e.which, val = parseInt(this.value, 10), thisVal = val < 1 ? 1 : val;
        if ((currentKey < 37 || currentKey > 40) && currentKey != 8 && currentKey != 46) {
            if (thisVal > options.max || thisVal < options.min) {
                e.preventDefault();
                return false
            } else {
                if ((currentKey < 48 || currentKey > 57) && (currentKey < 96 || currentKey > 105) && currentKey != 9) {
                    e.preventDefault();
                    return false
                }
            }
        }
    };
    thix.each(function () {
        var opt = $.extend({}, options), inputObj = $(this).css("ime-mode", "disabled");
        var tmp = inputObj.attr("max");
        if (tmp) {
            options.max = opt.max = parseInt(tmp, 10) || opt.max
        }
        tmp = inputObj.attr("min");
        if (tmp) {
            options.min = opt.min = parseInt(tmp, 10) || opt.min
        }
        if (opt.showButton) {
            var minusBtn = $(opt.minusBtn).click(function () {
                var val = inputObj.val() || 0, thisVal = parseInt(val, 10) - 1;
                if (typeof opt.min == "number" && thisVal < opt.min) {
                    return
                }
                inputObj.val(thisVal).trigger("blur")
            }), plusBtn = $(opt.plusBtn).click(function () {
                var val = inputObj.val() || 0, thisVal = parseInt(val, 10) + 1;
                if (typeof opt.max == "number" && thisVal > opt.max) {
                    return
                }
                inputObj.val(thisVal).trigger("blur")
            });
            var temp = $('<p class="product-stock-btn"></p>').append(plusBtn).append(minusBtn);
            inputObj.after(temp);
            if (this.value <= 1) {
                $("#pro-quantity-minus").removeClass().addClass("disabled")
            } else {
                $("#pro-quantity-minus").removeClass()
            }
        }
        inputObj.data("ovalue", inputObj.val() || 0).keydown(checkNumber).keyup(function () {
            var thisVal = parseInt(this.value || 0);
            if (typeof opt.min == "number" && thisVal < opt.min) {
                this.value = opt.min;
                return
            } else if (typeof opt.max == "number" && thisVal > opt.max) {
                this.value = opt.max;
                return
            }
        }).blur(function () {
            if (this.value <= 1) {
                $("#pro-quantity-minus").removeClass().addClass("disabled")
            } else {
                $("#pro-quantity-minus").removeClass()
            }
            if (typeof opt.onchange === "function") {
                var oldVal = inputObj.data("ovalue"), newVal = this.value || 0,
                    diff = parseInt(newVal, 10) - parseInt(oldVal, 10);
                if (diff == 0) return;
                inputObj.data("ovalue", newVal);
                opt.onchange.call(this, newVal, diff)
            }
        })
    })
};
ec.product.prefix = "/product";
ec.product.email = ec.util.escapeHtml(ec.account.email);
ec.product.mobile = ec.util.escapeHtml(ec.account.mobile);
var _skuForGetFeature = {};
var _giftBuyItemId = new Array;
(function () {
    var _preSku = null, isFirstIn = true, _skuForGetParement = {}, _skuMap = {}, _skuShowType = {},
        _skuAttrId2SkuMap = {}, _skuAttrTypeID = [], _skuAttrName = [], _skuAttrVallue = {}, _skuAttrType2ValueIds = {},
        _selectAttrMap = {}, _attrValue2SkuId = {}, _timer, _skuPriority = {}, _skuPointWeigth = {},
        _skuPointWeigthDetail = {};
    ec.product.getSkuPointWeight = function (skuCode) {
        return _skuPointWeigth[skuCode]
    };
    ec.product.setSkuPointWeight = function (skuCode, promotion) {
        _skuPointWeigth[skuCode] = promotion
    };
    ec.product.getSkuPointWeightDetail = function (skuCode) {
        return _skuPointWeigthDetail[skuCode]
    };
    ec.product.setSkuPointWeightDetail = function (skuCode, promotion) {
        _skuPointWeigthDetail[skuCode] = promotion
    };
    _proGallerysMouseOver = function () {
        var thix = $(this);
        thix.parent().parent().addClass("current").siblings().removeClass("current");
        clearTimeout(_timer);
        _timer = setTimeout(function () {
            var img = thix.attr("src");
            $("#product-img").attr("href", img.replace("78_78", "800_800")).find("img").attr("src", img.replace("78_78", "428_428"));
            $("#product-img").CloudZoom()
        }, 150)
    }, _updateSelect = function () {
        var selectPara = "";
        $("#pro-skus").find(".selected").each(function () {
            if (!$(this).parents("#giftPackageList").length > 0 && !$(this).parents("#packageList").length > 0) {
                selectPara += $(this).children().children("a").attr("title") + " / "
            }
        });
        selectPara = selectPara.substring(0, selectPara.length - 2);
        if ($("#packageSelect").length > 0) {
            $("#packageSelect ul li").each(function () {
                if ($(this).hasClass("selected")) {
                    var tempPackage = $(this).attr("data-attrname");
                    selectPara += '<div id="package-selected" class="inline">&nbsp;/&nbsp;' + tempPackage + "</div>"
                }
            })
        }
        if ($("#giftBuy_dl").length > 0) {
            $("#giftBuy_dl ul li").each(function () {
                if ($(this).hasClass("selected")) {
                    var tempGiftBuy = $(this).find("a").attr("title");
                    selectPara += '<div id="giftBuy-selected" class="inline">&nbsp;/&nbsp;' + tempGiftBuy + "</div>"
                }
            })
        }
        selectPara += "";
        $("#pro-select-sku").html(selectPara);
        $("#pro-select-sku").parent().show()
    };
    _upadteSkuPrice = function (sku) {
        if (sku.priceMode != 2) {
            sku.price = parseFloat(sku.price).toFixed(2)
        }
        if (parseFloat(sku.originPrice) != parseFloat(sku.price) && sku.priceMode != 2) {
            $("#pro-price-label").html("抢购价");
            $("#pro-price-label").removeClass("f24").addClass("type");
            $("#pro-price").html("<em>&yen;</em>" + sku.price);
            $("#pro-price-old").html("&yen;&nbsp;" + sku.originPrice);
            $("#pro-price-label").show();
            $("#pro-price").show();
            $("#pro-price-old").show()
        } else {
            $("#pro-price-old").hide();
            $("#pro-price-label").hide();
            $("#pro-price-old").html("");
            $("#pro-price-label").html("");
            if (sku.price > 0) {
                if (ec.product.productType == 4) {
                    $("#pro-price-hide").val(sku.price);
                    $("#pro-price").html("<em>&yen;</em>" + sku.price);
                    $("#pro-price").show();
                    $("#pro-price-label-deposit").hide();
                    $("#pro-price-deposit").hide();
                    $("#pro-price-label-amount").hide();
                    $("#pro-price-amount").hide();
                    $("#buyProcessIDD").hide();
                    $("#goAddressId").hide()
                } else {
                    $("#pro-price").html("<em>&yen;</em>" + sku.price);
                    $("#pro-price").show()
                }
            } else {
                $("#pro-price").html("");
                $("#pro-price").hide();
                $("#pro-price-label").html("暂无报价");
                if ($("#pro-price-label").hasClass("type")) {
                    $("#pro-price-label").removeClass("type").addClass("f24")
                }
                $("#pro-price-label").show()
            }
        }
        if (sku.priceMode == 2 || sku.price <= 0) {
            $("#pro-price").hide();
            $("#pro-price-old").hide();
            $("#pro-price-label").html("暂无报价");
            $("#pro-price-label").show()
        }
    };
    _updateSkuInfo = function () {
        var sku = ec.product.getSku(), timerPromWord;
        if (!sku || _preSku == sku) {
            return
        } else {
            ec.product.videoHide();
            if ($("#extendSelect").next().is("a")) {
                $("#extendSelect").next().remove()
            }
            if ($("#accidentSelect").next().is("a")) {
                $("#accidentSelect").next().remove()
            }
            $("#extendSelect").parent().removeClass("selected");
            $("#accidentSelect").parent().removeClass("selected")
        }
        $("#package_dl").remove();
        $("#packageList").html("");
        $("#packageCode").val("");
        $().remove();
        $("#giftPackageList").html("");
        ec.product.gift.packageGiftMap[sku] == [];
        ec.product.setSkuId = _preSku = sku;
        $("#product-tips").hide();
        $("#pro-quantity-area").show();
        $("#pro-operation").css("visibility", "visible");
        $("#pro-quantity-area").show();
        $("#pro-quantity-area-nochange").hide();
        $("#product-operation").hide();
        var bundleList = $("#bundle-list-" + sku);
        var combList = $("#comb-list-" + sku);
        if (combList && combList.length > 0 && ec.product.productType != 4) {
            $(".product-package-tab").hide();
            $(".product-recommend-con").hide();
            $("#product-recommend-all").show();
            $("#comb-list-" + sku).show();
            $("div[id^='comb-pro-" + sku + "-0'] ").show()
        } else {
            $("#product-recommend-all").hide()
        }
        flag = 0;
        $("div[id^='comb-list-'] input").unbind("click");
        $("div[id^='comb-list-" + sku + "-'] input").bind("click", function (event) {
            $(this).attr("disabled", "disabled");
            if (flag != 0) {
                return
            }
            if ($(this).hasClass("protect") == false) {
                $(this).addClass("protect");
                $(this).attr("checked", true)
            } else {
                $(this).removeClass("protect");
                $(this).attr("checked", false)
            }
            var dataIndex = $(this).attr("data-index");
            var productNum = $("#comb-count-" + sku.id + "-" + dataIndex).html();
            var mainPrice = $("#comb-main-price-" + sku.id + "-" + dataIndex).attr("data-price");
            var totalPrice = parseFloat($("#comb-price-" + sku.id + "-" + dataIndex).html());
            flag = 1;
            if ($(this).attr("checked") == true) {
                price = totalPrice + parseFloat($(this).attr("data-price"));
                productNum++
            } else {
                price = totalPrice - parseFloat($(this).attr("data-price"));
                productNum--
            }
            $("#comb-price-" + sku.id + "-" + dataIndex).html(price.toFixed(2));
            $("#comb-count-" + sku.id + "-" + dataIndex).html(productNum);
            console.log($("#comb-count-" + sku.id + "-" + dataIndex).html());
            flag = 0;
            $(this).attr("disabled", "")
        });
        sku = _skuMap[sku];
        ec.product.setType(sku.type);
        _upadteSkuPrice(sku);
        var html = [];
        html.push('<a href="javascript:;" class="product-slogan-btn"></a>');
        if ($.trim(sku.timerPromWord).length > 0) {
            if ($.trim(sku.timerPromLink4PC).length > 0) {
                timerPromWord = '<a href="' + sku.timerPromLink4PC + '" target="_blank" class="product-slogan-link">' + sku.timerPromWord + "</a>"
            }
            var _now = ec.product.getSysDate();
            var start = sku.timerPromStarttime;
            var startTime = new Date;
            startTime.setTime(start.parseDate("yyyy-MM-dd HH:mm:ss"));
            var end = sku.timerPromEndtime;
            var endTime = new Date;
            endTime.setTime(end.parseDate("yyyy-MM-dd HH:mm:ss"));
            if (_now - startTime >= 0 && endTime - _now >= 0) {
                html.push(timerPromWord || '<span class="product-slogan-link">' + sku.timerPromWord + "</span>")
            }
        }
        if ($.trim(sku.skuPromWord).length > 0) {
            html.push("<span>" + sku.skuPromWord + "</span>")
        }
        if (0 < html.length) {
            $("#skuPromWord").html(html.join(" "));
            $("#skuPromWord").css("display", "-webkit-box");
            $(".product-slogan-btn").hide();
            $("#skuPromWord").attr("class", "product-slogan");
            var nowHeight = $("#skuPromWord").height();
            if (nowHeight > 40) {
                $("#skuPromWord").attr("class", "product-slogan product-slogan-hide");
                $(".product-slogan-btn").show();
                $(".product-slogan-btn").mouseenter(function () {
                    if ($("#skuPromWord").hasClass("product-slogan-show")) {
                        $("#skuPromWord").attr("class", "product-slogan product-slogan-hide")
                    } else {
                        $("#skuPromWord").attr("class", "product-slogan product-slogan-show")
                    }
                    ec.product.refreshStyle()
                });
                $("#skuPromWord").mouseleave(function () {
                    if ($("#skuPromWord").hasClass("product-slogan-show")) {
                        $("#skuPromWord").attr("class", "product-slogan product-slogan-hide");
                        ec.product.refreshStyle()
                    }
                })
            }
        } else {
            $("#skuPromWord").html("");
            $("#skuPromWord").hide()
        }
        if (!$.trim(sku.skuPromWord).length > 0 && !$.trim(sku.timerPromWord).length > 0) {
            $("#skuPromWord").hide()
        }
        $("#pro-sku-code").val(sku.code);
        $("#pro-sku-code2").text(sku.code);
        $("#pro-name").html(sku.name);
        $("#bread-pro-name").html(sku.name);
        ec.product.execute("renderInventory", [ec.product.inventory.haveInventory(sku.id)]);
        if (sku.prdPhotoName != "") {
            $("#product-img").attr("href", ec.mediaPath + sku.prdPhotoPath + "800_800_" + sku.prdPhotoName).find("img").attr("src", ec.mediaPath + sku.prdPhotoPath + "428_428_" + sku.prdPhotoName)
        } else {
            $("#product-img").attr("href", ec.mediaPath + sku.photoPath + "800_800_" + sku.photoName).find("img").attr("src", ec.mediaPath + sku.photoPath + "428_428_" + sku.photoName)
        }
        $("#product-img").CloudZoom();
        var html = [];
        if (sku.prdPhotoName != "") {
            html.push('<li class="current"><a href="javascript:;"><img src="' + ec.mediaPath + sku.prdPhotoPath + "78_78_" + sku.prdPhotoName + '" alt="' + sku.name + '"/></a></li>');
            html.push('<li><a href="javascript:;"><img src="' + ec.mediaPath + sku.photoPath + "78_78_" + sku.photoName + '" alt="' + sku.name + '"/></a></li>')
        } else {
            html.push('<li class="current"><a href="javascript:;"><img src="' + ec.mediaPath + sku.photoPath + "78_78_" + sku.photoName + '" alt="' + sku.name + '"/></a></li>')
        }
        if (sku.groupPhotoList) {
            for (var i = 0; i < sku.groupPhotoList.length; i++) {
                var c = sku.groupPhotoList[i];
                html.push('<li><a href="javascript:;"><img src="' + ec.mediaPath + c.path + "/78_78_" + c.name + '"  alt="' + sku.name + '"/></a></li>')
            }
        }
        html = $(html.join(""));
        html.find("img").mouseover(_proGallerysMouseOver);
        $("#pro-gallerys").empty().html(html);
        ec.product.imgSlider.reset();
        html = [];
        if (!sku.giftList || sku.giftList.length == 0) {
            isShowGifts = false
        } else {
            isShowGifts = false;
            for (var i = 0; i < sku.giftList.length; i++) {
                if (sku.giftList[i].displayType == 1) {
                    isShowGifts = true;
                    break
                }
            }
        }
        if (isShowGifts) {
            $("#product-info-list-new").show();
            $("#pro-match-gift").show();
            $("#pro-gift-list-select").html(ec.product.gift.ftl(ec.product.getSku()))
        } else {
            if ($("#product-prom-all").find("product-prom-item").length = 1) {
                if ($("#product-prom-all").find("product-prom-item").attr("id") == "pro-match-gift") {
                    $("#product-info-list-new").hide()
                }
            }
            $("#pro-match-gift").hide()
        }
        html = [], htmldetail = [];
        if (!sku.promotionLst || sku.promotionLst.length == 0) {
            $(".product-prom-item").eq(0).siblings().remove();
            if ($("#pro-gift-list-select").children().length < 0 || !sku.giftList || sku.giftList.length == 0) {
                $("#product-info-list-new").hide()
            }
        } else {
            if ($(".product-prom").parent().hasClass("hide") || $(".product-prom").parent().css("display") == "none") {
                $(".product-prom").parent().removeClass("hide");
                $(".product-prom").parent().css("display", "")
            }
            $(".product-prom-item").eq(0).siblings().remove();
            htmldetail.push(' <div class="product-prom-item clearfix relative hide" id="promBtn">');
            htmldetail.push('<p class="fl">');
            for (var i = 0; i < sku.promotionLst.length; i++) {
                htmldetail.push('<em class="tag">' + sku.promotionLst[i].promoLabel + "</em>");
                html.push('<div class="product-prom-item clearfix" >');
                html.push('<em class="tag">' + sku.promotionLst[i].promoLabel + "</em>");
                html.push('<div class="product-prom-con" title="' + sku.promotionLst[i].ruleDescription + '">');
                html.push(' <span class="product-prom-word">');
                html.push(sku.promotionLst[i].ruleDescription);
                html.push(" </span>");
                if (sku.promotionLst[i].isRealNameAuth == "1") {
                    htmldetail.push('<a href="/authmember/accesstoken" target="_blank"  class="product-prom-link">限实名用户参加 ></a>')
                }
                html.push("</div>");
                html.push("</div>")
            }
            htmldetail.push('</p><div class="product-prom-btn" id="show-all-prom"  >展开促销</div></div>');
            $(".product-prom").append(html.join(""));
            $(".product-prom .product-prom-item").hide();
            if ($("#pro-gift-list-select").find("a").length > 0 && isShowGifts) {
                if ($("#product-prom-all").children().length > 4) {
                    for (var i = 0; i < 3; i++) {
                        $(".product-prom-item").eq(i).show()
                    }
                    $(".product-prom").append(htmldetail.join(""));
                    $("#promBtn").show();
                    for (var i = 0; i < 2; i++) {
                        $("#promBtn em").eq(i).hide()
                    }
                } else {
                    $(".product-prom .product-prom-item").show();
                    $(".product-prom").append(htmldetail.join(""))
                }
            } else {
                if ($("#product-prom-all").children().length > 5) {
                    for (var i = 1; i < 4; i++) {
                        $(".product-prom-item").eq(i).show()
                    }
                    $(".product-prom").append(htmldetail.join(""));
                    $("#promBtn").show();
                    for (var i = 0; i < 3; i++) {
                        $("#promBtn em").eq(i).hide()
                    }
                } else {
                    $(".product-prom .product-prom-item").show();
                    $(".product-prom").append(htmldetail.join(""))
                }
            }
            if (!$("#pro-gift-list-select").find("a").length > 0 || !isShowGifts) {
                $("#pro-match-gift").hide()
            }
        }
        html = [];
        if (ec.product.seCode != ec.product.productSeCode) {
            html.push("<p>已包邮<em></em>由" + ec.product.productshopName + "发货，并提供售后服务</p>")
        } else {
            if (parseFloat(ec.product.deliveryModeValueFreeBase) > 0 && ec.product.productType == 0) {
                if (sku.priceMode != 2) {
                    if (parseFloat(sku.price) >= parseFloat(ec.product.deliveryModeValueFreeBase)) {
                        html.push("<p>已满" + ec.product.deliveryModeValueFreeBase + "元已免运费<em></em>")
                    } else {
                        html.push("<p>满" + ec.product.deliveryModeValueFreeBase + "元即免运费，快去凑单吧<em></em>")
                    }
                }
            } else {
                html.push("<p>")
            }
            html.push("由华为商城负责发货，并提111供售后服务</p>")
        }
        if ($("#pro-select-gift-service") != undefined) {
            $("#pro-select-gift-service").remove();
            _giftBuyItemId = []
        }
        if ($("#giftBuy_dl") != undefined) {
            $("#giftBuy_dl").remove()
        }
        var hasSelectCustomize = false;
        if (sku.buttonMode == "11") {
            hasSelectCustomize = true
        }
        var isPriority = $("#isPriority").val();
        $("#package_dl").remove();
        $("#packageList").html("");
        $("#packageCode").val("");
        if (sku.pro_sbomList != null && sku.pro_sbomList != "" && sku.pro_sbomList.length > 0 && ec.product.inventory.haveInventory(sku.id)) {
            var newpackageListHtml = [];
            var pro_sbomList = sku.pro_sbomList;
            for (var s = 0; s < pro_sbomList.length; s++) {
                if (sku.code == pro_sbomList[s].sbomCode) {
                    var new_packageList = pro_sbomList[s].sbomPackageList;
                    if (new_packageList != null && new_packageList != "" && new_packageList.length > 0) {
                        ec.product.hidebundleView();
                        newpackageListHtml.push('<dl class="product-choose clearfix" id="package_dl"><label>选择套餐</label><div class="product-choose-detail relative" id = "packageSelect"><ul>');
                        newpackageListHtml.push('<li class="selected" data-attrname="单品">');
                        newpackageListHtml.push('<div class="sku">');
                        newpackageListHtml.push('<a href="javascript:;" title="单品" onclick="ec.product.newpackageView(this,null,\'' + sku.code + "')\"><p><span>单品</span></p></a></div></li>");
                        for (var p = 0; p < new_packageList.length; p++) {
                            var packageList = new_packageList[p].packageList;
                            newpackageListHtml.push('<li class="" data-attrname="' + new_packageList[p].name + '">');
                            newpackageListHtml.push('<div class="sku"><a href="javascript:;" attr-package=' + new_packageList[p].packageCode + ' title="' + new_packageList[p].name + '" onclick="ec.product.newpackageView(this,\'' + new_packageList[p].packageCode + "','" + sku.code + "')\"><p><span attr-package=" + new_packageList[p].packageCode + ">" + new_packageList[p].name + "</span></p></a></div></li>")
                        }
                        newpackageListHtml.push('</ul><div id="packageList"></div></dl>')
                    } else {
                        $("#bundlePackage").removeClass("hide")
                    }
                }
            }
            if ($("#bundlePackage").length > 0) {
                $("#bundlePackage").after(newpackageListHtml.join(""))
            } else {
                $("#pro-skus").after(newpackageListHtml.join(""))
            }
        } else {
            $("#packageList").html("")
        }
        if (sku.giftBuyLstX.length > 0) {
            var giftBuyHtml = [];
            giftBuyHtml.push('<dl class="product-choose clearfix" id="giftBuy_dl"><label>增值业务</label><div class="product-choose-detail"><ul>');
            giftBuyHtml.push('<li class="selected" data-attrname="无增值服务">');
            giftBuyHtml.push('<a href="javascript:;" title="无增值服务"><p><span>无增值服务</span></p></a></li>');
            for (var o = 0; o < sku.giftBuyLstX.length; o++) {
                var giftSku = sku.giftBuyLstX[o];
                giftBuyHtml.push('<li class="' + (giftSku.hasInv == "false" || hasSelectCustomize ? "disabled" : "") + '" data-skuid="' + giftSku.id + '">');
                giftBuyHtml.push('<a href="javascript:;" title="' + giftSku.name + '" data-code="' + giftSku.sbomCode + '"interest-price="' + giftSku.price + '" data-pid="' + giftSku.productId + '"><p><span>' + giftSku.name + "</span></p></a></li>")
            }
            giftBuyHtml.push('<a href="javascript:;" target="_blank" class="btn-product-more hidden" id="gift-service-detail-link"><span>了解详情</span>&gt;</a>');
            giftBuyHtml.push("</ul></div></dl>");
            if ($("#conRelItemList").length > 0) {
                $("#conRelItemList").after(giftBuyHtml.join(""))
            } else {
                $("#contractLst").after(giftBuyHtml.join(""))
            }
            var proSelectGiftService = [];
            proSelectGiftService.push('<div id="giftBuy-selected" class="inline">&nbsp;/&nbsp;无增值服务</div>');
            var originVal = $("#pro-select-sku").html();
            $("#pro-select-sku").html(originVal + proSelectGiftService.join(""));
            ec.product.hasRemovedCartButton = false;
            $("#giftBuy_dl li").find("a").each(function () {
                if ($(this).parent().hasClass("disabled")) {
                    return
                }
                $(this).click(function () {
                    $(this).parent().addClass("selected").siblings().removeClass("selected");
                    var giftBuySbomCode = $(this).attr("data-code");
                    if ($("#pro-select-gift-service") != undefined) {
                        $("#pro-select-gift-service").remove()
                    }
                    if (giftBuySbomCode != undefined && giftBuySbomCode.length > 0) {
                        _giftBuyItemId = [];
                        _giftBuyItemId.push(giftBuySbomCode);
                        pushProGiftBuySerMsg();
                        $("#gift-service-detail-link").attr("href", "/product/" + $(this).attr("data-pid") + ".html");
                        $("#gift-service-detail-link").show();
                        $("#giftBuy-selected").remove();
                        var proSelectGiftService = [];
                        proSelectGiftService.push('<div id="giftBuy-selected" class="inline">&nbsp;/&nbsp;' + $(this).attr("title") + "</div>");
                        var originVal = $("#pro-select-sku").html();
                        $("#pro-select-sku").html(originVal + proSelectGiftService.join(""));
                        if ($("#pro-operation").find("a").length == 2 && $("#pro-operation").find("a").first().find("span").html() == "加入购物车" && !$("#pro-operation").find("a").first().hasClass("disabled")) {
                            $("#pro-operation").find("a").first().remove();
                            $("#pro-operation").find("a").attr("onclick", "").click(function () {
                                ec.product.orderNow("2")
                            });
                            ec.product.hasRemovedCartButton = true
                        }
                    } else {
                        _giftBuyItemId = [];
                        $("#gift-service-detail-link").attr("href", "");
                        $("#gift-service-detail-link").hide();
                        $("#pro-operation").find("a").attr("onclick", "").click(function () {
                            ec.product.orderNow()
                        });
                        if ($("#pro-operation").find("a").length == 1 && !$("#pro-operation").find("a").hasClass("disabled") && ec.product.hasRemovedCartButton) {
                            $("#pro-operation").find("a").before('<a href="javascript:;" onclick="ec.product.addCart()" class="product-button01"><span>加入购物车</span></a>');
                            ec.product.hasRemovedCartButton = false
                        }
                        if ($("#pro-select-gift-service") != undefined) {
                            $("#pro-select-gift-service").remove()
                        }
                        $("#giftBuy-selected").remove();
                        var proSelectGiftService = [];
                        proSelectGiftService.push('<div id="giftBuy-selected" class="inline">&nbsp;/&nbsp;无增值服务' + "</div>");
                        var originVal = $("#pro-select-sku").html();
                        $("#pro-select-sku").html(originVal + proSelectGiftService.join(""))
                    }
                    ec.product.interest.queryFreeDetail()
                })
            })
        } else {
            if ($("#giftBuy_dl") != undefined) {
                $("#giftBuy_dl").remove()
            }
        }
        if (sku.prolongLst.length > 0) {
            var lst;
            html = [];
            var ExtendedProtectProductId = [];
            var accidentProtectProductId = [];
            var ExtendedProtectName = [], ExtendedProtectBrifeName = [];
            var ExtendedProtectId = [];
            var ExtendedProtectNum = 0;
            var ExtendedOption;
            var accidentProtectName = [], accidentProtectBrifeName = [];
            var accidentProtectId = [];
            var exetendedPrice = [], accidentPrice = [], exetendedOrderPrice = [], accidentOrderPrice = [];
            var accidentProtectsNum = 0;
            var entendOptionSize = 0;
            var accidentOptionSize = 0;
            var ifShowServicePlusFlag = 0;
            var extendedProtectCode = [];
            var accidentProtectCode = [];
            for (var i = 0; i < sku.prolongLst.length; i += 1) {
                lst = sku.prolongLst[i];
                if (lst.serviceType == 1) {
                    ExtendedProtectName[ExtendedProtectNum] = lst.name;
                    ExtendedProtectId[ExtendedProtectNum] = lst.id;
                    extendedProtectCode[ExtendedProtectNum] = lst.sbomCode;
                    ExtendedProtectProductId[ExtendedProtectNum] = lst.productId;
                    ExtendedProtectBrifeName[ExtendedProtectNum] = lst.brifeName;
                    exetendedPrice[ExtendedProtectNum] = lst.price;
                    exetendedOrderPrice[ExtendedProtectNum] = lst.orderPrice;
                    ExtendedProtectNum += 1
                }
                if (lst.serviceType == 2) {
                    accidentProtectName[accidentProtectsNum] = lst.name;
                    accidentProtectId[accidentProtectsNum] = lst.id;
                    accidentProtectCode[accidentProtectsNum] = lst.sbomCode;
                    accidentProtectProductId[accidentProtectsNum] = lst.productId;
                    accidentProtectBrifeName[accidentProtectsNum] = lst.brifeName;
                    accidentPrice[accidentProtectsNum] = lst.price;
                    accidentOrderPrice[accidentProtectsNum] = lst.orderPrice;
                    accidentProtectsNum += 1
                }
            }
            $("#extendProtected").find("ul").html("");
            $("#accidentProtected").find("ul").html("");
            $("#pro-service").hide();
            $("#extendSelect").attr("skuid", "");
            $("#extendSelect").attr("data-scode", "");
            $("#extendSelect").attr("interest-price", "");
            $("#accidentSelect").attr("skuid", "");
            $("#accidentSelect").attr("data-scode", "");
            $("#accidentSelect").attr("interest-price", "");
            $("#extendSelect").html("");
            $("#accidentSelect").html("");
            $(".product-operation-main").css("min-height", "49px");
            if (ExtendedProtectNum > 0 || accidentProtectsNum > 0) {
                $("#pro-service").show()
            } else {
                $("#pro-service").hide()
            }
            if (ExtendedProtectNum > 0) {
                $("#extendProtected").parent().parent().show();
                for (var i = 0; i < ExtendedProtectNum; i++) {
                    if (exetendedPrice[i] < exetendedOrderPrice[i]) {
                        var tempEShow = '<s class="fl">&nbsp;￥' + exetendedOrderPrice[i] + "</s>";
                        var tempEShow1 = '<em class="product-service-icon">优惠</em>'
                    } else {
                        var tempEShow = "";
                        var tempEShow1 = ""
                    }
                    ExtendedOption = $('<li><div class="fl" onclick="checkedThis(this,\'' + extendedProtectCode[i] + "','extendedName','extendProtected');\"><input type=\"checkbox\" name=\"extendedName\">" + '<div id="' + extendedProtectCode[i] + '" class="product-service-listcon" title="' + ExtendedProtectBrifeName[i] + '"  skuID="' + ExtendedProtectId[i] + '"data-scode="' + extendedProtectCode[i] + '"data-price="' + exetendedPrice[i] + '">' + tempEShow1 + '<span class="fl max-w">' + ExtendedProtectBrifeName[i] + '</span><p class="f1"><span class="fl">&nbsp;￥' + exetendedPrice[i] + "</span>" + tempEShow + '<a target="_blank" href="/product/' + ExtendedProtectProductId[i] + '.html">详情&nbsp;&gt;</a></p></div>' + "</div></li>");
                    ExtendedOption.appendTo($("#extendProtected").find("ul"))
                }
                var selectExtendName = '<span class="fl max-w">' + ExtendedProtectBrifeName[0] + '</span><span class="fl">&nbsp;￥' + exetendedPrice[0] + "</span>";
                $("#extendProtected").parent().before('<a href="javascript:;"  onclick="ec.product.click_function(this)"  class="product-service-btn">' + selectExtendName + "</a>")
            } else {
                $("#extendProtected").parent().parent().hide()
            }
            if (accidentProtectsNum > 0) {
                $("#accidentProtected").parent().parent().show();
                for (var i = 0; i < accidentProtectsNum; i++) {
                    if (accidentPrice[i] < accidentOrderPrice[i]) {
                        var tempAShow = '<s class="fl">&nbsp;￥' + accidentOrderPrice[i] + "</s>";
                        var tempAShow1 = '<em class="product-service-icon">优惠</em>'
                    } else {
                        var tempAShow = "";
                        var tempAShow1 = ""
                    }
                    var accidentOption = $('<li><div class="fl" onclick="checkedThis(this,\'' + accidentProtectCode[i] + "','accidentName','accidentProtected');\"><input type=\"checkbox\" name=\"accidentName\" >" + '<div id="' + accidentProtectCode[i] + '" class="product-service-listcon" title="' + accidentProtectBrifeName[i] + '"  skuID="' + accidentProtectId[i] + '" data-scode="' + accidentProtectCode[i] + '"data-price="' + accidentPrice[i] + '">' + tempAShow1 + '<span class="fl max-w">' + accidentProtectBrifeName[i] + '</span><p class="fl"><span class="fl">&nbsp;￥' + accidentPrice[i] + "</span>" + tempAShow + '<a target="_blank" href="/product/' + accidentProtectProductId[i] + '.html">详情&nbsp;&gt;</a></p></div>' + "</div></li>");
                    accidentOption.appendTo($("#accidentProtected").find("ul"))
                }
                var selectAccidentName = '<span class="fl max-w">' + accidentProtectBrifeName[0] + '</span><span class="fl">&nbsp;￥' + accidentPrice[0] + "</span>";
                $("#accidentProtected").parent().before('<a href="javascript:;" onclick="ec.product.click_function(this)" class="product-service-btn">' + selectAccidentName + "</a>")
            } else {
                $("#accidentProtected").parent().parent().hide()
            }
        } else {
            $("#pro-service").hide();
            $("#extendSelect").attr("skuid", "");
            $("#extendSelect").attr("data-scode", "");
            $("#extendSelect").attr("interest-price", "");
            $("#accidentSelect").attr("skuid", "");
            $("#accidentSelect").attr("data-scode", "");
            $("#accidentSelect").attr("interest-price", "");
            $("#extendSelect").html("");
            $("#accidentSelect").html("");
            $("#extendProtected ul").each(function (index) {
                $(this).html("")
            });
            $("#accidentProtected ul").each(function (index) {
                $(this).html("")
            })
        }
        ec.product.showSbomInterest(sku);
        _updateSelect();
        $("#integral").html(sku.integral);
        ec.product.renderGroup(_preSku);
        if (ec.product.productType == 4) {
            ec.product.depositActivity(ec.product.getSku())
        } else {
            $("#goAddressId").hide();
            if ($("#pro-global-parameter").attr("data-skulist-rushbuy")) {
                ec.product.rushbuyActivity()
            }
        }
        var sku = ec.product.getSku();
        packFlag = false;
        sku = ec.product.getSkuInfo(sku);
        upDownButton = "";
        ec.product.getFeature(sku.id);
        ec.product.getParameter(sku.id, sku.code);
        ec.product.getPackageAndService(sku.id);
        ec.product.switchSku();
        $(".product-tab-btn").css({display: "none"});
        if ($("#packageCode").val() != "") {
            ec.product.hiddenTips()
        } else {
            ec.product.processSupportDisplayDilieryTime(sku)
        }
        ec.product.queryPointWeight(ec.product.setSkuId || ec.product.defaultSku);
        ec.product.coupon.loadCoupon(sku.code);
        $("#product-prom-all").live("mouseenter", function () {
            $(".product-prom").addClass("show");
            $("#promBtn").css("display", "none");
            $(".product-prom-item").hide();
            $(".product-prom-item").show();
            if (!isShowGifts) {
                $("#pro-match-gift").hide()
            }
            $("#promBtn").hide()
        });
        $(".product-prom").live("mouseleave", function () {
            if (isShowGifts) {
                if ($("#product-prom-all").children().length < 5) {
                    return
                }
            } else {
                if ($("#product-prom-all").children().length < 6) {
                    return
                }
            }
            $(".product-prom").removeClass("show");
            $("#promBtn").css("display", "block");
            $(".product-prom .product-prom-item").hide();
            if (isShowGifts) {
                for (var i = 0; i < 3; i++) {
                    $(".product-prom-item").eq(i).show()
                }
                $("#promBtn").show();
                for (var i = 0; i < 2; i++) {
                    $("#promBtn em").eq(i).hide()
                }
            } else {
                for (var i = 1; i < 4; i++) {
                    $(".product-prom-item").eq(i).show()
                }
                $("#promBtn").show();
                for (var i = 0; i < 3; i++) {
                    $("#promBtn em").eq(i).hide()
                }
            }
        })
    };
    ec.product.tabSkuInfo = function (skuId) {
        $("#pro-tab-feature-content-" + skuId + ", #pro-tab-feature-content2-" + skuId + ", #pro-tab-parameter-content-" + skuId + ", #pro-tab-package-content-" + skuId + ", #pro-tab-service-content-" + skuId).show().siblings().hide();
        $("#comb-pro-area").find(".selected").each(function () {
            $(this).removeClass("selected")
        });
        $("#comb-count").html("0");
        var count = parseInt($("#comb-count").html(), 10) && 0;
        var sku = ec.product.getSkuInfo(skuId);
        var price = parseFloat(sku.price);
        if (!(ec.product.productType && ec.product.productType == 4 && ec.product.isDespositSku == 1)) {
            $("#comb-price-label").html("组合价：&yen;");
            $("#comb-price").html(price.toFixed(2))
        }
        $("#combList-list-" + skuId).show().siblings().hide();
        if (!$("#combList-list-" + skuId).children().eq(0).hasClass("current")) {
            $("#combList-list-" + skuId).children().eq(0).addClass("current").siblings().removeClass("current")
        }
    };
    ec.product.addSkuAttr = function (skuId, attrTypeId, attrName, attrId, attrValue) {
        var sku = _skuMap[skuId];
        if (!sku) {
            _skuMap[skuId] = {attrIds: [attrId]}
        } else {
            sku.attrIds.push(attrId)
        }
        _skuAttrId2SkuMap[attrId] = skuId;
        var attrV = _skuAttrVallue[attrName];
        if (!attrV) {
            _skuAttrName.push(attrName);
            _skuAttrTypeID.push(attrTypeId);
            _skuAttrVallue[attrName] = [attrValue]
        } else if (attrV.indexOf(attrValue) == -1) {
            attrV.push(attrValue)
        }
        var ids = _skuAttrType2ValueIds[attrTypeId + "-" + attrValue];
        if (!ids) {
            _skuAttrType2ValueIds[attrTypeId + "-" + attrValue] = [attrId]
        } else {
            ids.push(attrId)
        }
        if (!_attrValue2SkuId[attrValue]) {
            _attrValue2SkuId[attrValue] = []
        }
        _attrValue2SkuId[attrValue].push(skuId)
    };
    ec.product.setSku = function (skuId, options) {
        options = options || {};
        options.id = skuId;
        $.extend(_skuMap[skuId] || (_skuMap[skuId] = {}), options)
    };
    ec.product.getAllSku = function () {
        return _skuMap
    };
    ec.product.getSku = function () {
        var sku;
        $.each(_selectAttrMap, function () {
            if (!sku) {
                sku = this;
                return
            }
            var _t = this, newSku = [];
            for (var i = 0; i < sku.length; i++) {
                for (var j = 0; j < _t.length; j++) {
                    if (sku[i] == _t[j]) {
                        newSku.push(sku[i])
                    }
                }
            }
            sku = newSku
        });
        if (!sku || sku.length != 1) {
            return _preSku || ec.product.defaultSku
        }
        return sku[0]
    };
    ec.product.getSkuInfo = function (skuId) {
        return _skuMap[skuId]
    };
    ec.product.setSkuForParement = function (skuId) {
        _skuForGetParement[skuId] = skuId
    };
    ec.product.getSkuForParement = function (skuId) {
        return _skuForGetParement[skuId]
    };
    ec.product.setSkuForFeature = function (skuId) {
        _skuForGetFeature[skuId] = skuId
    };
    ec.product.getSkuForFeature = function (skuId) {
        return _skuForGetFeature[skuId]
    };
    ec.product.setSkuShowType = function (attrTypeId, showType) {
        _skuShowType[attrTypeId] = showType
    };
    ec.product.setSkuPriority = function (skuId) {
        _skuPriority[skuId] = true
    };
    ec.product.getSkuPriority = function (skuId) {
        return _skuPriority[skuId]
    };
    ec.product.selectBySku = function (skuId) {
        var sku = _skuMap[skuId];
        if (!sku || !sku.attrIds) {
            _upadteSkuPrice(sku);
            if (ec.product.productType == 4) {
                ec.product.depositActivity(skuId)
            } else {
                $("#goAddressId").hide();
                if ($("#pro-global-parameter").attr("data-skulist-rushbuy")) {
                    ec.product.rushbuyActivity()
                }
            }
            return
        }
        $("#pro-skus").find(".attr" + sku.attrIds.join(",.attr")).children(".sku").trigger("click")
    };
    ec.product.queryPointWeight = function (skuId) {
        var sku = _skuMap[skuId];
        if (sku || sku.code) {
            if (ec.product.productType == 1 || ec.product.productType == 2 || ec.product.productType == 5 || ec.product.productType == 6) {
                return
            }
            if (ec.product.seCode != "VMALL-HUAWEIDEVICE") {
                return
            }
            if (ec.product.getSkuPointWeight(sku.code) != undefined) {
                $("#promBtn p").append(ec.product.getSkuPointWeightDetail(sku.code));
                var htmlproBtn = [];
                htmlproBtn.push('<div class="product-prom-item clearfix relative" id="promBtn">');
                htmlproBtn.push($("#promBtn").html());
                htmlproBtn.push("</div>");
                $("#promBtn").remove();
                $(".product-prom").append(ec.product.getSkuPointWeight(sku.code));
                $(".product-prom .product-prom-item").hide();
                if ($("#pro-gift-list-select").find("a").length > 0 && isShowGifts) {
                    if ($("#product-prom-all").children().length > 4) {
                        for (var i = 0; i < 3; i++) {
                            $(".product-prom-item").eq(i).show()
                        }
                        $(".product-prom").append(htmlproBtn.join(""));
                        $("#promBtn").show();
                        for (var i = 0; i < 2; i++) {
                            $("#promBtn em").eq(i).hide()
                        }
                    } else {
                        $(".product-prom .product-prom-item").show()
                    }
                } else {
                    if ($("#product-prom-all").children().length > 5) {
                        for (var i = 1; i < 4; i++) {
                            $(".product-prom-item").eq(i).show()
                        }
                        $(".product-prom").append(htmlproBtn.join(""));
                        $("#promBtn").show();
                        for (var i = 0; i < 3; i++) {
                            $("#promBtn em").eq(i).hide()
                        }
                    } else {
                        $(".product-prom .product-prom-item").show()
                    }
                }
                if ($(".product-prom").parent().hasClass("hide") || $(".product-prom").parent().css("display") == "none") {
                    $(".product-prom").parent().removeClass("hide");
                    $(".product-prom").parent().css("display", "")
                }
                if (!$("#pro-gift-list-select").find("a").length > 0 || !isShowGifts) {
                    $("#pro-match-gift").hide()
                }
                if ($("#pro-promotions-list").parent().parent().hasClass("hide")) {
                    $("#pro-promotions-list").parent().parent().removeClass("hide")
                }
                ec.product.refreshStyle()
            } else {
                $.ajax({
                    url: openApiDomain + "/point/queryPointWeight.json?skuCodes=[" + sku.code + "]",
                    dataType: "jsonp",
                    timeout: 1e4,
                    jsonpCallback: "queryPointWeightHandler",
                    success: function (json) {
                        var pointWeight = 1;
                        if (json.resultCode == "200000") {
                            json.pointWeightMap = json.data;
                            if (json.pointWeightMap != null) {
                                for (var k in json.pointWeightMap) {
                                    if (json.pointWeightMap[k] != null) {
                                        pointWeight = json.pointWeightMap[k]
                                    }
                                }
                            }
                        }
                        var html = [], htmldetail = [];
                        if (pointWeight == 0) {
                            return
                        } else if (pointWeight == 1) {
                            htmldetail.push('<em class="tag">赠送积分</em>');
                            html.push('<div class="product-prom-item clearfix" >');
                            html.push('<em class="tag">赠送积分</em>');
                            html.push('<div class="product-prom-con">');
                            html.push("购买即赠商城积分，积分可抵现~");
                            html.push("</div>");
                            html.push("</div>")
                        } else if (pointWeight > 1) {
                            htmldetail.push('<em class="tag">积分翻倍</em>');
                            html.push('<div class="product-prom-item clearfix" >');
                            html.push('<em class="tag">积分翻倍</em>');
                            html.push('<div class="product-prom-con">');
                            html.push("活动赠送翻倍积分，积分可抵现~");
                            html.push("</div>");
                            html.push("</div>")
                        }
                        $("#promBtn p").append(htmldetail.join(""));
                        var htmlproBtn = [];
                        htmlproBtn.push('<div class="product-prom-item clearfix relative" id="promBtn">');
                        htmlproBtn.push($("#promBtn").html());
                        htmlproBtn.push("</div>");
                        $("#promBtn").remove();
                        $(".product-prom").append(html.join(""));
                        $(".product-prom .product-prom-item").hide();
                        if ($("#pro-gift-list-select").find("a").length > 0 && isShowGifts) {
                            if ($("#product-prom-all").children().length > 4) {
                                for (var i = 0; i < 3; i++) {
                                    $(".product-prom-item").eq(i).show()
                                }
                                $(".product-prom").append(htmlproBtn.join(""));
                                $("#promBtn").show();
                                for (var i = 0; i < 2; i++) {
                                    $("#promBtn em").eq(i).hide()
                                }
                            } else {
                                $(".product-prom .product-prom-item").show()
                            }
                        } else {
                            if ($("#product-prom-all").children().length > 5) {
                                for (var i = 1; i < 4; i++) {
                                    $(".product-prom-item").eq(i).show()
                                }
                                $(".product-prom").append(htmlproBtn.join(""));
                                $("#promBtn").show();
                                for (var i = 0; i < 3; i++) {
                                    $("#promBtn em").eq(i).hide()
                                }
                            } else {
                                $(".product-prom .product-prom-item").show()
                            }
                        }
                        if ($(".product-prom").parent().hasClass("hide") || $(".product-prom").parent().css("display") == "none") {
                            $(".product-prom").parent().removeClass("hide");
                            $(".product-prom").parent().css("display", "")
                        }
                        if (!$("#pro-gift-list-select").find("a").length > 0 || !isShowGifts) {
                            $("#pro-match-gift").hide()
                        }
                        ec.product.setSkuPointWeight(sku.code, html.join(" "));
                        ec.product.setSkuPointWeightDetail(sku.code, htmldetail.join(" "));
                        ec.product.refreshStyle()
                    }
                })
            }
        }
    };
    ec.product.refreshStyle = function () {
        var buyBox = $(".product-operation-main");
        var buyBoxHeight = buyBox.height();
        $(".product-property").css("min-height", 536 - buyBoxHeight + "px").css("height", "auto").css("padding-bottom", buyBoxHeight + 30 + "px");
        $(".product-operation-main").removeClass("product-operation-location").addClass("product-operation-location");

        function runRefreshStyle() {
            ec.product.refreshStyle()
        }

        $(".product-choose li").unbind("click").click(runRefreshStyle);
        $(".product-service-detail input").unbind("change").change(runRefreshStyle)
    };
    ec.ready(function () {
        ec.product.hiddenTips();
        $(".product-tab-btn").css({display: "none"});
        var html = [], attrTypeId, attrName, attrValueIds, showText;
        for (var i = 0; i < _skuAttrName.length; i++) {
            attrTypeId = _skuAttrTypeID[i];
            showText = _skuShowType[attrTypeId] == "2";
            attrName = _skuAttrName[i];
            var hml = '<dl class="product-choose clearfix ';
            if (showText) {
                if (attrName == "套餐" || attrName == "类型") {
                    hml += '" id = "bundlePackage" >'
                } else {
                    hml += '">'
                }
            } else {
                if (attrName == "套餐" || attrName == "类型") {
                    hml += ' product-choosepic" id = "bundlePackage" >'
                } else {
                    hml += ' product-choosepic">'
                }
            }
            hml += "<label>选择" + attrName + '</label><div class="product-choose-detail ';
            if (attrName == "套餐" || attrName == "类型") {
                hml += ' relative" id = "bundlePackageSelect" >'
            } else {
                hml += '">'
            }
            hml += "<ul>";
            html.push(hml);
            var values = _skuAttrVallue[attrName];
            for (var j = 0; j < values.length; j++) {
                attrValueIds = _skuAttrType2ValueIds[attrTypeId + "-" + values[j]];
                html.push('<li class=" attr' + attrValueIds.join(" attr") + '" data-attrName="' + attrName + '" data-attrCode="' + attrTypeId + '" data-attrId="' + attrValueIds.join(",") + '" data-skuId="' + _attrValue2SkuId[values[j]].join(",") + '"><div class="sku"><a  href="javascript:;" title="' + values[j] + '">');
                if (showText) {
                    html.push("<p><span>");
                    html.push(values[j]);
                    html.push("</span></p></a>")
                } else {
                    var sku = _skuMap[_skuAttrId2SkuMap[attrValueIds[0]]];
                    html.push('<img src="' + ec.mediaPath + sku.photoPath + "40_40_" + sku.photoName + '" alt="' + values[j] + '"/>');
                    html.push("<p><span>" + values[j] + "</span></p></a>")
                }
            }
            html.push("</ol></dd></dl>")
        }
        var skuObj = $(html.join(""));
        var _checkDisabledSkuAttrValue = function (prevPrdSkuIds, nextAttrSkuDom) {
            var _strPrdSkuIds = nextAttrSkuDom.attr("data-skuId");
            if (nextAttrSkuDom.parents("#packageSelect").length > 0) {
                return true
            }
            if (nextAttrSkuDom.parents("#giftPackageList").length > 0) {
                return true
            }
            var result = false;
            for (var i = 0, length = prevPrdSkuIds.length; i < length; i++) {
                if (_strPrdSkuIds.indexOf(prevPrdSkuIds[i] + "") > -1) {
                    result = true;
                    break
                }
            }
            return result
        };
        var _listenerAttrSkuTrigger = function (skuObj) {
            var _interSectionPrdList = [];
            var _first = true;
            var _skuId = null;
            $.each(skuObj.find("li.selected").not($("#package_dl").find("li.selected")), function () {
                var $li = $(this);
                var key = $li.find("a").attr("title");
                var nextAttrSkuDom;
                if ($li.closest("dl").next().attr("id") == "package_dl") {
                    nextAttrSkuDom = $li.closest("dl").next().next().find("li").not($("#giftPackageList").find("li"))
                } else {
                    nextAttrSkuDom = $li.closest("dl").next().find("li").not($("#giftPackageList").find("li"))
                }
                if (_first) {
                    _interSectionPrdList = _attrValue2SkuId[key];
                    $.each(nextAttrSkuDom, function () {
                        var current = $(this);
                        if (!_checkDisabledSkuAttrValue(_interSectionPrdList, current)) {
                            current.addClass("disabled").removeClass("selected")
                        } else {
                            current.removeClass("disabled")
                        }
                    });
                    _first = false;
                    _skuId = _preSku || ec.product.defaultSku;
                    return
                }
                var _arrTempSkuIds = [];
                var _tempList = _attrValue2SkuId[key];
                for (var i = 0; i < _interSectionPrdList.length; i++) {
                    for (var j = 0; j < _tempList.length; j++) {
                        if (_interSectionPrdList[i] == _tempList[j]) {
                            _arrTempSkuIds.push(_interSectionPrdList[i])
                        }
                    }
                }
                _interSectionPrdList = _arrTempSkuIds;
                if (_interSectionPrdList.length != 1) {
                    _skuId = _preSku || ec.product.defaultSku;
                    if (_interSectionPrdList.length > 1) {
                        $.each(nextAttrSkuDom, function () {
                            var current = $(this);
                            if (!_checkDisabledSkuAttrValue(_interSectionPrdList, current)) {
                                current.addClass("disabled").removeClass("selected")
                            } else {
                                current.removeClass("disabled")
                            }
                        })
                    }
                } else {
                    $.each(nextAttrSkuDom, function () {
                        var current = $(this);
                        if (!_checkDisabledSkuAttrValue(_interSectionPrdList, current)) {
                            current.addClass("disabled").removeClass("selected")
                        } else {
                            current.removeClass("disabled")
                        }
                    });
                    _skuId = _interSectionPrdList[0]
                }
            });
            return _skuId
        };
        skuObj.find(".sku").click(function () {
            var thix = $(this).parent();
            if (thix.hasClass("disabled")) return false;
            var attrIds = thix.attr("data-attrId").split(","), attrName = thix.attr("data-attrName"), skuIds = [];
            for (var i = 0; i < attrIds.length; i++) {
                skuIds.push(_skuAttrId2SkuMap[attrIds[i]])
            }
            _selectAttrMap[attrName] = skuIds;
            thix.addClass("selected").siblings().removeClass("selected");
            $("#layoutRelative p a").each(function () {
                var tab = $(this).css("display");
                if (tab != "none") {
                    $(this).addClass("selected").siblings().removeClass("selected");
                    return false
                }
            });
            var _skuId = _listenerAttrSkuTrigger(skuObj);
            var firstLi = null;
            var interestAllow = "";
            var flag = true;
            $.each(skuObj.find("ul"), function () {
                var $ol = $(this);
                if ($ol.parents("#giftPackageList").length > 0) {
                    return true
                }
                if ($ol.parents("#packageList").length > 0) {
                    return true
                }
                if (1 != $ol.find("li.selected").length) {
                    firstLi = $ol.find("li").not($ol.find("li.disabled")).first();
                    if (firstLi.length >= 1) {
                        flag = false;
                        return false
                    }
                }
                if ($ol.parents("#giftBuy_dl").text() == "增值业务") {
                    ec.product.interest.queryFreeDetail()
                }
            });
            if (flag) {
                sku = _skuMap[_skuId];
                _updateSkuInfo();
                _updateSelect();
                isFirstIn = false;
                ec.product.refreshStyle();
                ec.product.gift.showGiftPackageView($("#bundlePackageSelect").find(".selected").find("a"), true)
            } else if (firstLi) {
                if (!isFirstIn) {
                    $(firstLi).find(".sku").trigger("click")
                }
            }
        });
        if ($(".hot-area").find("li").size() == 0) {
            $(".hot-area").hide();
            $("#pro-seg-hot").hide()
        }
        $("#pro-skus").html(skuObj);
        var giftShowHtml = [];
        giftShowHtml.push('<div id="giftPackageList" class="hide"></div>');
        $("#bundlePackageSelect").append(giftShowHtml.join(""));
        html = [], skuId = ec.product.getSku();
        sku = ec.product.getSkuInfo(skuId);
        if (ec.product.seCode != ec.product.productSeCode) {
            html.push("已包邮<em></em>" + ec.product.productshopName + "发货，并提供售后服务")
        } else {
            if (parseFloat(ec.product.deliveryModeValueFreeBase) > 0 && ec.product.productType == 0) {
                if (sku.priceMode != 2) {
                    if (parseFloat(sku.price) >= parseFloat(ec.product.deliveryModeValueFreeBase)) {
                        html.push("已满" + ec.product.deliveryModeValueFreeBase + "元已免运费<em></em>")
                    } else {
                        html.push("满" + ec.product.deliveryModeValueFreeBase + "元即免运费，快去凑单吧<em></em>")
                    }
                }
            }
            html.push("由华为商城负责发货，并提供售后服务")
        }
        $("#service-description").html(html.join(" "));
        if (skuObj.find(".sku").length == 0) {
            var sku = ec.product.getSku();
            packFlag = false;
            sku = ec.product.getSkuInfo(sku);
            upDownButton = "";
            ec.product.getFeature(sku.id);
            ec.product.getParameter(sku.id, sku.code);
            ec.product.getPackageAndService(sku.id);
            ec.product.processSupportDisplayDilieryTime(sku)
        }
        ec.product.selectBySku(ec.product.setSkuId || ec.product.defaultSku);
        var skuIdForGift = ec.product.setSkuId || ec.product.defaultSku, skuForPromotion, showPromotion = false,
            showGifts = false;
        skuForPromotion = ec.product.getSkuInfo(skuIdForGift);
        if (!skuForPromotion.promotionLst || skuForPromotion.promotionLst.length == 0) {
            showPromotion = false
        } else {
            showPromotion = true
        }
        if (!skuForPromotion.giftList || skuForPromotion.giftList.length == 0) {
            showGifts = false
        } else {
            isShowGifts = false;
            for (var i = 0; i < skuForPromotion.giftList.length; i++) {
                if (sku.giftList[i].displayType == 1) {
                    isShowGifts = true;
                    break
                }
            }
        }
        if (!showPromotion) {
            $("#pro-promotions-list").html("");
            $("#pro-promotions-list").hide()
        }
        if (showGifts) {
            $("#product-info-list-new").show();
            $("#pro-match-gift").show();
            $("#pro-gift-list-select").html(ec.product.gift.ftl(ec.product.getSku()))
        } else {
            if ($("#product-prom-all").find("product-prom-item").length = 1) {
                if ($("#product-prom-all").find("product-prom-item").attr("id") == "pro-match-gift") {
                    $("#product-info-list-new").hide()
                }
            }
            $("#pro-gift").hide()
        }
        $("#pro-gallerys").find("img").mouseover(_proGallerysMouseOver);
        var paras = getUrlParaMap4CartBinding();
        var isSuccess = paras["isSuccess"];
        if (null != isSuccess && "0" == isSuccess) {
            bindCartResult("ec-binding-phone")
        }
        $("#address").hover(function () {
            var sku = ec.product.getSku();
            sku = ec.product.getSkuInfo(sku);
            ec.product.processAddress(sku)
        }, function () {
        });
        ec.product.gift.showGiftPackageView($("#bundlePackageSelect").find(".selected").find("a"), false)
    })
})();
ec.product.disableAddCartButtons = function () {
    $("#pro-operation a.product-button01").each(function () {
        $(this).removeClass("product-button01").addClass("product-button01 disabled");
        this.backup = this.onclick;
        this.onclick = ""
    });
    $("#pro-operation a.product-button02").each(function () {
        $(this).removeClass("product-button02").addClass("product-button02 disabled");
        this.backup = this.onclick;
        this.onclick = ""
    });
    $("#pro-operation a.button-book-2").each(function () {
        $(this).removeClass("pro-button01 button-style-2").addClass("pro-button01 button-style-disabled-2");
        this.backup = this.onclick;
        this.onclick = ""
    });
    $("a.button-add-cart-2, a.button-add-cart-3").each(function () {
        $(this).removeClass("pro-button01 button-style-1").addClass("pro-button01 button-style-disabled-2");
        this.backup = this.onclick;
        this.onclick = ""
    })
};
ec.product.enableAddCartButtons = function () {
    $("#pro-operation a.product-button01").each(function () {
        $(this).removeClass("product-button01 disabled").addClass("product-button01").css("background-position-y", "8px");
        this.onclick = this.backup;
        this.backup = ""
    });
    $("#pro-operation a.product-button02").each(function () {
        $(this).removeClass("product-button02 disabled").addClass("product-button02").css("background-position-y", "8px");
        this.onclick = this.backup;
        this.backup = ""
    });
    $("#pro-operation a.button-book-2").each(function () {
        $(this).removeClass("pro-button01 button-style-disabled-2").addClass("pro-button01 button-style-2");
        this.onclick = this.backup;
        this.backup = ""
    });
    $("a.button-add-cart-2, a.button-add-cart-3").each(function () {
        $(this).removeClass("pro-button01 button-style-disabled-2").addClass("pro-button01 button-style-1");
        this.onclick = this.backup;
        this.backup = ""
    })
};
ec.product.addCart = function () {
    var buyNumber = parseInt($("#pro-quantity").val()), cartNUmber = parseInt($("#header-cart-total").html());
    $("#header-cart-total").html(cartNUmber + buyNumber);
    $(".j-hungBar .hungBar-cart span").show().html(cartNUmber + buyNumber);
    var skusListArr = $("#pro-skus").find("dl").not($("#giftPackageList").find("dl")).not($("#packageList").find("dl"));
    for (p = 0; p < skusListArr.length; p++) {
        var flag = false;
        var skuInfoArr = skusListArr.get(p);
        $(skuInfoArr).children(".product-choose-detail").children("ul").find("li").each(function (index) {
            if ($(this).parents("#giftPackageList").length > 0 || $(this).parents("#packageList").length > 0) {
                return true
            }
            if ($(this).hasClass("selected")) {
                flag = true;
                return
            }
        });
        if (!flag) {
            alert("请选择需要购买的类型");
            return false
        }
    }
    ec.product.disableAddCartButtons();
    var paras;
    var skuId = ec.product.getSku();
    var buyNum = parseInt($("#pro-quantity").val());
    var type = ec.cart.productTypeCorrespondence(ec.product.productType);
    var extendServiceSkuID = $("#extendSelect").attr("skuid");
    var accidentServiceSkuID = $("#accidentSelect").attr("skuid");
    var finalGift = ec.product.gift.finalMainSbomGiftMap[skuId];
    var cartjson = "";
    var gifts = [];
    var gifts2Cart = "";
    var gifts2Order = [];
    var temp = ec.product.finalGift();
    paras = {salePortal: 1, saleChannel: 1001, needResultset: 0, cartjson: temp.cartjson};
    var orderItemReqArgList = [];
    var orderitem = {};
    orderitem.itemId = $("#pro-sku-code").val();
    orderitem.qty = $("#pro-quantity").val();
    orderitem.itemType = "S0";
    var gifts2Order = temp.gifts2Order;
    orderitem.gifts = gifts2Order;
    orderItemReqArgList.push(orderitem);
    var extendSbomCode = $("#extendSelect").attr("data-scode");
    var accidentSbomCode = $("#accidentSelect").attr("data-scode");
    var extendSkuCodes = [], extendItem = {}, accidentItem = {};
    if (extendSbomCode.length > 0) {
        extendItem.itemId = extendSbomCode;
        extendItem.qty = $("#pro-quantity").val();
        extendItem.itemType = "S1";
        extendItem.itemProp = {main_skucode: $("#pro-sku-code").val()};
        orderItemReqArgList.push(extendItem);
        if (accidentSbomCode.length > 0) {
            accidentItem.itemId = accidentSbomCode;
            accidentItem.qty = $("#pro-quantity").val();
            accidentItem.itemType = "S6";
            accidentItem.itemProp = {main_skucode: $("#pro-sku-code").val()};
            orderItemReqArgList.push(accidentItem)
        }
    } else {
        if (accidentSbomCode.length > 0) {
            accidentItem.itemId = accidentSbomCode;
            accidentItem.qty = $("#pro-quantity").val();
            accidentItem.itemType = "S6";
            accidentItem.itemProp = {main_skucode: $("#pro-sku-code").val()};
            orderItemReqArgList.push(accidentItem)
        }
    }
    var jsonReqArg = ec.lang.json.stringify(orderItemReqArgList);
    ec.cart.add(paras, {
        successFunction: function (json) {
            if (json.resultCode == 2e5) {
                var cartInfo = json.cartInfo;
                var cartText = $("#pro-name").text() + "成功加入购物车!";
                var computeRes = ec.product.compute($("#pro-add-success-mask"), cartText);
                if (computeRes.h > 27) {
                    $("#cart-tips").find("p").parent().removeClass("box-right-1").addClass("box-right-2")
                } else {
                    $("#cart-tips").find("p").parent().removeClass("box-right-2").addClass("box-right-1")
                }
                $("#cart-tips").find("p").html(cartText);
                $(".pro-add-success-total").hide();
                $("#header-cart-total").html(json.cartNumber);
                $(".j-hungBar .hungBar-cart span").show().html(json.cartNumber);
                var box = new ec.box($("#cart-tips").html(), {boxclass: "ol_box_4", showButton: false}).open()
            }
            ec.product.enableAddCartButtons()
        }, errorFunction: function (json) {
            var box = new ec.box('<div class="box-errors-1"><span>' + json.msg + "</span></div>", {
                boxclass: "ol_box_4",
                showButton: true
            }).open();
            ec.product.enableAddCartButtons()
        }
    });
    ec.product.clickHide = function (id) {
        $(document).click(function () {
            $("#" + id).hide()
        });
        $("#" + id).click(function (event) {
            event.stopPropagation()
        })
    };
    ec.product.clickHide("cart-tips")
};
ec.product.compute = function (dom, val) {
    dom.text(val);
    return {w: dom[0].offsetWidth, h: dom[0].offsetHeight}
};
ec.product.finalGift = function (style) {
    ec.product.packageGetSkuCode();
    var temp = "";
    var cartjson = "";
    var skuId = ec.product.getSku();
    var type;
    var skuCode = $("#pro-sku-code").val();
    var buyNum = parseInt($("#pro-quantity").val());
    var extendServiceSkuID = $("#extendSelect").attr("data-scode");
    var accidentServiceSkuID = $("#accidentSelect").attr("data-scode");
    var finalGift = ec.product.gift.finalMainSbomGiftMap[skuId];
    var gifts = [];
    var gifts2Cart = [];
    var gifts2Order = [];
    var otherPrdList = [];
    var defnum = 1;
    var attrs = "";
    if ($("#packageCode").val() != "") {
        type = "P";
        attrs = {package_code: $("#packageCode").val()};
        var packagelist = $("#packageListCode").val().split(",");
        for (var i = 0; i < packagelist.length; i++) {
            cartTemp = {itemCode: packagelist[i], itemType: "P", qty: buyNum};
            otherPrdList.push(cartTemp)
        }
    } else {
        type = "S0"
    }
    if (finalGift) {
        for (var key in finalGift) {
            var aGift = {sbomCode: finalGift[key].giftSkuCode};
            var bGift = {sbomCode: finalGift[key].giftSkuId};
            gifts2Cart.push(bGift);
            gifts2Order.push(aGift);
            cartTemp = {itemCode: finalGift[key].giftSkuCode, itemType: "G", qty: buyNum};
            otherPrdList.push(cartTemp)
        }
        if (ec.product.gift.packageGiftMap[skuId]) {
            for (var giftKey = 0; giftKey < ec.product.gift.packageGiftMap[skuId].length; giftKey++) {
                cartTemp = {itemCode: ec.product.gift.packageGiftMap[skuId][giftKey], itemType: "G", qty: buyNum};
                otherPrdList.push(cartTemp)
            }
        }
        if (extendServiceSkuID.length > 0 && accidentServiceSkuID.length > 0) {
            otherPrdList.push({itemCode: extendServiceSkuID, itemType: "S1", qty: buyNum});
            otherPrdList.push({itemCode: accidentServiceSkuID, itemType: "S6", qty: buyNum});
            cartjson = JSON.stringify({
                itemCode: skuCode,
                itemType: type,
                qty: buyNum,
                subs: otherPrdList,
                attrs: attrs
            })
        } else {
            if (extendServiceSkuID.length > 0) {
                otherPrdList.push({itemCode: extendServiceSkuID, itemType: "S1", qty: buyNum});
                cartjson = JSON.stringify({
                    itemCode: skuCode,
                    itemType: type,
                    qty: buyNum,
                    subs: otherPrdList,
                    attrs: attrs
                })
            } else if (accidentServiceSkuID.length > 0) {
                otherPrdList.push({itemCode: accidentServiceSkuID, itemType: "S6", qty: buyNum});
                cartjson = JSON.stringify({
                    itemCode: skuCode,
                    itemType: type,
                    qty: buyNum,
                    subs: otherPrdList,
                    attrs: attrs
                })
            } else {
                cartjson = JSON.stringify({
                    itemCode: skuCode,
                    itemType: type,
                    qty: buyNum,
                    subs: otherPrdList,
                    attrs: attrs
                })
            }
        }
    } else {
        if (ec.product.gift.packageGiftMap[skuId]) {
            for (var giftKey = 0; giftKey < ec.product.gift.packageGiftMap[skuId].length; giftKey++) {
                cartTemp = {itemCode: ec.product.gift.packageGiftMap[skuId][giftKey], itemType: "G", qty: buyNum};
                otherPrdList.push(cartTemp)
            }
        }
        if (extendServiceSkuID.length > 0 && accidentServiceSkuID.length > 0) {
            otherPrdList.push({itemCode: extendServiceSkuID, itemType: "S1", qty: buyNum});
            otherPrdList.push({itemCode: accidentServiceSkuID, itemType: "S6", qty: buyNum});
            cartjson = JSON.stringify({
                itemCode: skuCode,
                itemType: type,
                qty: buyNum,
                subs: otherPrdList,
                attrs: attrs
            })
        } else {
            if (extendServiceSkuID.length > 0) {
                otherPrdList.push({itemCode: extendServiceSkuID, itemType: "S1", qty: buyNum});
                cartjson = JSON.stringify({
                    itemCode: skuCode,
                    itemType: type,
                    qty: buyNum,
                    subs: otherPrdList,
                    attrs: attrs
                })
            } else if (accidentServiceSkuID.length > 0) {
                otherPrdList.push({itemCode: accidentServiceSkuID, itemType: "S6", qty: buyNum});
                cartjson = JSON.stringify({
                    itemCode: skuCode,
                    itemType: type,
                    qty: buyNum,
                    subs: otherPrdList,
                    attrs: attrs
                })
            } else {
                cartjson0 = {itemCode: skuCode, itemType: type, qty: buyNum, attrs: attrs, subs: otherPrdList};
                cartjson = JSON.stringify(cartjson0)
            }
        }
    }
    temp = {cartjson: cartjson};
    return temp
};
ec.product.orderNowCover = function () {
    ec.product.isCover = true;
    ec.account.afterLogin(function () {
        var skusListArr = $("#pro-skus").find("dl").not($("#giftPackageList").find("dl")).not($("#packageList").find("dl"));
        for (p = 0; p < skusListArr.length; p++) {
            var flag = false;
            var skuInfoArr = skusListArr.get(p);
            $(skuInfoArr).children(".product-choose-detail").children("ul").find("li").each(function (index) {
                if ($(this).parents("#giftPackageList").length > 0 || $(this).parents("#packageList").length > 0) {
                    return true
                }
                if ($(this).hasClass("selected")) {
                    flag = true;
                    return
                }
            });
            if (!flag) {
                alert("请选择需要购买的类型");
                return false
            }
        }
        ec.product.disableAddCartButtons();
        var sbomCode;
        var quantity;
        var extendServiceSKU;
        var exceptionServiceSKU;
        var extendSkuIds = [];
        sbomCode = ec.product.getSku();
        sbomCode = $("#pro-sku-code").val();
        quantity = $("#pro-quantity").val();
        extendServiceSKU = $("#extendSelect").attr("skuid");
        exceptionServiceSKU = $("#accidentSelect").attr("skuid");
        var input = "";
        input = '<input name="sbomCode" type="text" value="' + sbomCode + '">';
        input += '<input name="quantity" type="text" value="' + quantity + '">';
        if (extendServiceSKU) {
            input += '<input name="extendServiceSKU" type="text" value="' + extendServiceSKU + '">'
        }
        if (exceptionServiceSKU) {
            input += '<input name="exceptionServiceSKU" type="text" value="' + exceptionServiceSKU + '">'
        }
        input += '<input name="state" type="text" value="0">';
        var form = gid("order-cover-form");
        form.innerHTML = input;
        ec.binding.isBindedMobileOrEnterpriseUser(function () {
            setTimeout(function () {
                form.action = domainMain + "/uidesign/edit";
                form.submit()
            }, 500)
        })
    })
};
ec.product.orderEasyBuy = function () {
    var skusListArr = $("#pro-skus").find("dl").not($("#giftPackageList").find("dl")).not($("#packageList").find("dl"));
    for (p = 0; p < skusListArr.length; p++) {
        var flag = false;
        var skuInfoArr = skusListArr.get(p);
        $(skuInfoArr).children(".product-choose-detail").children("ul").find("li").each(function (index) {
            if ($(this).parents("#giftPackageList").length > 0 || $(this).parents("#packageList").length > 0) {
                return true
            }
            if ($(this).hasClass("selected")) {
                flag = true;
                return
            }
        });
        if (!flag) {
            alert("请选择需要购买的类型");
            return false
        }
    }
    var skuId = ec.product.getSku();
    var skuInfo = ec.product.getSkuInfo(skuId);
    var finalGift = ec.product.gift.finalMainSbomGiftMap[skuId];
    var skuCode = $("#pro-sku-code").val(), extendCode = $("#extendSelect").attr("data-scode"),
        accidentCode = $("#accidentSelect").attr("data-scode"), giftCodes = "";
    if (finalGift) {
        var giftCodeList = [];
        for (var key in finalGift) {
            giftCodeList.push(finalGift[key].giftSkuCode)
        }
        giftCodes = giftCodeList.join(",")
    }
    if (skuInfo.easyBuyPcUrl != "") {
        window.location.href = skuInfo.easyBuyPcUrl
    }
};
ec.product.isEasyBuy = function () {
    var skuInfo = ec.product.getSkuInfo(ec.product.getSku());
    var isPriority = $("#isPriority").val();
    var isPrioritySku = ec.product.getSkuPriority(ec.product.getSku());
    if (isPriority == 1 && isPrioritySku == true) {
        return false
    }
    if (skuInfo && skuInfo.showEasyBuy == "1") {
        var easyBuyStartTime = skuInfo.easyBuyStartTime;
        var easyBuyEndTime = skuInfo.easyBuyEndTime;
        if (easyBuyStartTime != "" && easyBuyEndTime != "") {
            var nowTime = ec.product.getSysDate();
            var eBuyStartTime = new Date;
            eBuyStartTime.setTime(easyBuyStartTime.parseDate("yyyy-MM-dd HH:mm:ss"));
            var eBuyEndTime = new Date;
            eBuyEndTime.setTime(easyBuyEndTime.parseDate("yyyy-MM-dd HH:mm:ss"));
            if (nowTime - eBuyStartTime > 0 && nowTime - eBuyEndTime < 0) {
                if (skuInfo.webEnabled == "1") {
                    return true
                }
            }
        } else if (easyBuyStartTime != "") {
            var nowTime = ec.product.getSysDate();
            var eBuyStartTime = new Date;
            eBuyStartTime.setTime(easyBuyStartTime.parseDate("yyyy-MM-dd HH:mm:ss"));
            if (nowTime - eBuyStartTime > 0) {
                if (skuInfo.webEnabled == "1") {
                    return true
                }
            }
        }
    }
    return false
};
ec.product.renderVisitorButton = function (appendSelector) {
    var isValCas = ec.util.cookie.get("isValCas"), casLogin = ec.util.cookie.get("CASLOGIN"),
        uid = ec.util.cookie.get("uid"), displayName = ec.util.cookie.get("displayName");
    if (ec.account.isLogin() || isValCas != null || casLogin != null || uid != null || displayName != null) {
        return
    }
    var skuInfo = ec.product.getSkuInfo(ec.product.getSku() || ec.product.defaultSku);
    skuId = skuInfo.id;
    if (ec.product.isSupportVisitorMode != "1" || ec.product.productType == 4 || rush.sbom.isRushProduct() || rush.sbom.isRushSbom(skuId)) {
        return
    }
    $("#product-deposit-agreement-area").next().remove()
};
ec.product.orderNowByVisitor = function (giftBuyTemp) {
    var skusListArr = $("#pro-skus").find("dl").not($("#giftPackageList").find("dl")).not($("#packageList").find("dl"));
    for (p = 0; p < skusListArr.length; p++) {
        var flag = false;
        var skuInfoArr = skusListArr.get(p);
        $(skuInfoArr).children(".product-choose-detail").children("ul").find("li").each(function (index) {
            if ($(this).parents("#giftPackageList").length > 0 || $(this).parents("#packageList").length > 0) {
                return true
            }
            if ($(this).hasClass("selected")) {
                flag = true;
                return
            }
        });
        if (!flag) {
            alert("请选择需要购买的类型");
            return false
        }
    }
    ec.product.disableAddCartButtons();
    var orderItemReqArgList = [];
    var orderitem = {};
    orderitem.itemId = $("#pro-sku-code").val();
    orderitem.qty = $("#pro-quantity").val();
    orderitem.itemType = "S0";
    if (ec.product.productType == 9) {
        orderitem.itemType = "S9"
    }
    var finalGift = ec.product.gift.finalMainSbomGiftMap[ec.product.getSku()];
    var skuIds = ec.product.getSku();
    var gifts2Order = [];
    if (finalGift) {
        for (var key in finalGift) {
            var aGift = {sbomCode: finalGift[key].giftSkuCode};
            gifts2Order.push(aGift)
        }
    }
    if (ec.product.gift.packageGiftMap[skuIds]) {
        for (var giftKey = 0; giftKey < ec.product.gift.packageGiftMap[skuIds].length; giftKey++) {
            var pGift = {sbomCode: ec.product.gift.packageGiftMap[skuIds][giftKey]};
            gifts2Order.push(pGift)
        }
    }
    orderitem.gifts = gifts2Order;
    orderitem.subOrderItemReqArgs = [];
    var packageCode = $("#packageCode").val();
    if (packageCode != "") {
        orderitem.itemType = "P";
        var packageCodeList = {package_code: packageCode};
        orderitem.itemProp = packageCodeList
    }
    var packageSkuCode = $("#packageListCode").val();
    if (packageSkuCode != "") {
        $.each(packageSkuCode.split(","), function (index, value) {
            var apack = {itemId: value, qty: $("#pro-quantity").val(), itemType: "P"};
            orderitem.subOrderItemReqArgs.push(apack)
        })
    }
    var extendSbomCode = $("#extendSelect").attr("data-scode");
    var accidentSbomCode = $("#accidentSelect").attr("data-scode");
    var extendSkuCodes = [], extendItem = {}, accidentItem = {};
    if (extendSbomCode.length > 0) {
        extendSkuCodes[0] = extendSbomCode;
        if (accidentSbomCode.length > 0) {
            extendSkuCodes[1] = accidentSbomCode
        }
    } else {
        if (accidentSbomCode.length > 0) {
            extendSkuCodes[0] = accidentSbomCode
        }
    }
    var giftBuyItem = {};
    if (giftBuyTemp == 2 && _giftBuyItemId.length > 0) {
        giftBuyItem.itemId = _giftBuyItemId[0];
        giftBuyItem.qty = $("#pro-quantity").val();
        giftBuyItem.itemType = "S10";
        giftBuyItem.mainSkuCode = $("#pro-sku-code").val();
        orderitem.subOrderItemReqArgs.push(giftBuyItem)
    }
    var extendItem = {};
    var accidentItem = {};
    if (extendSbomCode.length > 0) {
        extendItem.itemId = extendSkuCodes[0];
        extendItem.qty = $("#pro-quantity").val();
        extendItem.itemType = "S1";
        extendItem.mainSkuCode = $("#pro-sku-code").val();
        orderitem.subOrderItemReqArgs.push(extendItem);
        if (accidentSbomCode.length > 0) {
            accidentItem.itemId = extendSkuCodes[1];
            accidentItem.qty = $("#pro-quantity").val();
            accidentItem.itemType = "S6";
            accidentItem.mainSkuCode = $("#pro-sku-code").val();
            orderitem.subOrderItemReqArgs.push(accidentItem)
        }
    } else {
        if (accidentSbomCode.length > 0) {
            accidentItem.itemId = extendSkuCodes[0];
            accidentItem.qty = $("#pro-quantity").val();
            accidentItem.itemType = "S6";
            accidentItem.mainSkuCode = $("#pro-sku-code").val();
            orderitem.subOrderItemReqArgs.push(accidentItem)
        }
    }
    orderItemReqArgList.push(orderitem);
    var jsonReqArg = ec.lang.json.stringify(orderItemReqArgList);
    var input = "";
    input += '<input name="orderReqJson" type="text" value=\'' + jsonReqArg + "'>";
    input += '<input name="state" type="text" value="0">';
    if (giftBuyTemp == 2 && _giftBuyItemId.length > 0) {
        input += '<input name="routingTag" type="hidden" value="30">'
    }
    var getSku = ec.product.getSkuInfo(ec.product.getSku() || ec.product.defaultSku);
    if (ec.product.productType == 9) {
        if (parseInt(getSku.buttonMode) == 18) {
            input += '<input name="routingTag" type="text" value="36">'
        } else {
            input += '<input name="routingTag" type="text" value="28">'
        }
    }
    var getSku = ec.product.getSkuInfo(ec.product.getSku() || ec.product.defaultSku);
    if (ec.product.isSupportVisitorMode == "1") {
        $("#order-confirm-form").attr("action", "/visitor/vistorConfirm")
    }
    var form = gid("order-confirm-form");
    form.innerHTML = input;
    form.submit()
};
ec.product.orderNow = function (giftBuyTemp, orderFrom) {
    ec.product.isGift = giftBuyTemp;
    ec.product.isCover = false;
    ec.product.isComb = false;
    ec.account.afterLogin(function () {
        var skusListArr = $("#pro-skus").find("dl").not($("#giftPackageList").find("dl")).not($("#packageList").find("dl"));
        for (p = 0; p < skusListArr.length; p++) {
            var flag = false;
            var skuInfoArr = skusListArr.get(p);
            $(skuInfoArr).children(".product-choose-detail").children("ul").find("li").each(function (index) {
                if ($(this).parents("#giftPackageList").length > 0 || $(this).parents("#packageList").length > 0) {
                    return true
                }
                if ($(this).hasClass("selected")) {
                    flag = true;
                    return
                }
            });
            if (!flag) {
                alert("请选择需要购买的类型");
                return false
            }
        }
        ec.product.disableAddCartButtons();
        var orderItemReqArgList = [];
        var orderitem = {};
        orderitem.itemId = $("#pro-sku-code").val();
        orderitem.qty = $("#pro-quantity").val();
        orderitem.itemType = "S0";
        if (ec.product.productType == 9) {
            orderitem.itemType = "S9"
        }
        var finalGift = ec.product.gift.finalMainSbomGiftMap[ec.product.getSku()];
        var skuIds = ec.product.getSku();
        var gifts2Order = [];
        if (finalGift) {
            for (var key in finalGift) {
                var aGift = {sbomCode: finalGift[key].giftSkuCode};
                gifts2Order.push(aGift)
            }
        }
        if (ec.product.gift.packageGiftMap[skuIds]) {
            for (var giftKey = 0; giftKey < ec.product.gift.packageGiftMap[skuIds].length; giftKey++) {
                var pGift = {sbomCode: ec.product.gift.packageGiftMap[skuIds][giftKey]};
                gifts2Order.push(pGift)
            }
        }
        orderitem.gifts = gifts2Order;
        orderitem.subOrderItemReqArgs = [];
        var packageCode = $("#packageCode").val();
        if (packageCode != "") {
            orderitem.itemType = "P";
            var packageCodeList = {package_code: packageCode};
            orderitem.itemProp = packageCodeList
        }
        var packageSkuCode = $("#packageListCode").val();
        if (packageSkuCode != "") {
            $.each(packageSkuCode.split(","), function (index, value) {
                var apack = {itemId: value, qty: $("#pro-quantity").val(), itemType: "P"};
                orderitem.subOrderItemReqArgs.push(apack)
            })
        }
        var extendSbomCode = $("#extendSelect").attr("data-scode");
        var accidentSbomCode = $("#accidentSelect").attr("data-scode");
        var extendSkuCodes = [], extendItem = {}, accidentItem = {};
        if (extendSbomCode.length > 0) {
            extendSkuCodes[0] = extendSbomCode;
            if (accidentSbomCode.length > 0) {
                extendSkuCodes[1] = accidentSbomCode
            }
        } else {
            if (accidentSbomCode.length > 0) {
                extendSkuCodes[0] = accidentSbomCode
            }
        }
        var giftBuyItem = {};
        if (giftBuyTemp == 2 && _giftBuyItemId.length > 0) {
            giftBuyItem.itemId = _giftBuyItemId[0];
            giftBuyItem.qty = $("#pro-quantity").val();
            giftBuyItem.itemType = "S10";
            giftBuyItem.mainSkuCode = $("#pro-sku-code").val();
            orderitem.subOrderItemReqArgs.push(giftBuyItem)
        }
        var extendItem = {};
        var accidentItem = {};
        if (extendSbomCode.length > 0) {
            extendItem.itemId = extendSkuCodes[0];
            extendItem.qty = $("#pro-quantity").val();
            extendItem.itemType = "S1";
            extendItem.mainSkuCode = $("#pro-sku-code").val();
            orderitem.subOrderItemReqArgs.push(extendItem);
            if (accidentSbomCode.length > 0) {
                accidentItem.itemId = extendSkuCodes[1];
                accidentItem.qty = $("#pro-quantity").val();
                accidentItem.itemType = "S6";
                accidentItem.mainSkuCode = $("#pro-sku-code").val();
                orderitem.subOrderItemReqArgs.push(accidentItem)
            }
        } else {
            if (accidentSbomCode.length > 0) {
                accidentItem.itemId = extendSkuCodes[0];
                accidentItem.qty = $("#pro-quantity").val();
                accidentItem.itemType = "S6";
                accidentItem.mainSkuCode = $("#pro-sku-code").val();
                orderitem.subOrderItemReqArgs.push(accidentItem)
            }
        }
        orderItemReqArgList.push(orderitem);
        var jsonReqArg = ec.lang.json.stringify(orderItemReqArgList);
        ec.loadCsrfToken(function () {
            var input = '<input name="CsrfToken" id="CsrfToken" type="hidden" value="' + csrftoken + '">';
            input += '<input name="orderReqJson" type="text" value=\'' + jsonReqArg + "'>";
            input += '<input name="state" type="text" value="0">';
            if (giftBuyTemp == 2 && _giftBuyItemId.length > 0) {
                input += '<input name="routingTag" type="hidden" value="30">'
            }
            var getSku = ec.product.getSkuInfo(ec.product.getSku() || ec.product.defaultSku);
            if (ec.product.productType == 9) {
                if (parseInt(getSku.buttonMode) == 18) {
                    input += '<input name="routingTag" type="text" value="36">'
                } else {
                    input += '<input name="routingTag" type="text" value="28">'
                }
            }
            if ($("#interestOrderNow").val() != "" && orderFrom == "HB") {
                input += '<input name="interest" type="text" value="' + $("#interestOrderNow").val() + '">'
            }
            if ($("#interestOrderNow2").val() != "" && orderFrom == "HL") {
                input += '<input name="interest" type="text" value="' + $("#interestOrderNow2").val() + '">'
            }
            var getSku = ec.product.getSkuInfo(ec.product.getSku() || ec.product.defaultSku);
            var form = gid("order-confirm-form");
            form.innerHTML = input;
            ec.binding.isBindedMobileOrEnterpriseUser(function () {
                setTimeout(function () {
                    form.submit()
                }, 500)
            })
        })
    }, "visitorInfo")
};
ec.product.addCartWithLogin = function () {
    ec.account.afterLogin(ec.product.addCart)
};
ec.product.buyBundle = function (bundleCode, dom) {
    var buttonName = $(dom).html();
    var skucode = $("#pro-sku-code").val();
    var num = $("#pro-quantity").val();
    var packageCode = $("#packageCode").val();
    var packageSKUCode = $("#packageListCode").val();
    pushBottonMsg(buttonName, num, skucode, packageCode, packageSKUCode, "300020402");
    ec.product.disableAddCartButtons();
    var temp = ec.product.finalGift(bundleCode);
    paras = {cartjson: temp.cartjson};
    ec.cart.add(paras, {
        successFunction: function (json) {
            ec.product.enableAddCartButtons();
            $("#order-shoppingCart-form").submit()
        }, errorFunction: function (json) {
            ec.product.enableAddCartButtons();
            alert(json.msg)
        }
    })
};
ec.product.addComb = function (thix) {
    var dataIndex = $(thix).attr("data-index");
    var orderItemReqArgList = [];
    var id = ec.product.getSku(), skuIds = [id], quantity = [1], type = [1], isPriority = $("#isPriority").val();
    skuCode = $("#pro-sku-code").val();
    var mainItem = {};
    mainItem.itemCode = $("#pro-sku-code").val();
    mainItem.qty = 1;
    mainItem.itemType = "S0";
    orderItemReqArgList.push(mainItem);
    var comboToCart = [];
    var mainProduct = {itemCode: skuCode, itemType: "S0", qty: 1};
    comboToCart.push(mainProduct);
    $('[id="comb-pro-' + id + "-" + dataIndex + '"]').find("input[name=skuId]:checked").each(function () {
        skuIds.push(this.value);
        quantity.push(1);
        type.push(1);
        var orderitem = {};
        orderitem.itemId = this.value;
        orderitem.qty = 1;
        orderitem.itemType = "S0";
        orderItemReqArgList.push(orderitem);
        var combo = {itemType: "S0", qty: 1, itemCode: $(this).attr("data-scode")};
        comboToCart.push(combo)
    });
    var paras = {number: 1, cartjson: JSON.stringify(comboToCart)};
    if (isPriority == 1) {
        if (ec.product.getSkuPriority(id) == true) {
            return ec.product.buy("sku", skuIds)
        }
    }
    $("#order-confirm-form").attr({action: "/order/nowConfirmcart", method: "post"});
    ec.product.disableAddCartButtons();
    var jsonReqArg = ec.lang.json.stringify(orderItemReqArgList);
    ec.cart.add(paras, {
        successFunction: function (json) {
            ec.product.enableAddCartButtons();
            $("#order-shoppingCart-form").submit()
        }, errorFunction: function (json) {
            ec.product.enableAddCartButtons();
            alert(json.msg)
        }
    })
};
ec.product.orderComb = function (thix) {
    ec.product.isComb = true;
    ec.account.afterLogin(function () {
        var skusListArr = $("#pro-skus").find("dl").not($("#giftPackageList").find("dl")).not($("#packageList").find("dl"));
        for (p = 0; p < skusListArr.length; p++) {
            var flag = false;
            var skuInfoArr = skusListArr.get(p);
            $(skuInfoArr).children(".product-choose-detail").children("ul").find("li").each(function (index) {
                if ($(this).parents("#giftPackageList").length > 0 || $(this).parents("#packageList").length > 0) {
                    return true
                }
                if ($(this).hasClass("selected")) {
                    flag = true;
                    return
                }
            });
            if (!flag) {
                alert("请选择需要购买的类型");
                return false
            }
        }
        ec.product.disableAddCartButtons();
        var dataIndex = $(thix).attr("data-index");
        var orderItemReqArgList = [];
        var orderitem = {};
        $('[id="comb-pro-' + ec.product.getSku() + "-" + dataIndex + '"]').find("input[name=skuId]:checked").each(function () {
            var orderitem = {};
            orderitem.itemId = $(this).attr("data-scode");
            orderitem.qty = 1;
            orderitem.itemType = "S0";
            orderItemReqArgList.push(orderitem)
        });
        orderitem.itemId = $("#pro-sku-code").val();
        orderitem.qty = $("#pro-quantity").val();
        orderitem.itemType = "S0";
        if (ec.product.productType == 9) {
            orderitem.itemType = "S9"
        }
        var finalGift = ec.product.gift.finalMainSbomGiftMap[ec.product.getSku()];
        var skuIds = ec.product.getSku();
        var gifts2Order = [];
        if (finalGift) {
            for (var key in finalGift) {
                var aGift = {sbomCode: finalGift[key].giftSkuCode};
                gifts2Order.push(aGift)
            }
        }
        if (ec.product.gift.packageGiftMap[skuIds]) {
            for (var giftKey = 0; giftKey < ec.product.gift.packageGiftMap[skuIds].length; giftKey++) {
                var pGift = {sbomCode: ec.product.gift.packageGiftMap[skuIds][giftKey]};
                gifts2Order.push(pGift)
            }
        }
        orderitem.gifts = gifts2Order;
        orderItemReqArgList.push(orderitem);
        var jsonReqArg = ec.lang.json.stringify(orderItemReqArgList);
        var input = "";
        input += '<input name="orderReqJson" type="text" value=\'' + jsonReqArg + "'>";
        input += '<input name="state" type="text" value="0">';
        var getSku = ec.product.getSkuInfo(ec.product.getSku() || ec.product.defaultSku);
        if (ec.product.productType == 9) {
            if (parseInt(getSku.buttonMode) == 18) {
                input += '<input name="routingTag" type="text" value="36">'
            } else {
                input += '<input name="routingTag" type="text" value="28">'
            }
        }
        input += '<input name="CsrfToken" id="CsrfToken" type="hidden" value="' + csrftoken + '"/>';
        var getSku = ec.product.getSkuInfo(ec.product.getSku() || ec.product.defaultSku);
        var form = gid("order-confirm-form");
        form.innerHTML = input;
        ec.binding.isBindedMobileOrEnterpriseUser(function () {
            setTimeout(function () {
                form.submit()
            }, 500)
        })
    })
};
ec.product.buy = function (type, id) {
    ec.account.afterLogin(function () {
        var input = "";
        if (type == "sku") {
            var orderItemReqArgList = [];
            var orderitem = {};
            orderitem.itemId = $("#pro-sku-code").val();
            orderitem.qty = 1;
            orderitem.itemType = "S0";
            var finalGift = ec.product.gift.finalMainSbomGiftMap[ec.product.getSku()];
            var skuIds = ec.product.getSku();
            var gifts2Order = [];
            if (finalGift) {
                for (var key in finalGift) {
                    var aGift = {sbomCode: finalGift[key].giftSkuCode};
                    gifts2Order.push(aGift)
                }
            }
            if (ec.product.gift.packageGiftMap[skuIds]) {
                for (var giftKey = 0; giftKey < ec.product.gift.packageGiftMap[skuIds].length; giftKey++) {
                    var pGift = {sbomCode: ec.product.gift.packageGiftMap[skuIds][giftKey]};
                    gifts2Order.push(pGift)
                }
            }
            orderitem.gifts = gifts2Order;
            orderitem.subOrderItemReqArgs = [];
            var extendSbomCode = $("#extendSelect").attr("data-scode");
            var accidentSbomCode = $("#accidentSelect").attr("data-scode");
            var extendSkuCodes = [], extendItem = {}, accidentItem = {};
            if (extendSbomCode.length > 0) {
                extendSkuCodes[0] = extendSbomCode;
                if (accidentSbomCode.length > 0) {
                    extendSkuCodes[1] = accidentSbomCode
                }
            } else {
                if (accidentSbomCode.length > 0) {
                    extendSkuCodes[0] = accidentSbomCode
                }
            }
            var extendItem = {};
            var accidentItem = {};
            if (extendSbomCode.length > 0) {
                extendItem.itemId = extendSkuCodes[0];
                extendItem.qty = $("#pro-quantity").val();
                extendItem.itemType = "S1";
                extendItem.mainSkuCode = $("#pro-sku-code").val();
                orderitem.subOrderItemReqArgs.push(extendItem);
                if (accidentSbomCode.length > 0) {
                    accidentItem.itemId = extendSkuCodes[1];
                    accidentItem.qty = $("#pro-quantity").val();
                    accidentItem.itemType = "S6";
                    accidentItem.mainSkuCode = $("#pro-sku-code").val();
                    orderitem.subOrderItemReqArgs.push(accidentItem)
                }
            } else {
                if (accidentSbomCode.length > 0) {
                    accidentItem.itemId = extendSkuCodes[0];
                    accidentItem.qty = $("#pro-quantity").val();
                    accidentItem.itemType = "S6";
                    accidentItem.mainSkuCode = $("#pro-sku-code").val();
                    orderitem.subOrderItemReqArgs.push(accidentItem)
                }
            }
            orderItemReqArgList.push(orderitem);
            var jsonReqArg = ec.lang.json.stringify(orderItemReqArgList);
            input = '<input name="orderReqJson" type="text" value=\'' + jsonReqArg + "'>";
            input += '<input name="CsrfToken" id="CsrfToken" type="hidden" value="' + csrftoken + '"/>'
        }
        var form = gid("order-confirm-form");
        form.innerHTML = input;
        ec.binding.isBindedMobileOrEnterpriseUser(function () {
            setTimeout(function () {
                form.submit()
            }, 500)
        })
    })
};
ec.product.timingBuy = function () {
    var getSku = ec.product.getSkuInfo(ec.product.getSku() || ec.product.defaultSku);
    var _now = ec.product.getSysDate();
    var start = getSku.startTime;
    var startTime = new Date;
    startTime.setTime(start.parseDate("yyyy-MM-dd HH:mm:ss"));
    var startArray = [];
    startArray.push(start);
    var countdownLength = getSku.countDown;
    $("#pro-operation").css("visibility", "visible");
    $("#product-operation").show();
    if (_now - startTime >= 0) {
        var end = getSku.endTime;
        var endTime = new Date;
        if (null == end || "" == end) {
            endTime = new Date(2999, 1, 1, 0, 0, 0)
        } else {
            endTime.setTime(end.parseDate("yyyy-MM-dd HH:mm:ss"))
        }
        if (_now - endTime < 0) {
            var haveQuantity = ec.product.inventory.haveInventory(getSku.id);
            if (haveQuantity) {
                var content = '<a href="javascript:;" onclick="ec.product.addCart()" class="product-button01" ><span>加入购物车</span></a>' + '<a href="javascript:;" onclick="ec.product.orderNow()" class="product-button02" ><span>立即下单</span></a>' + '<span class="product-button-tips">限时抢购进行中</span>';
                ec.product.renderVisitorButton($("#pro-operation"));
                $("#pro-operation").html(content);
                $("#product-operation").show()
            } else {
                $("#pro-quantity-area").hide();
                $("#pro-operation").html('<a href="javascript:;" class="product-button02" onclick="ec.product.arrival()"><span>到货通知</span></a>');
                $("#product-operation").show();
                $("#product-recommend-all").hide()
            }
        } else {
            $("#pro-operation").html('<a href="javascript:;" class="product-button02 disabled">活动已结束</a>');
            $("#pro-operation").css("visibility", "visible");
            $("#product-operation").show();
            $("#product-recommend-all").hide()
        }
    } else if (!ec.util.isEmpty(getSku.gotoUrl) && (startTime - _now) / (1e3 * 3600) > countdownLength) {
        if (1 == getSku.isShowReminder) {
            $("#pro-operation").html('<a target="_blank" href="' + getSku.gotoUrl + '" class="product-button02" ><span>开售提醒</span></a>');
            $("#product-operation").show()
        } else if (0 == getSku.isShowReminder) {
            var content = '<a href="javascript:;" class="product-button01 disabled" ><span>加入购物车</span></a>' + '<a href="javascript:;"  class="product-button02 disabled" ><span>立即下单</span></a><div class="product-time"></div>';
            $("#pro-operation").html(content);
            $("#product-operation").show();
            ec.ui.countdown2($(".product-time"), {
                html: "<p>离抢购开始还有：</p><ul><li><span>{#day}</span></li><li><em>天</em></li><li><span>{#hours}</span></li><li><em>:</em></li><li><span>{#minutes}</span></li><li><em>:</em></li><li><span>{#seconds}</span></li>",
                now: _now,
                times: startArray,
                callback: function (json) {
                    var content = '<a href="javascript:;" onclick="ec.product.addCart()" class="product-button01" ><span>加入购物车</span></a>' + '<a href="javascript:;" onclick="ec.product.orderNow()" class="product-button02" ><span>立即下单</span></a>';
                    $("#pro-operation").html(content);
                    $("#product-operation").show();
                    ec.product.gift.updateOperationBtns()
                }
            })
        }
    } else {
        var content = '<a href="javascript:;" class="product-button01 disabled" ><span>加入购物车</span></a>' + '<a href="javascript:;"  class="product-button02 disabled" ><span>立即下单</span></a><div class="product-time"></div>';
        $("#pro-operation").html(content);
        $("#product-operation").show();
        ec.ui.countdown2($(".product-time"), {
            html: "<p>离抢购开始还有：</p><ul><li><span>{#day}</span></li><li><em>天</em></li><li><span>{#hours}</span></li><li><em>:</em></li><li><span>{#minutes}</span></li><li><em>:</em></li><li><span>{#seconds}</span></li>",
            now: _now,
            times: startArray,
            callback: function (json) {
                var content = '<a href="javascript:;" onclick="ec.product.addCart()" class="product-button01" ><span>加入购物车</span></a>' + '<a href="javascript:;" onclick="ec.product.orderNow()" class="product-button02" ><span>立即下单</span></a>';
                $("#pro-operation").html(content);
                $("#product-operation").show();
                ec.product.showSbomInterest(ec.product.getSkuInfo(ec.product.getSku()));
                ec.product.gift.updateOperationBtns()
            }
        })
    }
};
ec.product.arrival = function () {
    ec.account.afterLogin(function () {
        ec.product.syncCustomSession();
        var email = ec.product.email;
        var mobile = ec.product.mobile;
        var noticeType = "";
        var box = new ec.box($("#product-arrival-html").val(), {
            boxid: "product-arriva-box",
            boxclass: "ol_box_4",
            title: "到货通知",
            width: 700,
            showButton: false,
            onopen: function (box) {
                if (ec.util.isEmpty(email)) {
                    $("#arrival-email").css({cursor: "pointer"});
                    $("#arrival-email").click(function () {
                        window.open("/member/account");
                        ec.product.bind()
                    });
                    $("#arrival-email").attr("class", "disabled");
                    $("#account-email").html('未绑定安全邮箱&nbsp;<a href="javascript:;" target="_blank">去绑定</a>')
                } else {
                    $("#arrival-email").bind("click", function () {
                        noticeType = ec.product.chooseNoticeType("email")
                    });
                    $("#account-email").html(email)
                }
                if (ec.util.isEmpty(mobile)) {
                    $("#arrival-mobile").css({cursor: "pointer"});
                    $("#arrival-mobile").click(function () {
                        window.open("/member/account");
                        ec.product.bind()
                    });
                    $("#arrival-mobile").attr("class", "disabled");
                    $("#account-mobile").html('未绑定安全手机&nbsp;<a href="javascript:;" target="_blank">去绑定</a>')
                } else {
                    $("#arrival-mobile").bind("click", function () {
                        noticeType = ec.product.chooseNoticeType("mobile")
                    });
                    $("#account-mobile").html(ec.product.splitMobile(mobile))
                }
            },
            onok: function (box) {
                if (noticeType.length == 0) {
                    $("#arrival-error span").html("请选择一种通知方式！");
                    $("#arrival-error").removeClass("hide");
                    return
                }
                var type = "1";
                var informWay = email;
                if (noticeType == "mobile") {
                    type = "3";
                    informWay = mobile
                }
                ec.loadCsrfToken(function () {
                    $.ajax({
                        url: "/product/arrivalMail.json",
                        dataType: "json",
                        type: "post",
                        data: {
                            informWay: informWay,
                            type: type,
                            skuId: ec.product.getSku(),
                            skuCode: $("#pro-sku-code2").html()
                        },
                        timeout: 1e4,
                        error: function () {
                            ec.ui.loading.hide();
                            $("#arrival-error span").html("操作超时，请重试！");
                            $("#arrival-error").removeClass("hide")
                        },
                        beforeSend: function (xhr) {
                            ec.ui.loading.show();
                            xhr.withCredentials = true;
                            xhr.setRequestHeader("CsrfToken", csrftoken)
                        },
                        success: function (json) {
                            ec.ui.loading.hide();
                            if (!json.success) {
                                $("#arrival-error span").html(json.msg);
                                $("#arrival-error").removeClass("hide");
                                return
                            }
                            alert("设置成功！");
                            $("#arrival-error").addClass("hide");
                            box.close();
                            $(".ol_box_mask").remove()
                        }
                    })
                }, true)
            },
            onclose: function (box) {
                $(".ol_box_mask").remove()
            }
        });
        box.open();
        ec.product.bind = function () {
            box.close();
            $(".ol_box_mask").remove()
        }
    })
};
ec.product.chooseNoticeType = function (type) {
    $("#arrival-email").removeClass("selected");
    $("#arrival-mobile").removeClass("selected");
    $("#arrival-" + type).attr("class", "selected");
    return type
};
ec.product.attention = function () {
    var box = new ec.box($("#product-attention-html").val(), {
        boxid: "product-attention-box",
        title: "关注商品",
        width: 580,
        focus: "input[name=email]",
        showButton: false,
        onok: function (box) {
            var email = box.find("input[name=email]").val(), mobile = box.find("input[name=mobile]").val(),
                regMobile = /^0?(13|14|15|17|18)[0-9]{9}$/;
            if (!email) {
                alert("请输入email！");
                return
            }
            if (!ec.util.isEmail(email)) {
                alert("请输入正确的email！");
                return
            }
            if (!mobile) {
                alert("请输入手机号码！");
                return
            }
            if (!regMobile.test(mobile)) {
                alert("请输入正确的手机号码！");
                return
            }
            (new ec.ajax).submit({
                url: "/product/saveAttention.json",
                data: {email: email, phone: mobile, skuId: ec.product.getSku()},
                timeout: 1e4,
                timeoutFunction: function () {
                    alert("操作超时，请重试！")
                },
                beforeSendFunction: ec.ui.loading.show,
                afterSendFunction: ec.ui.loading.hide,
                successFunction: function (json) {
                    if (!json.success) {
                        ec.showError(json);
                        return
                    }
                    alert("设置成功！");
                    box.close()
                }
            })
        }
    });
    box.open();
    box.find("input[name=email]").focus()
};
ec.product.checkExtend = function () {
    var skuId = ec.product.getSku();
    val = $.trim($("#extend-text").val()), $succussMsg = $("#extend-msg-succuss"), $errorMsg = $("#extend-msg-error"), msgText = '<span class="fcn">*</span>&nbsp;', link = "";
    if (val.length > 5) {
        (new ec.ajax).get({
            url: "/tcs/query.json?_t=" + (new Date).getTime() + "&skuId=" + skuId + "&imei=" + val,
            timeout: 1e4,
            timeoutFunction: function () {
                $("#pro-extend-result-id").removeClass("hide");
                $errorMsg.html(msgText + "操作超时，请重试！").show();
                $succussMsg.hide()
            },
            beforeSendFunction: function () {
                ec.ui.loading.show({modal: false})
            },
            afterSendFunction: ec.ui.loading.hide,
            successFunction: function (json) {
                if (!json.success) {
                    if (json.otherPrdId) link = '&nbsp;&nbsp;<a href="/product/' + json.otherPrdId + ".html#" + json.otherSkuId + ',0">前去购买>></a>';
                    $("#pro-extend-result-id").removeClass("hide");
                    $errorMsg.html(msgText + json.msg + link).show();
                    $succussMsg.hide();
                    $("#button-extend").attr("class", "pro-button01 button-style-disabled-1 button-go-extend-checkout-disabled");
                    return
                }
                $("#pro-extend-result-id").removeClass("hide");
                $succussMsg.html(msgText + json.msg).show();
                $errorMsg.hide();
                $("#button-extend").attr("class", "pro-button01 button-style-1 button-go-extend-checkout")
            }
        })
    } else {
        $succussMsg.hide();
        $("#pro-extend-result-id").removeClass("hide");
        $errorMsg.html(msgText + "请输入正确的IMEI/SN/MEID信息").show();
        $("#button-extend").attr("class", "pro-button01 button-style-disabled-1 button-go-extend-checkout-disabled")
    }
    return false
};
ec.product.extendBuyNow = function () {
    $("#extend-text").val("");
    $("#extend-msg-succuss,#extend-msg-error").hide();
    $("#button-extend")[0].className = "pro-button01 button-style-disabled-1 button-go-extend-checkout-disabled";
    $("#popup-extend").show()
};
ec.product.extendBuy = function (obj) {
    var imei = $.trim($("#extend-text").val());
    if (obj.className != "pro-button01 button-style-1 button-go-extend-checkout" || !imei) return;
    ec.account.afterLogin(function () {
        var id = ec.product.getSku(), input = "", form = gid("order-confirm-extend-form");
        if (!ec.util.isArray(id)) {
            id = [id]
        }
        for (var i = 0; i < id.length; i++) {
            input += '<input name="skuIds" type="text" value="' + id[i] + '">'
        }
        input += '<input name="imei" type="text" value="' + imei + '">';
        form.innerHTML = input;
        ec.binding.isBindedMobileOrEnterpriseUser(function () {
            setTimeout(function () {
                form.submit()
            }, 500)
        })
    })
};
ec.product.jmptoRemark = function () {
    $("#pro-tab-evaluate").click();
    ec.ui.scrollTo("#pro-tab-evaluate")
};
ec.product.combClick = function (ths) {
    if ($(ths).hasClass("selected") == false) {
        $(ths).addClass("selected");
        $(ths).children("input").attr("checked", true)
    } else {
        $(ths).removeClass("selected");
        $(ths).children("input").attr("checked", false)
    }
    var thix = $(ths).children("input");
    count = parseInt($("#comb-count").html(), 10) || 0, price = parseFloat($("#comb-price").html()) || 0;
    if (thix.attr("checked") == true) {
        price += parseFloat(thix.attr("data-price"));
        count++
    } else {
        price -= parseFloat(thix.attr("data-price"));
        count--
    }
    if (!(ec.product.productType && ec.product.productType == 4 && ec.product.isDespositSku == 1)) {
        $("#comb-price").html(price.toFixed(2))
    }
    $("#comb-count").html(count)
};
(function () {
    var _index = 0, _length;
    ec.ready(function () {
        _length = $("#pro-gallerys").css("left", "0").children().length
    });
    ec.product.imgSlider = {
        prev: function () {
            if (_index == 0) return;
            _index--;
            $("#pro-gallerys").animate({left: _index * -74}, 100)
        }, next: function () {
            if (_index + 5 >= _length) return;
            _index++;
            $("#pro-gallerys").animate({left: _index * -74}, 100)
        }, reset: function () {
            _length = $("#pro-gallerys").css("left", "0").children().length;
            _index = 0
        }
    }
})();
(function (_ep) {
    var _bundleId, _renderComb = function (skuId) {
        var comb = $("#comb-pro-" + skuId);
        var sku = _ep.getSkuInfo(skuId), price = parseFloat(sku.price);
        comb.find("input[name=skuId]:checked").each(function () {
            price += parseFloat(this.getAttribute("data-price"))
        });
        if (!(ec.product.productType && ec.product.productType == 4 && ec.product.isDespositSku == 1)) {
            $("#comb-price").html(price.toFixed(2))
        }
    };
    _ep.renderGroup = function (skuId) {
        var _showId = [], bundle = $("#bundle-list-" + skuId), comb = $("#comb-list-" + skuId);
        if (bundle.length > 0) {
            _showId.push("#tab-bundle");
            bundle.show().siblings().hide();
            _ep.renderBundle(skuId)
        }
        if (!comb.length > 0) {
            $("#product-recommend-all").hide()
        } else {
            if (parseInt(ec.product.getSkuInfo(ec.product.getSku() || ec.product.defaultSku).buttonMode) > 13 || parseInt(ec.product.getSkuInfo(ec.product.getSku() || ec.product.defaultSku).buttonMode) == 0 || ec.product.productType == 4) {
                $("#product-recommend-all").hide()
            } else {
                $("#product-recommend-all").show()
            }
        }
        $("#tab-bundle,#tab-comb").hide();
        if (_showId.length == 0) {
            $("#group-area").hide();
            return
        }
        if (_showId.length > 1) {
            _showId.push("#tab-split")
        }
        _showId.push("#group-area");
        $(_showId.join(",")).show()
    };
    _ep.renderBundle = function (skuId) {
        var bundleList = $("#bundle-list-" + skuId);
        this.showBundle(bundleList.children("li.current").attr("data-id"))
    };
    _ep.showBundle = function (bundleId) {
        $("#bundle-pro-" + bundleId + ",#bundle-price-" + bundleId).show().siblings().hide();
        _bundleId = bundleId;
        var bundle = $("#bundle-pro-" + bundleId)
    }
})(ec.product);
(function () {
    var _type;
    _options = {};
    _options["default"] = {};
    _options["normal"] = {
        renderInventory: function (haveQuantity) {
            var getSku = ec.product.getSkuInfo(ec.product.getSku() || ec.product.defaultSku), $proMsg = $("#pro-msg"),
                $buyBtns = $("#pro-quantity-area,#pro-operation"), $buyBtnMod = $("#pro-operation"),
                isPriority = $("#isPriority").val();
            $("#tab-addcart-button").hide();
            $("#tab-notice-button").hide();
            $("#product-tips").html("");
            $("#product-tips").hide();
            if (ec.product.status == 3) {
                $proMsg.show();
                $("#pro-msg-title").html("温馨提示：该商品已下架");
                $buyBtnMod.css("visibility", "hidden");
                $("#pro-skus").html("");
                $("#pro-skus").hide();
                $(".product-operation-main").hide();
                $("#package_dl").remove();
                return
            }
            if (ec.product.status == 5) {
                $proMsg.show();
                $("#pro-msg-title").html("温馨提示：该商品不在此销售前端销售");
                $buyBtnMod.css("visibility", "hidden");
                $("#product-tips").html("温馨提示：该商品不在此销售前端销售");
                $("#product-tips").show();
                $("#product-operation").hide();
                return
            }
            if (getSku.tipsContent.length > 1) {
                $proMsg.show();
                $("#pro-msg-title").html("温馨提示：" + getSku.tipsContent);
                $("#product-tips").html("温馨提示：" + getSku.tipsContent);
                $("#product-tips").show()
            } else {
                $proMsg.hide();
                $("#product-tips").hide()
            }
            if (getSku.priceMode == 2) {
                $("#pro-price-label").html("暂无报价");
                $("#pro-price-label").show();
                $("#pro-price").hide();
                $("#pro-price-old").hide();
                $("#pro-price").html("");
                $("#pro-price-old").hide()
            }
            if (isPriority == 1) {
                if (ec.product.getSkuPriority(getSku.id) == true) {
                    $buyBtnMod.html('<a href="javascript:;" class="product-button02" onclick="ec.product.buy(\'sku\');return false;"><span>立即购买</span></a>');
                    $("#pro-quantity-area").hide();
                    $buyBtnMod.css("visibility", "visible");
                    $("#product-operation").show();
                    $("#order-confirm-form").attr({action: "/order/priorityConfirm", method: "post"});
                    return
                }
            }
            $("#order-confirm-form").attr({action: "/order/nowConfirmcart", method: "post"});
            $("#product-deposit-agreement-area").next().remove();
            switch (parseInt(getSku.buttonMode, 10)) {
                case 5:
                    $buyBtnMod.css("visibility", "hidden");
                    $("#pro-quantity-area").hide();
                    return;
                case 4:
                    $buyBtnMod.css("visibility", "hidden");
                    $("#pro-quantity-area").hide();
                    return;
                case 2:
                    $buyBtnMod.html('<a href="javascript:;" class="product-button02" onclick="ec.product.buy(\'sku\');return false;"><span>立即购买</span></a>');
                    $("#pro-quantity-area").show();
                    $buyBtnMod.css("visibility", "visible");
                    $("#product-operation").show();
                    return;
                case 6:
                    if (haveQuantity) {
                        $buyBtnMod.html('<a href="javascript:;" class="product-button02" onclick="ec.product.extendBuyNow();return false;"><span>立即购买</span></a>');
                        $("#pro-quantity-area").show();
                        $buyBtnMod.css("visibility", "visible");
                        $("#product-operation").show()
                    } else {
                        $("#pro-quantity-area").hide();
                        $buyBtnMod.css("visibility", "visible");
                        $("#product-operation").show();
                        $buyBtnMod.html('<a href="javascript:;" class="product-button02" onclick="ec.product.arrival()"><span>到货通知</span></a>');
                        $("#tab-notice-button").show()
                    }
                    return;
                case 7:
                    if (ec.product.isEasyBuy()) {
                        $("#pro-quantity-area").hide();
                        $("#pro-quantity-area-nochange").show();
                        $buyBtnMod.html('<a onclick="ec.product.orderEasyBuy()" class="product-button-priority" ><span>' + getSku.easyBuyName + "</span></a>" + '<a target="_blank" href="' + getSku.gotoUrl + '" class="product-button02" ><span>' + getSku.buttonText + "</span></a>")
                    } else {
                        $buyBtnMod.html('<a target="_blank" href="' + getSku.gotoUrl + '" class="product-button02" ><span>' + getSku.buttonText + "</span></a>")
                    }
                    $buyBtnMod.css("visibility", "visible");
                    $("#product-operation").show();
                    return;
                case 8:
                    return;
                case 9:
                    if (ec.product.isEasyBuy()) {
                        $("#pro-quantity-area").hide();
                        $("#pro-quantity-area-nochange").show();
                        $buyBtnMod.html('<a onclick="ec.product.orderEasyBuy()" class="product-button-priority" ><span>' + getSku.easyBuyName + "</span></a>" + '<a target="_blank" href="' + getSku.gotoUrl + '" class="product-button02" ><span>开售提醒</span></a>')
                    } else {
                        $buyBtnMod.html('<a target="_blank" href="' + getSku.gotoUrl + '" class="product-button02" ><span>开售提醒</span></a>')
                    }
                    $buyBtnMod.css("visibility", "visible");
                    $("#product-operation").show();
                    return;
                case 10:
                    ec.product.timingBuy();
                    return;
                case 11:
                    if (haveQuantity) {
                        $("#pro-quantity-area").show();
                        $buyBtnMod.css("visibility", "visible");
                        $("#product-operation").show();
                        var html = '<a href="javascript:;" onclick="ec.product.orderNowCover()" class="product-button02" ><span>立即下单</span></a>';
                        $buyBtnMod.html(html)
                    } else {
                        $("#pro-quantity-area").hide();
                        $buyBtnMod.css("visibility", "visible");
                        $("#product-operation").show();
                        $buyBtnMod.html('<a href="javascript:;" class="product-button02" onclick="ec.product.arrival()"><span>到货通知</span></a>');
                        $("#tab-notice-button").show()
                    }
                    return;
                case 12:
                    if (ec.product.productType == 9) {
                        if (haveQuantity) {
                            $("#pro-quantity-area").show();
                            $buyBtnMod.css("visibility", "visible");
                            $buyBtnMod.html('<a href="javascript:;" class="product-button02" onclick="ec.product.orderNow()"><span>立即下单</span></a>');
                            $("#product-operation").show()
                        } else {
                            $("#pro-quantity-area").hide();
                            $buyBtnMod.css("visibility", "visible");
                            $("#product-operation").show();
                            $buyBtnMod.html('<a href="javascript:;" class="product-button02" onclick="ec.product.arrival()"><span>到货通知</span></a>');
                            $("#tab-notice-button").show()
                        }
                        return
                    }
                    $buyBtnMod.css("visibility", "hidden");
                    $("#pro-quantity-area").hide();
                    return;
                case 18:
                    if (ec.product.productType == 9) {
                        if (haveQuantity) {
                            $("#pro-quantity-area").show();
                            $buyBtnMod.css("visibility", "visible");
                            $buyBtnMod.html('<a href="javascript:;" class="product-button02" onclick="ec.product.orderNow()"><span>立即下单</span></a>');
                            $("#product-operation").show()
                        } else {
                            $("#pro-quantity-area").hide();
                            $buyBtnMod.css("visibility", "visible");
                            $("#product-operation").show();
                            $buyBtnMod.html('<a href="javascript:;" class="product-button02" onclick="ec.product.arrival()"><span>到货通知</span></a>');
                            $("#tab-notice-button").show()
                        }
                        return
                    }
                    $buyBtnMod.css("visibility", "hidden");
                    $("#pro-quantity-area").hide();
                    return;
                case 15:
                    $buyBtnMod.css("visibility", "hidden");
                    $("#pro-quantity-area").hide();
                    $("#product-operation").hide();
                    if (getSku.tipsContent.length > 1) {
                        $("#pro-msg-title").html("温馨提示：" + getSku.tipsContent)
                    } else {
                        $("#product-tips").html("温馨提示：该商品暂不售卖")
                    }
                    $("#product-tips").show();
                    return;
                case 3:
                case 1:
                    if (haveQuantity) {
                        $("#pro-quantity-area").show();
                        $buyBtnMod.css("visibility", "visible");
                        $("#product-operation").show();
                        if (getSku.groupType == "1") {
                            $buyBtnMod.html('<a href="javascript:;" onclick="ec.product.addCart()" class="product-button02" ><span>立即团购</span></a>')
                        } else {
                            var html = '<a href="javascript:;" onclick="ec.product.addCart()" class="product-button01" ><span>加入购物车</span></a>' + '<a href="javascript:;" onclick="ec.product.orderNow()" class="product-button02" ><span>立即下单</span></a>';
                            ec.product.renderVisitorButton($buyBtnMod);
                            $buyBtnMod.html(html);
                            $("#tab-addcart-button").show()
                        }
                    } else {
                        $("#pro-quantity-area").hide();
                        $buyBtnMod.css("visibility", "visible");
                        $("#product-operation").show();
                        if (ec.product.isEasyBuy()) {
                            $("#pro-quantity-area").hide();
                            $("#pro-quantity-area-nochange").show();
                            $buyBtnMod.html('<a onclick="ec.product.orderEasyBuy()" class="product-button-priority" ><span>' + getSku.easyBuyName + "</span></a>" + '<a href="javascript:;" class="product-button02" onclick="ec.product.arrival()"><span>到货通知</span></a>')
                        } else {
                            $buyBtnMod.html('<a href="javascript:;" class="product-button02" onclick="ec.product.arrival()"><span>到货通知</span></a>');
                            $("#tab-notice-button").show();
                            $("#product-recommend-all").hide()
                        }
                    }
                    return;
                case 19:
                    $buyBtnMod.css("visibility", "hidden");
                    $("#pro-quantity-area").hide();
                    $("#product-operation").hide();
                    if (getSku.tipsContent.length > 1) {
                        $("#pro-msg-title").html("温馨提示：" + getSku.tipsContent)
                    } else {
                        $("#product-tips").html("温馨提示：该商品暂不售卖")
                    }
                    $("#product-tips").show();
                    return;
                default:
                    $buyBtnMod.css("visibility", "hidden");
                    $("#pro-quantity-area").hide();
                    $("#product-tips").html("温馨提示：该商品暂未售卖");
                    $("#product-tips").show();
                    $("#product-operation").hide()
            }
        }
    };
    _options["reservation"] = {
        renderInventory: function (haveQuantity) {
            $("#pro-msg").hide();
            if (haveQuantity) {
                $("#pro-quantity-area").show();
                $("#pro-operation").html('<a href="javascript:;"  onclick="ec.product.addCartWithLogin()" class="product-button02" ><span>预约购买</span></a>');
                $("#product-operation").show()
            } else {
                $("#pro-quantity-area").hide();
                $("#pro-operation").html('<a href="javascript:;" class="product-button02" onclick="ec.product.arrival()"><span>到货通知</span></a>');
                $("#product-operation").show()
            }
        }
    };
    _options["queue"] = {
        renderInventory: function (haveQuantity) {
            if (haveQuantity) {
                $("#sale-buy-btn").show();
                $("#sale-sell-out").hide()
            } else {
                $("#sale-buy-btn").hide();
                $("#sale-sell-out").show()
            }
        }
    };
    _options["seckill"] = {
        renderInventory: function (haveQuantity) {
            if (haveQuantity) {
                $("#sale-buy-btn").show();
                $("#sale-sell-out").hide()
            } else {
                $("#sale-buy-btn").hide();
                $("#sale-sell-out").show()
            }
        }
    };
    ec.product.execute = function (command, args) {
        var opt = _options[_type], fun = opt[command] || _options["default"][command];
        if (fun) fun.apply(ec.product, args)
    };
    ec.product.setType = function (type) {
        _type = type;
        switch (type) {
            case"normal":
            case"reservation":
                ec.product.isSale = false;
                break;
            default:
                ec.product.isSale = true
        }
        ec.product.prefix = ec.product.isSale ? "/sale" : "/product"
    }
})();
ec.ready(function () {
    $(function () {
        var fix = $(".product-gallery");
        var end = $(".gallery-scroll-bottom");
        var fixTop = fix.offset().top, fixHeight = fix.height();
        var endTop, miss;
        $(window).scroll(function () {
            var docTop = Math.max(document.body.scrollTop, document.documentElement.scrollTop);
            if (end.length > 0) {
                endTop = $(".header").height() + $(".hr-10").height() * 4 + $(".g").height() + $(".product").height();
                miss = endTop - docTop - fixHeight
            }
            if (fixTop < docTop) {
                fix.addClass("positionFixed");
                fix.removeClass("positionStatic");
                if (end.length > 0 && endTop < docTop + fixHeight) {
                    fix.css({top: miss})
                } else {
                    fix.css({top: 0})
                }
            } else {
                fix.addClass("positionStatic");
                fix.removeClass("positionFixed")
            }
        })
    });
    var product = ec.product;
    ec.ui.proNumer("#pro-quantity", {max: 999, min: 1});
    ec.product.tabSkuInfo(ec.product.setSkuId || ec.product.defaultSku);
    var loadParameter = false;
    var _loadEvaluateSorce = function () {
        if (loadEvaluate) return;
        ec.product.remark.loadEvaluateScore();
        $("#pro-tab-evaluate-content").show();
        ec.product.remark.loadEvaluate({pageNumber: 1, type: 0, extraType: 1});
        ec.product.remark.bindEvent()
    };
    _loadEvaluateSorce();
    var product = ec.product;
    _bindEvent();
    $("#pro-tab-feature , #pro-tab-parameter , #pro-tab-package-service , #pro-tab-evaluate").click(function () {
        var thix = $(this), id = this.id
    });
    ec.product.history.add(ec.product.id);
    $(window).scroll(function () {
        var hisScroll = $(this).scrollTop(), winHeight = $(window).height(),
            scrollTop = $("#product-history-area").offset().top;
        if (finished && hisScroll >= scrollTop - winHeight) {
            finished = false;
            product.history.load(function (list) {
                if (list.length == 0) {
                    $("#product-history-area").hide();
                    return
                }
                var html = [], p;
                for (var i = 0; i < list.length; i++) {
                    p = list[i];
                    p.price = p.priceMode == 2 ? '<em  class="disabled">暂无报价</em>' : "<em>&yen;" + p.price + "</em>";
                    html.push('<li class="swiper-slide">');
                    html.push('<a href="/product/' + p.id + '.html"  title="' + p.name + '"  onclick="pushProHistoryMsg(\'' + p.code + "','" + (i + 1) + '\')" target="_blank">');
                    html.push('<img src="' + ec.mediaPath + p.photoPath + "142_142_" + p.photoName + '" alt="' + p.name + '"/>');
                    html.push('<div class="product-link-detail">');
                    html.push("<p><span>" + p.name + "</span></p>");
                    html.push("" + p.price + "");
                    html.push("</div>");
                    html.push("</a>");
                    html.push("</li>")
                }
                $("#product-history-list").html("");
                $("#product-history-list").html(html.join(" "));
                $("#product-history-area").show();
                ec.product.scroll("product-history-scroll", 5)
            }, null, ec.product.isSale ? null : ec.product.id)
        }
    });
    product.renderGroup(product.setSkuId || product.defaultSku);
    var comb_timer;
    product.renderBundle(product.setSkuId || product.defaultSku);
    var sku = ec.product.getSku();
    sku = ec.product.getSkuInfo(sku);
    ec.form.input.label("#extend-text", "输入IMEI/SN/MEID信息");
    $(".product-button02").live("click", function () {
        var buttonName = "";
        var skucode = $("#pro-sku-code").val();
        if (this.id != null && this.id != "" && typeof this.id != "undefined") {
            return
        }
        buttonName = $(this).find("span").html();
        if (buttonName == "" || buttonName == null) {
            buttonName = $(this).html()
        }
        var giftlink = $("#gift-service-detail-link").attr("href");
        var isGift = false;
        if (giftlink != "" && giftlink != null && giftlink.indexOf("javascript:;") < 0) {
            isGift = true
        }
        var packageCode = $("#packageCode").val();
        var packageSKUCode = $("#packageListCode").val();
        pushBottonMsg(buttonName, null, skucode, packageCode, packageSKUCode, "300020501", isGift)
    });
    $(".product-button01").live("click", function () {
        var buttonName = "";
        var skucode = $("#pro-sku-code").val();
        var num = $("#pro-quantity").val();
        buttonName = $(this).find("span").html();
        var packageCode = $("#packageCode").val();
        var packageSKUCode = $("#packageListCode").val();
        pushBottonMsg(buttonName, num, skucode, packageCode, packageSKUCode, "300020401")
    });
    $("#extendProtected").parent().parent().mouseover(function () {
        var a = $("#extendProtected").parent().parent().data("flag");
        if (a == 1) {
            $("#extendProtected").parent().parent().data("flag", "")
        } else {
            $("#extendProtected").parent().parent().addClass("hover")
        }
    });
    $("#extendProtected").parent().parent().mouseout(function () {
        $("#extendProtected").parent().parent().data("flag", "");
        $("#extendProtected").parent().parent().removeClass("hover")
    });
    $("#accidentProtected").parent().parent().mouseover(function () {
        var a = $("#accidentProtected").parent().parent().data("flag");
        if (a == 1) {
            $("#accidentProtected").parent().parent().data("flag", "")
        } else {
            $("#accidentProtected").parent().parent().addClass("hover")
        }
    });
    $("#accidentProtected").parent().parent().mouseout(function () {
        $("#accidentProtected").parent().parent().data("flag", "");
        $("#accidentProtected").parent().parent().removeClass("hover")
    })
});
ec.product.divchange = function (data) {
    if (data == 1) {
        $("#prddetail_counsel_all").show();
        $("#prddetail_counsel_prd").hide();
        $("#prddetail_counsel_pay").hide();
        $("#prddetail_counsel_trans").hide();
        $("#prddetail_counsel_service").hide();
        $("#prddetail_counsel_ques").hide();
        $("#prd_detail_counsel_2").removeAttr("class");
        $("#prd_detail_counsel_3").removeAttr("class");
        $("#prd_detail_counsel_4").removeAttr("class");
        $("#prd_detail_counsel_5").removeAttr("class");
        $("#prd_detail_counsel_6").removeAttr("class");
        $("#prd_detail_counsel_1").attr("class", "selected")
    } else if (data == 2) {
        $("#prddetail_counsel_all").hide();
        $("#prddetail_counsel_prd").show();
        $("#prddetail_counsel_pay").hide();
        $("#prddetail_counsel_trans").hide();
        $("#prddetail_counsel_service").hide();
        $("#prddetail_counsel_ques").hide();
        $("#prd_detail_counsel_1").removeAttr("class");
        $("#prd_detail_counsel_3").removeAttr("class");
        $("#prd_detail_counsel_4").removeAttr("class");
        $("#prd_detail_counsel_5").removeAttr("class");
        $("#prd_detail_counsel_6").removeAttr("class");
        $("#prd_detail_counsel_2").attr("class", "selected");
        ec.product.counselloadprd({pageNumber: 1})
    } else if (data == 3) {
        $("#prddetail_counsel_all").hide();
        $("#prddetail_counsel_prd").hide();
        $("#prddetail_counsel_pay").show();
        $("#prddetail_counsel_trans").hide();
        $("#prddetail_counsel_service").hide();
        $("#prddetail_counsel_ques").hide();
        $("#prd_detail_counsel_1").removeAttr("class");
        $("#prd_detail_counsel_2").removeAttr("class");
        $("#prd_detail_counsel_4").removeAttr("class");
        $("#prd_detail_counsel_5").removeAttr("class");
        $("#prd_detail_counsel_6").removeAttr("class");
        $("#prd_detail_counsel_3").attr("class", "selected");
        ec.product.paycounselload({pageNumber: 1})
    } else if (data == 4) {
        $("#prddetail_counsel_all").hide();
        $("#prddetail_counsel_prd").hide();
        $("#prddetail_counsel_pay").hide();
        $("#prddetail_counsel_trans").show();
        $("#prddetail_counsel_service").hide();
        $("#prddetail_counsel_ques").hide();
        $("#prd_detail_counsel_2").removeAttr("class");
        $("#prd_detail_counsel_3").removeAttr("class");
        $("#prd_detail_counsel_1").removeAttr("class");
        $("#prd_detail_counsel_5").removeAttr("class");
        $("#prd_detail_counsel_6").removeAttr("class");
        $("#prd_detail_counsel_4").attr("class", "selected");
        ec.product.transcounselload({pageNumber: 1})
    } else if (data == 5) {
        $("#prddetail_counsel_all").hide();
        $("#prddetail_counsel_prd").hide();
        $("#prddetail_counsel_pay").hide();
        $("#prddetail_counsel_trans").hide();
        $("#prddetail_counsel_service").show();
        $("#prddetail_counsel_ques").hide();
        $("#prd_detail_counsel_1").removeAttr("class");
        $("#prd_detail_counsel_3").removeAttr("class");
        $("#prd_detail_counsel_4").removeAttr("class");
        $("#prd_detail_counsel_2").removeAttr("class");
        $("#prd_detail_counsel_6").removeAttr("class");
        $("#prd_detail_counsel_5").attr("class", "selected");
        ec.product.sercounselload({pageNumber: 1})
    } else {
        $("#prddetail_counsel_all").hide();
        $("#prddetail_counsel_prd").hide();
        $("#prddetail_counsel_pay").hide();
        $("#prddetail_counsel_trans").hide();
        $("#prddetail_counsel_service").hide();
        $("#prddetail_counsel_ques").show();
        $("#prd_detail_counsel_1").removeAttr("class");
        $("#prd_detail_counsel_3").removeAttr("class");
        $("#prd_detail_counsel_4").removeAttr("class");
        $("#prd_detail_counsel_5").removeAttr("class");
        $("#prd_detail_counsel_2").removeAttr("class");
        $("#prd_detail_counsel_6").attr("class", "selected")
    }
};
ec.product.counselloadall = function (page) {
    (new ec.ajax).submit({
        url: "/product/query/consultation/" + ec.product.id + ".json",
        data: {prdId: ec.product.id, dataType: 0, pageNumber: page.pageNumber, pageSize: 3},
        timeout: 1e4,
        timeoutFunction: function () {
            alert("读取超时，请重试！")
        },
        successFunction: function (json) {
            if (!json.success) {
                ec.showError(json);
                return
            }
            var html = [];
            html = ec.product.createcounselhtml(json);
            $("#all_prd_counsel_content").html(html.join(""));
            ec.product.allrenderPage(json.page)
        }
    })
};
ec.product.allrenderPage = function (page) {
    $("#all_prd_counsel").show();
    $("#all_prd_counsel").pager({
        pageNumber: page.pageNumber,
        pageCount: page.totalPage,
        pageSize: 3,
        text: {first: "|&lt;", pre: "&lt", next: "&gt;", last: "&gt;|"},
        item: ["first", "pre", "qpage", "next", "last", "quickPager"],
        callBack: ec.product.counselloadall
    });
    ec.product.pagerScroll("all_prd_counsel")
};
ec.product.counselloadprd = function (page) {
    (new ec.ajax).submit({
        url: "/product/query/consultation/" + ec.product.id + ".json",
        data: {prdId: ec.product.id, dataType: 1, pageNumber: page.pageNumber, pageSize: 3},
        timeout: 1e4,
        timeoutFunction: function () {
            alert("读取超时，请重试！")
        },
        successFunction: function (json) {
            if (!json.success) {
                ec.showError(json);
                return
            }
            var html = [];
            html = ec.product.createcounselhtml(json);
            $("#prd_prd_counsel_content").html(html.join(""));
            if (json.page.totalRow > 0) {
                $("#prddetail_counsel_prd_total > div:first-child").html("共" + json.page.totalRow + "条")
            } else {
                $("#prddetail_counsel_prd_total").hide()
            }
            ec.product.prdrenderPage(json.page)
        }
    })
};
ec.product.prdrenderPage = function (page) {
    $("#prd_prd_counsel").show();
    $("#prd_prd_counsel").pager({
        pageNumber: page.pageNumber,
        pageCount: page.totalPage,
        pageSize: 3,
        text: {first: "|&lt;", pre: "&lt", next: "&gt;", last: "&gt;|"},
        item: ["first", "pre", "qpage", "next", "last", "quickPager"],
        callBack: ec.product.counselloadprd
    });
    ec.product.pagerScroll("prd_prd_counsel")
};
ec.product.paycounselload = function (page) {
    (new ec.ajax).submit({
        url: "/product/query/consultation/" + ec.product.id + ".json",
        data: {prdId: ec.product.id, dataType: 2, pageNumber: page.pageNumber, pageSize: 3},
        timeout: 1e4,
        timeoutFunction: function () {
            alert("读取超时，请重试！")
        },
        successFunction: function (json) {
            if (!json.success) {
                ec.showError(json);
                return
            }
            var html = [];
            html = ec.product.createcounselhtml(json);
            $("#pay_prd_counsel_content").html(html.join(""));
            if (json.page.totalRow > 0) {
                $("#prddetail_counsel_pay_total > div:first-child").html("共" + json.page.totalRow + "条")
            } else {
                $("#prddetail_counsel_pay_total").hide()
            }
            ec.product.payrenderPage(json.page)
        }
    })
};
ec.product.payrenderPage = function (page) {
    $("#pay_prd_counsel_page").show();
    $("#pay_prd_counsel_page").pager({
        pageNumber: page.pageNumber,
        pageCount: page.totalPage,
        pageSize: 3,
        text: {first: "|&lt;", pre: "&lt", next: "&gt;", last: "&gt;|"},
        item: ["first", "pre", "qpage", "next", "last", "quickPager"],
        callBack: ec.product.paycounselload
    });
    ec.product.pagerScroll("pay_prd_counsel_page")
};
ec.product.transcounselload = function (page) {
    (new ec.ajax).submit({
        url: "/product/query/consultation/" + ec.product.id + ".json",
        data: {prdId: ec.product.id, dataType: 3, pageNumber: page.pageNumber, pageSize: 3},
        timeout: 1e4,
        timeoutFunction: function () {
            alert("读取超时，请重试！")
        },
        successFunction: function (json) {
            if (!json.success) {
                ec.showError(json);
                return
            }
            var html = [];
            html = ec.product.createcounselhtml(json);
            $("#trans_prd_counsel_content").html(html.join(""));
            if (json.page.totalRow > 0) {
                $("#prddetail_counsel_trans_total > div:first-child").html("共" + json.page.totalRow + "条")
            } else {
                $("#prddetail_counsel_trans_total").hide()
            }
            ec.product.transrenderPage(json.page)
        }
    })
};
ec.product.transrenderPage = function (page) {
    $("#trans_prd_counsel_page").show();
    $("#trans_prd_counsel_page").pager({
        pageNumber: page.pageNumber,
        pageCount: page.totalPage,
        pageSize: 3,
        text: {first: "|&lt;", pre: "&lt", next: "&gt;", last: "&gt;|"},
        item: ["first", "pre", "qpage", "next", "last", "quickPager"],
        callBack: ec.product.transcounselload
    });
    ec.product.pagerScroll("trans_prd_counsel_page")
};
ec.product.sercounselload = function (page) {
    (new ec.ajax).submit({
        url: "/product/query/consultation/" + ec.product.id + ".json",
        data: {prdId: ec.product.id, dataType: 4, pageNumber: page.pageNumber, pageSize: 3},
        timeout: 1e4,
        timeoutFunction: function () {
            alert("读取超时，请重试！")
        },
        successFunction: function (json) {
            if (!json.success) {
                ec.showError(json);
                return
            }
            var html = [];
            html = ec.product.createcounselhtml(json);
            $("#ser_prd_counsel_content").html(html.join(""));
            if (json.page.totalRow > 0) {
                $("#prddetail_counsel_serv_total > div:first-child").html("共" + json.page.totalRow + "条")
            } else {
                $("#prddetail_counsel_serv_total").hide()
            }
            ec.product.serrenderPage(json.page)
        }
    })
};
ec.product.serrenderPage = function (page) {
    $("#ser_prd_counsel_page").show();
    $("#ser_prd_counsel_page").pager({
        pageNumber: page.pageNumber,
        pageCount: page.totalPage,
        pageSize: 3,
        text: {first: "|&lt;", pre: "&lt", next: "&gt;", last: "&gt;|"},
        item: ["first", "pre", "qpage", "next", "last", "quickPager"],
        callBack: ec.product.sercounselload
    });
    ec.product.pagerScroll("ser_prd_counsel_page")
};
ec.product.quescounselload = function (page) {
    (new ec.ajax).submit({
        url: "/product/query/frequentyQuestions/" + ec.product.id + ".json",
        data: {prdId: ec.product.id, pageNumber: page.pageNumber, pageSize: 10},
        timeout: 1e4,
        timeoutFunction: function () {
            alert("读取超时，请重试！")
        },
        successFunction: function (json) {
            if (!json.success) {
                ec.showError(json);
                return
            }
            var html = [];
            if (json.page.totalRow > 0) {
                for (var i = 0; i < json.prdFrequentyQuestionsList.length; i++) {
                    var p = json.prdFrequentyQuestionsList[i];
                    html.push("<li>");
                    html.push("<h2>" + ((page.pageNumber - 1) * 10 + i + 1) + "、" + p.question + "</h2>");
                    html.push("<p>" + p.reply + "</p>");
                    html.push("</li>")
                }
            } else {
                html.push('<div class="product-inquire-list"><div class="product-inquire-no">暂无相关内容</div></div>')
            }
            $("#ques_prd_counsel_content").html(html.join(""));
            if (json.page.totalRow > 0) {
                $("#prddetail_counsel_ques_total div:first-child").html("共" + json.page.totalRow + "条")
            } else {
                $("#prddetail_counsel_ques_total").hide()
            }
            ec.product.quesrenderPage(json.page)
        }
    })
};
ec.product.quesrenderPage = function (page) {
    $("#ques_prd_counsel_page").show();
    $("#ques_prd_counsel_page").pager({
        pageNumber: page.pageNumber,
        pageCount: page.totalPage,
        pageSize: 10,
        text: {first: "|&lt;", pre: "&lt", next: "&gt;", last: "&gt;|"},
        item: ["first", "pre", "qpage", "next", "last", "quickPager"],
        callBack: ec.product.quescounselload
    });
    ec.product.pagerScroll("ques_prd_counsel_page")
};
ec.product.createcounselhtml = function (json) {
    var html = [];
    if (json.page.totalRow > 0) {
        html.push('<ul class="product-inquire-list">');
        for (var i = 0; i < json.prdConsultationList.length; i++) {
            p = json.prdConsultationList[i];
            var username = p.userName;
            var gradecode = p.gradeCode;
            var date = new Date(p.createTime);
            var answerdate = new Date(p.answerTime);
            html.push('<li> <div class="product-inquire-user">网友');
            html.push("<span>" + ec.encodeForHTML(username) + "</span>");
            html.push("<em>" + date.format("yyyy-MM-dd HH:mm:ss") + "</em></div>");
            html.push('<div class="product-inquire-question">');
            html.push("<label>咨询内容：</label><span>" + ec.util.escapeHtml(p.question) + "</span></div>");
            html.push('<div class="product-inquire-answer">');
            html.push("<p><label>回复：</label>" + ec.util.escapeHtml(p.answer) + "</p>");
            html.push("<em>" + answerdate.format("yyyy-MM-dd HH:mm:ss") + "</em>");
            html.push("</div></li>")
        }
        html.push("</ul>")
    } else {
        html.push('<div class="product-inquire-list"><div class="product-inquire-no">暂无相关内容</div></div>')
    }
    return html
};
ec.product.loginCheckBefCoun = function () {
    ec.account.afterLogin(function () {
        $("#counseltextid").focus();
        $("#error-span").hide()
    })
};
ec.product.submitCounsel = function () {
    var temptext = $("<div/>").text($("#counseltextid").val()).html();
    var typeValue = $('input[name="type"]').val();
    var text = ec.product.optCompany(temptext);
    if (text == null || text.length < 1) {
        $("#error-span").show();
        $("#error-span").html("提交内容为空");
        return
    } else {
        var reg = new RegExp(addressFrontRegex);
        var textCopy = text.split("").filter(function (r) {
            return reg.test(r)
        }).join("");
        if (textCopy != text) {
            $("#error-span").show();
            $("#error-span").html("您提交的内容含有非法字符");
            return
        }
    }
    if (text.length > 100) {
        $("#error-span").show();
        $("#error-span").html("输入的文字长度不能超过100个字,请重新输入");
        return
    }
    (new ec.ajax).get({
        url: domainMain + "/member/addUserRemarkView.json?t=" + (new Date).getTime(),
        dataType: "json",
        data: {orderCode: "comments"},
        timeout: 1e4,
        timeoutFunction: function () {
            alert("读取超时，请重试！");
            return false
        },
        successFunction: function (json) {
            if (!json.success) {
                ec.account.syncCustomSession()
            }
            ec.loadCsrfToken(function () {
                $.ajax({
                    url: "/product/save/consultation.json",
                    type: "POST",
                    dataType: "json",
                    data: {productId: ec.product.id, productName: ec.product.name, question: temptext, type: typeValue},
                    beforeSend: function (xhr) {
                        xhr.withCredentials = true;
                        xhr.setRequestHeader("CsrfToken", csrftoken)
                    },
                    success: function (json) {
                        if (!json.success) {
                            if (json.msg == "notRealName") {
                                ec.product.commentsTip()
                            } else {
                                $("#error-span").show();
                                $("#error-span").html(json.msg)
                            }
                        } else {
                            if ($("#safeEmail").attr("checked")) {
                                ec.product.counselSuccess(json.changeEmailUrl)
                            } else {
                                alert("提交成功,我们将尽快为您解答")
                            }
                            $("#counsel_content_form")[0].reset();
                            $("#error-span").hide();
                            return
                        }
                    }
                })
            })
        }
    })
};
ec.product.commentsTip = function () {
    new ec.box($("#realNameComment").val(), {
        boxclass: "ol_box_4",
        title: "",
        width: 540,
        showButton: false,
        autoHeight: false,
        onok: function () {
        }
    }).open()
};
ec.product.optCompany = function (str) {
    return str.replace(/(^\s*)|(\s*$)/g, "")
};
ec.product.counselSuccess = function (url) {
    ec.account.afterLogin(function () {
        ec.product.syncCustomSession();
        var email = ec.product.email;
        var box = new ec.box($("#product-counsel-html").val(), {
            boxid: "product-counsel-box",
            boxclass: "ol_box_4",
            showButton: false,
            onopen: function (box) {
                if (ec.util.isEmpty(email)) {
                    $("#counsel-success-msg").html("回复将发送到您的安全邮箱，您还未绑定，请先绑定安全邮箱。");
                    $("#counsel-bind-email").html('<a href="' + url + '" class="box-change box-pro-button01 button-style-2" target="_blank" onclick="ec.product.secEmailOper()"><span>去绑定</span></a>')
                } else {
                    $("#counsel-success-msg").html("客服回复将发送到您的安全邮箱&nbsp;" + email + "，可点击修改安全邮箱。");
                    $("#counsel-bind-email").html('<a href="' + url + '" class="box-change box-pro-button01 button-style-2" target="_blank" onclick="ec.product.secEmailOper()"><span>修改安全邮箱</span></a>')
                }
            },
            onok: function (box) {
            },
            onclose: function (box) {
                $(".ol_box_mask").remove()
            }
        });
        box.open();
        ec.product.secEmailOper = function () {
            box.close();
            $(".ol_box_mask").remove()
        }
    })
};
ec.product.combChange = function (data) {
    var currentLi = $(data).parent();
    currentLi.addClass("current");
    currentLi.siblings().not(currentLi).removeClass("current");
    var ulId = currentLi.parent().attr("id");
    var skuId = ulId.substring(14, ulId.length);
    var index = currentLi.index();
    var cuttentDivs = $("#comb-pro-" + ec.product.getSku() + "-" + index);
    var cuttentDiv = cuttentDivs.eq(index);
    cuttentDivs.show();
    cuttentDivs.siblings(".product-recommend-con").hide()
};
ec.product.syncCustomSession = function () {
    (new ec.ajax).get({
        async: false,
        url: "/account/syncEmailAndMobile.json",
        timeout: 1e4,
        successFunction: function (json) {
            if (!ec.util.isEmpty(json.customerInfo)) {
                ec.product.email = json.customerInfo.email;
                ec.product.mobile = json.customerInfo.mobile
            }
            return
        },
        timeoutFunction: function () {
            return
        },
        errorFunction: function () {
            return
        }
    })
};
ec.product.giftshow = function () {
    var box = new ec.box($("#pro-gift-box").html(), {
        boxclass: "ol_box_4",
        title: "选择赠品颜色",
        showButton: false,
        autoHeight: false
    });
    box.open();
    $(".box-content").find("#pro-gift-list-detail").parent().siblings().show().html('<a href="javascript:;" class="box-cancel" onclick="ec.product.boxCancle()"><span>取消</span></a><a href="javascript:;" class="box-sure" id="box-sures" ><span>确认</span></a>');
    $("div[id^='pro-gift-list-detail'] li a").bind("click", function (event) {
        if ($(this).parent().hasClass("selected")) {
            $(this).parent().parent().find("li").removeClass("new");
            $(this).parent().addClass("new");
            return
        }
        $(this).parent().parent().find("li").removeClass("selected");
        $(this).parent().addClass("selected");
        $(this).parent().parent().find("li").removeClass("new");
        $(this).parent().addClass("new");
        var mainSku = ec.product.getSku();
        var multiGiftVO = ec.product.gift.mainSkuGiftMap[mainSku];
        var finalGift = ec.product.gift.finalMainSbomGiftMap[mainSku];
        var choseGiftKey = $(this).attr("key");
        var gift = multiGiftVO[choseGiftKey];
        var defaultGiftKey = $(this).attr("defaultGiftKey");
        finalGift[defaultGiftKey] = gift;
        $("#ol_box").find("#gift-detail-" + defaultGiftKey).find("img").attr("src", ec.mediaPath + gift.photoPath + ec.product.gift.middleImgSize + gift.photoName);
        $("#ol_box").find("#gift-detail-" + defaultGiftKey).attr("href", "/product/" + gift.giftId + ".html#" + gift.giftSkuId);
        $("#ol_box").find("#gift-detail-name" + defaultGiftKey).html(gift.giftName)
    });
    $("#box-sures").bind("click", function (event) {
        $("div[id^='ol_box'] li.selected").each(function () {
            var mainSku = ec.product.getSku();
            var multiGiftVO = ec.product.gift.mainSkuGiftMap[mainSku];
            var finalGift = ec.product.gift.finalMainSbomGiftMap[mainSku];
            var choseGiftKey = $(this).children("a").attr("key");
            var gift = multiGiftVO[choseGiftKey];
            var defaultGiftKey = $(this).children("a").attr("defaultGiftKey");
            finalGift[defaultGiftKey] = gift;
            $("#ol_box").find("#gift-detail-" + defaultGiftKey).find("img").attr("src", ec.mediaPath + gift.photoPath + ec.product.gift.middleImgSize + gift.photoName);
            $("#ol_box").find("#gift-detail-" + defaultGiftKey).attr("href", "/product/" + gift.giftId + ".html#" + gift.giftSkuId);
            $("#ol_box").find("#gift-detail-name" + defaultGiftKey).html(gift.giftName);
            $("#gift-" + defaultGiftKey).attr("href", "/product/" + gift.giftId + ".html#" + gift.giftSkuId);
            $("#gift-" + defaultGiftKey).attr("title", gift.giftName);
            $("#gift-" + defaultGiftKey).attr("key", choseGiftKey);
            $("#gift-" + defaultGiftKey).find("img").attr("src", ec.mediaPath + gift.photoPath + ec.product.gift.middleImgSize + gift.photoName);
            $("#gift-" + defaultGiftKey).find("img").attr("alt", gift.giftName)
        });
        var html = $("#ol_box").find("#pro-gift-list-detail").html();
        $("#pro-gift-list-detail").html("");
        $("#pro-gift-list-detail").append(html);
        $(".ol_box_mask").remove();
        $("#ol_box").hide()
    })
};
ec.product.boxCancle = function () {
    $(".ol_box_mask").remove();
    $("#ol_box").remove()
};
ec.product.getSysDate = function () {
    var now = new Date;
    (new ec.ajax).get({
        async: false,
        url: "/system/getSysDate.json?" + (new Date).getTime(),
        timeout: 1e4,
        successFunction: function (json) {
            if (!ec.util.isEmpty(json.now)) {
                now.setTime(json.now.parseDate("yyyy-MM-dd HH:mm:ss"))
            }
        }
    });
    return now
};
ec.product.splitMobile = function (mobile) {
    var result = "";
    for (var i = 0; i < mobile.length; i++) {
        if ((mobile.length - i) % 4 == 0) {
            result += "&nbsp;&nbsp;"
        }
        result += mobile.substring(i, i + 1)
    }
    return result
};
ec.product.getPackageAndService = function (skuId) {
    var packageContent = ec.product.packageList[skuId];
    var serviceContent = ec.product.warranty[skuId];
    var hasPackage = packageContent ? true : false;
    var hasService = serviceContent ? true : false;
    var hasBoth = hasPackage && hasService;
    packFlag = !hasPackage && !hasService;
    $("#pro-tab-package-service-content").empty();
    $("#pro-tab-service-content").empty();
    $("#pro-tab-package-service-content").hide();
    $("#packagTitleId").hide();
    $("#customerServiceTitle").hide();
    $("#customerServiceDiv").hide();
    $("#pro-tab-package-service").hide();
    if (hasPackage) {
        $("#pro-tab-package-service-content").html(packageContent);
        $("#pro-tab-package-service-content").show();
        $("#packagTitleId").show();
        $("#pro-tab-package-service").show()
    }
    if (hasService) {
        $("#pro-tab-service-content").html(serviceContent);
        $("#customerServiceTitle").show();
        $("#customerServiceDiv").show();
        $("#pro-tab-package-service").show()
    }
};
ec.product.getFeature = function (skuId) {
    if (ec.product.getSkuForFeature(skuId) != undefined || $("#pro-detail-content-" + skuId).length > 0) {
        $("#pro-tab-parameter").removeClass("selected");
        $("#pro-tab-feature").addClass("selected").show();
        $("#pro-detail-contents").show();
        $("#pro-detail-content-" + (ec.product.setSkuId || skuId)).show().siblings().hide();
        if (masterPlayer) {
            masterPlayer.dispose()
        }
        ec.product.payVideo();
        return
    }
    (new ec.ajax).get({
        url: "/product/querySkuDetailFeature/" + ec.product.getSku() + ".json",
        timeout: 1e4,
        timeoutFunction: function () {
            $("#pro-detail-contents > div:first-child").html("正在加载...")
        },
        successFunction: function (json) {
            if (!json.success) {
                $("#pro-tab-feature").removeClass("selected").hide();
                $("#pro-tab-parameter").addClass("selected");
                $("#pro-detail-contents").hide();
                return
            }
            if (json.length == 0) {
                $("#pro-tab-feature").removeClass("selected").hide();
                $("#pro-tab-parameter").addClass("selected");
                $("#pro-tab-feature").hide();
                $("#pro-detail-contents").hide();
                return
            }
            $("#pro-tab-parameter").removeClass("selected");
            $("#pro-tab-feature").addClass("selected");
            $("#pro-tab-feature").show();
            $("#pro-detail-contents").show();
            ec.product.setSkuForFeature(skuId);
            var content = [];
            content.push('<div id="pro-detail-content-' + json.id + '" class="pro-detail-see">');
            content.push('<div id="kindPicture-' + json.id + '">');
            content.push(json.detail);
            content.push("</div>");
            content.push('<div id="detail-content-button-' + json.id + '" class="product-shade hide"><p>');
            content.push('<a id="pro-detail-down-btn-' + json.id + '" class="product-detail-btn">');
            content.push("查看全部产品详情</a></p></div>");
            content.push('<a href="javascript:;" id="pro-detail-up-btn-' + json.id + '" class="product-detail-btnup hide">收起全部产品详情</a>');
            content.push("</div>");
            var feature = $("#pro-tab-feature-content > div:first-child");
            feature.prepend(content.join(""));
            if (masterPlayer) {
                setTimeout(function () {
                    masterPlayer.dispose()
                }, 300)
            }
            ec.product.payVideo();
            $("#pro-detail-content-" + (ec.product.setSkuId || skuId)).show().siblings().hide();
            var imgHeight = 0;
            $("#pro-detail-content-" + (ec.product.setSkuId || skuId) + " img").each(function (index) {
                $(this).load(function () {
                    imgHeight = imgHeight + $(this).height();
                    if (imgHeight >= 2e3) {
                        $("#pro-detail-content-" + json.id).height("2000");
                        $("#detail-content-button-" + json.id).show();
                        $("#pro-detail-down-btn-" + json.id).click(function () {
                            $("#pro-detail-content-" + json.id).height($("#kindPicture-" + json.id).height() + $("#pro-detail-up-btn-" + json.id).height() + 40);
                            $("#detail-content-button-" + json.id).hide();
                            $("#pro-detail-up-btn-" + json.id).css("display", "block");
                            upDownButton = "true"
                        });
                        $("#pro-detail-up-btn-" + json.id).click(function () {
                            $("#pro-detail-content-" + json.id).height("2000");
                            $("#detail-content-button-" + json.id).show();
                            $("#pro-detail-up-btn-" + json.id).css("display", "none");
                            upDownButton = "false";
                            $("body,html").animate({scrollTop: tit1 + 1575}, 0)
                        });
                        return false
                    }
                })
            });
            if (imgHeight < 2e3) {
                $("#detail-content-button-" + json.id).hide()
            }
        },
        errorFunction: function () {
            $("#pro-tab-feature").removeClass("selected").hide();
            $("#pro-tab-parameter").addClass("selected");
            $("#pro-detail-contents").hide()
        },
        timeoutFunction: function () {
            $("#pro-tab-feature").removeClass("selected").hide();
            $("#pro-tab-parameter").addClass("selected");
            $("#pro-detail-contents").hide()
        }
    })
};
var masterPlayer;
ec.product.payVideo = function () {
    var skuId = ec.product.getSku();
    var video = $("#pro-detail-content-" + skuId).find(".J_videoTrigger");
    $("#player-container-id").remove();
    if (video) {
        if (!$("#pro-detail-content-" + skuId).find("video") || $("#pro-detail-content-" + skuId).find("video").length == 0) {
            var videoUrl = video.attr("data-video");
            var videoPic = video.attr("data-video-poster");
            if (videoUrl && videoUrl != "") {
                video.append("<span class='video-btn'></span>");
                var playerContainerId = "player-container-id-" + skuId;
                video.click(function () {
                    videoUrl = $(this).attr("data-video");
                    var videoHtml = '<video id="' + playerContainerId + '" preload="auto"  playsinline webkit-playinline x5-playinline src="' + videoUrl + '"></video>';
                    var videoBox = new ec.box(videoHtml, {
                        boxid: "video-box",
                        boxclass: "ol_box_4 video-detail",
                        width: 800,
                        height: 450,
                        draggable: false,
                        showButton: false,
                        zIndex: 700,
                        onclose: function (dom) {
                            masterPlayer.dispose()
                        }
                    }).open();
                    masterPlayer = TCPlayer(playerContainerId, {autoplay: true})
                })
            }
        }
    }
};
ec.product.rushbuyActivity = function (countTemp) {
    rush.business.doIfSbomChanged(countTemp)
};
ec.product.switched = function (value, thix) {
    $("input[name='type']").val(value);
    $(thix).addClass("selected").siblings().removeClass("selected")
};
ec.product.getParameter = function (skuIds, skuCodes) {
    $("#parameterDetailTips").hide();
    if (ec.product.getSkuForParement(skuIds) != undefined) {
        $("#main-parameter-content-" + (ec.product.setSkuId || skuId)).show().siblings().hide();
        $("#content-" + (ec.product.setSkuId || skuId)).show().siblings().hide();
        $("#productParameterId").show();
        $("#productParameterHr30").show();
        return
    }
    var skuList = skuIds.split(",");
    var skuCodeList = skuCodes.split(",");
    var reqParam = "";
    for (var i = 0; i < skuCodeList.length; i += 1) {
        reqParam += skuCodeList[i];
        if (i == 0) {
            break
        }
    }
    $.ajax({
        url: domainMain + "/product/querySpecificationMulti/" + reqParam + ".json?",
        dataType: "json",
        timeout: 2e4,
        success: function (json) {
            if (!json.success) {
                $("#parameterDetailTips").show();
                return
            }
            $("#parameterDetailTips").hide();
            ec.product.setSkuForParement(skuIds);
            for (var n = 0; n < skuList.length; n += 1) {
                var skuId = skuList[n];
                var sbomCode = skuCodeList[n];
                var attrs = null;
                var mainAttrs = null;
                for (var m = 0; m < json.info.length; m += 1) {
                    var specificationInfo = json.info[m];
                    if (sbomCode == specificationInfo.sbomCode) {
                        attrs = specificationInfo.specificationList;
                        mainAttrs = specificationInfo.majorSpecificationList;
                        break
                    }
                }
                var mainHtml = [];
                if (mainAttrs != null && mainAttrs.length > 0) {
                    var mainP;
                    mainHtml.push("<h2>主要参数</h2>");
                    mainHtml.push("<ul>");
                    for (var j = 0; j < mainAttrs.length; j++) {
                        mainP = mainAttrs[j];
                        if (mainP.attrValue != null && mainP.attrValue != "" && mainP.attrValue != undefined) {
                            mainHtml.push("<li><label>" + mainP.attrName + "</label><span>" + mainP.attrValue + "</span></li>")
                        }
                    }
                    mainHtml.push("</ul>")
                }
                $("#product-parameter-main").append('<div id="main-parameter-content-' + skuId + '" class="product-parameter-main clearfix hide">' + mainHtml.join("") + "</div>");
                $("#main-parameter-content-" + (ec.product.setSkuId || skuId)).show().siblings().hide();
                var html = [];
                if (attrs) {
                    var p;
                    var html0 = [];
                    for (var i = 0; i < attrs.length; i++) {
                        p = attrs[i];
                        var html1 = [];
                        if ("0" == p.parentAttrCode) {
                            html1.push('<div class="product-parameter-list clearfix">');
                            html1.push("<h2>" + p.attrName + "</h2>");
                            var code = p.attrCode;
                            var html2 = [];
                            html2.push("<ul>");
                            for (var j = 0; j < attrs.length; j++) {
                                var p2 = attrs[j];
                                if (p2.parentAttrCode != "0" && p2.parentAttrCode == code) {
                                    html2.push("<li><label>" + p2.attrName + "</label><span>" + ec.util.escapeHtml(p2.attrValue) + "</span></li>")
                                }
                            }
                            html2.push("</ul>");
                            if (html2.length > 2) {
                                html0.push(html1.join(""));
                                html0.push(html2.join(""));
                                html0.push("</div>")
                            }
                        }
                    }
                    html0.push('<div class="product-parameter-list clearfix">');
                    html0.push("<h2>商品编码</h2>");
                    html0.push("<ul><li><label>" + sbomCode + "</label><span></span></li></ul></div>");
                    if (html0.length > 0) {
                        html.push('<div id="content-' + skuId + '" >');
                        html.push('<div id="parameterContentButton-' + skuId + '" class="product-shade hide">');
                        html.push('<p><a id="parameterDownButton-' + skuId + '"  href="javascript:;"  class="product-detail-btn">查看全部参数</a></p>');
                        html.push("</div>");
                        html.push('<div id="pro-tab-parameter-content-' + skuId + '" class="layout">');
                        html.push('<div id="parameter-content-' + skuId + '">');
                        html.push(html0.join(""));
                        html.push("</div>");
                        html.push("</div>");
                        html.push('<a id="parameterUpButton-' + skuId + '" href="javascript:;" class="product-detail-btnup hide">收起参数详情</a>');
                        html.push("</div>")
                    }
                }
                $("#productDetailParameter").prepend(html.join(""));
                $("#content-" + (ec.product.setSkuId || skuId)).show().siblings().hide()
            }
            $("#productParameterId").show();
            $("#productParameterHr30").show();
            var sku = ec.product.getSku();
            sku = ec.product.getSkuInfo(sku);
            var detailHeight = $("#parameter-content-" + sku.id).height();
            if (detailHeight <= 540 && detailHeight > 0) {
                $("#parameterContentButton-" + sku.id).removeClass("show").addClass("hide")
            } else {
                $("#parameterContentButton-" + sku.id).removeClass("hide").addClass("show");
                $("#pro-tab-parameter-content-" + sku.id).css({height: "540", overflow: "hidden"});
                $("#parameterDownButton-" + sku.id).click(function () {
                    $("#pro-tab-parameter-content-" + sku.id).height($("#parameter-content-" + sku.id).height());
                    $("#parameterContentButton-" + sku.id).removeClass("show").addClass("hide");
                    $("#parameterUpButton-" + sku.id).removeClass("hide").addClass("show")
                });
                $("#parameterUpButton-" + sku.id).click(function () {
                    $("#parameterContentButton-" + sku.id).removeClass("hide").addClass("show");
                    $("#parameterUpButton-" + sku.id).removeClass("show").addClass("hide");
                    $("#pro-tab-parameter-content-" + sku.id).height("540");
                    $("body,html").animate({scrollTop: tit1 + $("#pro-tab-feature-content").height() + $("#hr60Detail").height() + 270}, 0)
                })
            }
        },
        error: function () {
            $("#parameterDetailTips").show()
        }
    })
};

function stopConsultation() {
    $("#stopConsultationId").hide();
    $("#myConsultation").show();
    $("#upUserAdvisory").removeClass("show").addClass("hide")
}

ec.product.switchSku = function () {
    oTop = $(".product-tab").offset().top;
    clickFlag = false
};
ec.product.pagerScroll = function (id) {
    $("#" + id + " li.link").click(function () {
        $("html, body").animate({scrollTop: $("#productAsk").offset().top - $("#product-tab").height()})
    })
};
ec.product.serverCommodity = function (id) {
    var num = $("#" + id + " ul li").length, lineNum = Math.ceil((num - 1) / 2);
    liHeight = $("#" + id + " ul li").height();
    $("#" + id + " ul li").eq(0).css({height: lineNum * 24 - 6})
};
ec.product.scroll = function (id, num) {
    var $div = $("#" + id).parent().parent();
    var len = $div.find(".swiper-slide").length;
    if (len <= num) {
        $div.find(".swiper-button-prev").addClass("disabled");
        $div.find(".swiper-button-next").addClass("disabled")
    } else {
        $div.find(".swiper-button-next").removeClass("disabled")
    }
    var mySwiper = new Swiper("#" + id, {slidesPerView: num, slidesPerGroup: num});
    $div.find(".swiper-button-prev").click(function () {
        mySwiper.swipePrev()
    });
    $div.find(".swiper-button-next").click(function () {
        mySwiper.swipeNext()
    })
};
$(document).ready(function () {
    var c = $(".swiper-container"), a = [];
    c.each(function (f, g) {
        a.push($(this).attr("id"))
    });
    $.each(a, function (f, g) {
        var totalLen = $("#" + g).find(".swiper-slide").length;
        if (totalLen <= 5) {
            $("#" + g).parent().find(".swiper-button-prev").hide();
            $("#" + g).parent().find(".swiper-button-next").hide()
        } else {
            $("#" + g).find(".swiper-button-next").show()
        }
        var mySwiper = new Swiper("#" + g, {slidesPerView: 2, slidesPerGroup: 2});
        $("#" + g).parent().find(".btn-prev").click(function () {
            mySwiper.swipePrev()
        });
        $("#" + g).parent().find(".btn-next").click(function () {
            mySwiper.swipeNext()
        })
    });
    $("#pro-relation-scroll").find("li").mousedown(function () {
        return false
    })
});

function pushProHistoryMsg(productId, column) {
    var value = {
        UID: ec.util.cookie.get("uid"),
        TID: getPtid(),
        TIME: getTime(),
        CONTENT: {SKUCode: productId, click: "1"}
    };
    ec.account.dapPushMsg("300020801", value, "click");
    ec.code.addAnalytics({hicloud: true});
    _paq.push(["trackLink", "300020801", "link", value])
}

function pushProGiftBuySerMsg() {
    var skucode = $("#pro-sku-code").val();
    var value = {
        UID: ec.util.cookie.get("uid"),
        TID: getPtid(),
        TIME: getTime(),
        CONTENT: {selectGiftbuy: "1", SKUCode: skucode, click: "1"}
    };
    ec.code.addAnalytics({hicloud: true});
    _paq.push(["trackLink", "300021001", "link", value])
}

function checkedThis(obj, id, cname, idName) {
    var boxArray = document.getElementsByName(cname);
    var flag = false;
    var checkBoxObj = $(obj).children("input:first-child")[0];
    if ($("#" + id).hasClass("red")) {
        checkBoxObj.checked = false;
        $("#" + idName).parent().parent().removeClass("hover")
    } else {
        for (var i = 0; i <= boxArray.length - 1; i++) {
            if (boxArray[i] == checkBoxObj) {
                boxArray[i].checked = true;
                if (idName == "extendProtected") {
                    $("#extendProtected").parent().parent().removeClass("hover")
                }
                if (idName == "accidentProtected") {
                    $("#accidentProtected").parent().parent().removeClass("hover")
                }
            } else {
                boxArray[i].checked = false;
                if (idName == "extendProtected") {
                    $("#extendProtected").parent().parent().removeClass("hover")
                }
                if (idName == "accidentProtected") {
                    $("#accidentProtected").parent().parent().removeClass("hover")
                }
            }
        }
    }
    if ($("input[name=" + cname + "]:checked").length == 0) {
        $("#" + id).removeClass("red");
        $("#" + idName).parent().parent().removeClass("selected");
        var selectNo = $("#" + idName).parent().parent().find("span").eq(0).attr("id");
        $("#" + selectNo).html("");
        $("#" + selectNo).attr("skuid", "");
        $("#" + selectNo).attr("data-scode", "");
        if (idName == "extendProtected") {
            $("#extend-selected").remove()
        }
        if (idName == "accidentProtected") {
            $("#accident-selected").remove()
        }
    } else {
        var attrSelectService = [];
        if ($("#" + id).hasClass("red")) {
            $("#" + id).removeClass("red")
        }
        if (idName == "extendProtected") {
            $("#extendProtected").parent().parent().find("a").eq(0).remove();
            var productId = $("#" + id).attr("id"), name = $("#" + id).attr("title");
            $("#extendSelect").html(name);
            $("#extendSelect").attr("skuid", $("#" + id).attr("skuID"));
            $("#extendSelect").attr("data-scode", $("#" + id).attr("data-scode"));
            $("#extendSelect").attr("interest-price", $("#" + id).attr("data-price"));
            var textName = '<span class="fl max-w">' + $("#" + id).attr("title") + '</span><span class="fl">&nbsp;￥' + $("#" + id).attr("data-price") + "</span>";
            $("#extendProtected").parent().before('<a href="javascript:;" onclick="ec.product.click_function(this)" class="product-service-btn">' + textName + "</a>");
            $("#extendProtected").parent().parent().addClass("selected");
            $("#" + id).addClass("red");
            $("#extendProtected ul li .product-service-listcon").not("#" + id).removeClass("red");
            $("#extend-selected").remove();
            var temp1 = $("#extendSelect").text();
            if (temp1 != "") {
                attrSelectService.push('<div id="extend-selected" class="inline">&nbsp;/&nbsp;' + temp1 + "</div>");
                var selected_attributes = $("#pro-select-sku").html();
                $("#pro-select-sku").html(selected_attributes + attrSelectService.join(""))
            }
        }
        if (idName == "accidentProtected") {
            $("#accidentProtected").parent().parent().find("a").eq(0).remove();
            var productId = $("#" + id).attr("id"), name = $("#" + id).attr("title");
            $("#accidentSelect").html(name);
            $("#accidentSelect").attr("skuid", $("#" + id).attr("skuID"));
            $("#accidentSelect").attr("data-scode", $("#" + id).attr("data-scode"));
            $("#accidentSelect").attr("interest-price", $("#" + id).attr("data-price"));
            var textName = '<span class="fl max-w">' + $("#" + id).attr("title") + '</span><span class="fl">&nbsp;￥' + $("#" + id).attr("data-price") + "</span>";
            $("#accidentProtected").parent().before('<a href="javascript:;" onclick="ec.product.click_function(this)" class="product-service-btn">' + textName + "</a>");
            $("#accidentProtected").parent().parent().addClass("selected");
            $("#" + id).addClass("red");
            $("#accidentProtected ul li .product-service-listcon").not("#" + id).removeClass("red");
            $("#accident-selected").remove();
            var temp2 = $("#accidentSelect").text();
            if (temp2 != "") {
                attrSelectService.push('<div id="accident-selected" class="inline">&nbsp;/&nbsp;' + temp2 + "</div>");
                var selected_attributes = $("#pro-select-sku").html();
                $("#pro-select-sku").html(selected_attributes + attrSelectService.join(""))
            }
        }
    }
    ec.product.interest.queryFreeDetail();
    ec.product.refreshStyle()
}

ec.product.click_function = function (dom) {
    var domIdName = $(dom).parent().find(".product-service-list").attr("id");
    $(dom).parent().data("flag", "1");
    $("#" + domIdName).parent().parent().removeClass("hover");
    if ($(dom).parent().hasClass("selected")) {
        $(dom).parent().removeClass("selected");
        $(dom).parent().find("p").removeClass("red");
        var select_no = $(dom).parent().find("span").eq(0).attr("id");
        $("#" + select_no).attr("skuid", "");
        $("#" + select_no).attr("data-scode", "");
        $("#" + select_no).attr("interest-price", "");
        if (domIdName == "extendProtected") {
            $("#extendProtected").parent().parent().find("a").eq(0).remove();
            $("#extendProtected ul").find("li").find("input").attr("checked", false);
            $("#extendProtected ul").find("li").find(".product-service-listcon").removeClass("red");
            $("#extend-selected").remove();
            var tempE = $("#extendProtected ul").find("li").eq(0).find(".product-service-listcon");
            var extend_name = '<span class="fl max-w">' + tempE.attr("title") + '</span><span class="fl">&nbsp;￥' + tempE.attr("data-price") + "</span>";
            $("#extendProtected").parent().before('<a href="javascript:;" onclick="ec.product.click_function(this)" class="product-service-btn">' + extend_name + "</a>")
        }
        if (domIdName == "accidentProtected") {
            $("#accidentProtected").parent().parent().find("a").eq(0).remove();
            $("#accidentProtected ul").find("li").find("input").attr("checked", false);
            $("#accidentProtected ul").find("li").find(".product-service-listcon").removeClass("red");
            $("#accident-selected").remove();
            var tempA = $("#accidentProtected ul").find("li").eq(0).find(".product-service-listcon");
            var accident_name = '<span class="fl max-w">' + tempA.attr("title") + '</span><span class="fl">&nbsp;￥' + tempA.attr("data-price") + "</span>";
            $("#accidentProtected").parent().before('<a href="javascript:;" onclick="ec.product.click_function(this)" class="product-service-btn">' + accident_name + "</a>")
        }
        ec.product.interest.queryFreeDetail()
    } else {
    }
};
ec.product.newpackageView = function (dom, packageCode, skuCode) {
    var proPriceHtml = [];
    var sku = ec.product.getSku();
    var skuInfo = ec.product.getSkuInfo(sku);
    ec.product.packageViewChange(dom, packageCode);
    $("#packageCode").val(packageCode);
    $("#packageList").html("");
    _giftBuyItemId = [];
    if (packageCode == null) {
        if ($("#giftBuy_dl").length > 0) {
            if ($("#giftBuy_dl").hasClass("hide")) {
                $("#giftBuy_dl").removeClass("hide")
            }
            $.each($("#giftBuy_dl").find("li"), function () {
                if ($(this).attr("data-attrname") == "无增值服务") {
                    $(this).addClass("selected");
                    $("#giftBuy-selected").html("/ 无增值服务")
                }
            });
            if ($("#pro-operation").find("a").length == 2 && $("#pro-operation").find("a").first().find("span").html() == "加入购物车") {
                $("#pro-operation").find("a").first().attr("onclick", "").click(function () {
                    ec.product.addCart()
                })
            }
            if ($("#pro-operation").find("a").length == 1 && $("#pro-operation").find("a").first().find("span").html() == "立即下单") {
                $("#pro-operation").find("a").first().attr("onclick", "").click(function () {
                    ec.product.orderNow()
                });
                $("#pro-operation").find("a").before('<a href="javascript:;" onclick="ec.product.addCart()" class="product-button01"><span>加入购物车</span></a>')
            }
        }
        $("#pro-price-label").addClass("f24").removeClass("type");
        $("#pro-price-label").hide();
        $("#pro-price").html("<em>¥</em>" + skuInfo.price + "");
        ec.product.showTips();
        ec.product.processSupportDisplayDilieryTime(skuInfo);
        ec.product.interest.queryFreeDetail();
        return
    }
    ec.product.hiddenTips();
    if ($("#giftBuy_dl").length > 0) {
        if (!$("#giftBuy_dl").hasClass("hide")) {
            $("#giftBuy_dl").addClass("hide")
        }
        $("#giftBuy_dl").find("li").removeClass("selected");
        $("#giftBuy-selected").html("");
        if ($("#pro-operation").find("a").length == 2 && $("#pro-operation").find("a").first().find("span").html() == "加入购物车") {
            $("#pro-operation").find("a").first().attr("onclick", "").click(function () {
                ec.product.addCart()
            })
        }
        if ($("#pro-operation").find("a").length == 1 && $("#pro-operation").find("a").first().find("span").html() == "立即下单") {
            $("#pro-operation").find("a").first().attr("onclick", "").click(function () {
                ec.product.orderNow()
            });
            $("#pro-operation").find("a").before('<a href="javascript:;" onclick="ec.product.addCart()" class="product-button01"><span>加入购物车</span></a>')
        }
    }
    var pro_sbomList = skuInfo.pro_sbomList;
    var new_package = "";
    var newpackage = "";
    for (var i = 0; i < pro_sbomList.length; i++) {
        if (skuCode == pro_sbomList[i].sbomCode) {
            new_package = pro_sbomList[i].sbomPackageList;
            break
        }
    }
    if (new_package != "" && new_package.length > 0) {
        for (var o = 0; o < new_package.length; o++) {
            if (packageCode == new_package[o].packageCode) {
                newpackage = new_package[o];
                break
            }
        }
    }
    var newpackageListHtml = [];
    var prdId = $("#product_productId").val();
    if (newpackage != "" && newpackage != null) {
        newpackageListHtml.push('<div class="product-recommend product-package-mini">');
        newpackageListHtml.push('<div class="product-recommend-con clearfix">');
        newpackageListHtml.push('<div class="product-recommend-main">');
        newpackageListHtml.push('<div class="product-recommend-thumbs">');
        newpackageListHtml.push('<ul class="clearfix">');
        newpackageListHtml.push('<li> <a> <img src="' + ec.mediaPath + skuInfo.photoPath + "100_100_" + skuInfo.photoName + '">');
        newpackageListHtml.push('<p title="' + skuInfo.name + '">' + skuInfo.name + "</p>");
        newpackageListHtml.push("</a></li></ul></div></div>");
        var sbomPackageInfo = newpackage.packageList;
        if (sbomPackageInfo != "" && sbomPackageInfo.length > 0) {
            newpackageListHtml.push('<div class="goods-rolling product-recommend-detail">');
            newpackageListHtml.push('<div id="btn-prev" class="grid-btn btn-prev disabled">');
            newpackageListHtml.push("<span></span></div>");
            newpackageListHtml.push('<div id="btn-next" class="grid-btn btn-next"><span></span></div>');
            newpackageListHtml.push('<div id="goodsRecommend-recommend" class="swiper-container product-recommend-thumbs">');
            newpackageListHtml.push('<ul class=" swiper-wrapper clearfix" style="width: 1000px;">');
            for (var j = 0; j < sbomPackageInfo.length; j++) {
                newpackageListHtml.push('<li class="swiper-slide" attr-packageSkuCode="' + sbomPackageInfo[j].sbomCode + '"><a href="/product/' + sbomPackageInfo[j].disPrdId + '.html" target="_blank"><img src="' + ec.mediaPath + sbomPackageInfo[j].photoPath + "100_100_" + sbomPackageInfo[j].photoName + '">');
                newpackageListHtml.push('<p title="' + sbomPackageInfo[j].sbomName + '">' + sbomPackageInfo[j].sbomName + "</p></a>");
                var GbomAttr = sbomPackageInfo[j].gbomAttrList;
                if (GbomAttr != "" && GbomAttr.length > 0) {
                    newpackageListHtml.push('<dl class="color clearfix">');
                    for (var p = 0; p < GbomAttr.length; p++) {
                        if (p == 0) {
                            newpackageListHtml.push('<dd class="selected"><a href="javascript:;" onclick="ec.product.packageChangeColor(this)" attr-name="' + sbomPackageInfo[j].sbomName + '" attr-imgSrc="' + ec.mediaPath + sbomPackageInfo[j].photoPath + "100_100_" + sbomPackageInfo[j].photoName + '" attr-prdId="' + sbomPackageInfo[j].disPrdId + '" attr-packageSkuCode="' + sbomPackageInfo[j].sbomCode + '">' + GbomAttr[p].attrValue + "</a></dd>")
                        } else {
                            newpackageListHtml.push('<dd><a href="javascript:;" onclick="ec.product.packageChangeColor(this)" attr-name="' + sbomPackageInfo[j].sbomName + '" attr-imgSrc="' + ec.mediaPath + sbomPackageInfo[j].photoPath + "100_100_" + sbomPackageInfo[j].photoName + '" attr-prdId="' + sbomPackageInfo[j].disPrdId + '" attr-packageSkuCode="' + sbomPackageInfo[j].sbomCode + '">' + GbomAttr[p].attrValue + "</a></dd>")
                        }
                        if (j != sbomPackageInfo.length - 1) {
                            var k = j;
                            for (var t = 1; t < sbomPackageInfo.length - k; t++) {
                                if (sbomPackageInfo[k].disPrdId == sbomPackageInfo[k + t].disPrdId) {
                                    GbomAttr = sbomPackageInfo[k + t].gbomAttrList;
                                    newpackageListHtml.push('<dd><a href="javascript:;" onclick="ec.product.packageChangeColor(this)" attr-name="' + sbomPackageInfo[k + t].sbomName + '" attr-imgSrc="' + ec.mediaPath + sbomPackageInfo[k + t].photoPath + "100_100_" + sbomPackageInfo[k + t].photoName + '" attr-prdId="' + sbomPackageInfo[k + t].disPrdId + '" attr-packageSkuCode="' + sbomPackageInfo[k + t].sbomCode + '">' + GbomAttr[0].attrValue + "</a></dd>");
                                    j = k + t
                                }
                            }
                        }
                    }
                    newpackageListHtml.push("</dl></li>")
                }
            }
            newpackageListHtml.push("</ul></div></div></div>")
        }
        var savingPrice = (newpackage.totalPrice - newpackage.packageTotalPrice).toFixed(2);
        newpackageListHtml.push('<div class="product-package-mini-tool clearfix">');
        newpackageListHtml.push('<p><span class="f14">套餐价：</span><strong class="red">￥' + newpackage.packageTotalPrice + '</strong><span class="save"> <strong>省</strong><em>￥' + savingPrice + "</em> </span></p>");
        newpackageListHtml.push('<div class="fr"><a href="#" class="product-package-mini-btn product-button02" onclick="ec.product.buyBundle(1,this)">加入购物车</a></div>');
        newpackageListHtml.push("</div></div>")
    }
    $("#packageList").html(newpackageListHtml.join(""));
    ec.product.packageGetSkuCode();
    $("#pro-price-label").html("套餐价");
    $("#pro-price-label").removeClass("f24").addClass("type");
    $("#pro-price-label").show();
    $("#pro-price").html("<em>&yen;</em>" + newpackage.packageTotalPrice);
    ec.product.newPackageSwiper();
    ec.product.interest.queryFreeDetail();
    var sku = ec.product.getSku()
};
ec.product.packageViewChange = function (dom, packageCode, type) {
    if ($(dom).parent().parent().hasClass("selected")) {
        if ($(dom).parent().parent().hasClass("click")) {
            $(dom).parent().parent().removeClass("click");
            if (type == "gift") {
                $("#giftPackageList").addClass("hide")
            } else $("#packageList").addClass("hide")
        } else {
            if (type == "gift") {
                $(dom).parent().parent().parent().find("li").removeClass("click");
                $(dom).parent().parent().addClass("click");
                $("#giftPackageList").removeClass("hide")
            } else {
                if (packageCode == null) {
                    $("#packageList").html("");
                    return
                } else {
                    $(dom).parent().parent().addClass("click");
                    $("#packageList").removeClass("hide")
                }
            }
        }
    } else {
        $(dom).parent().parent().parent().find("li").removeClass("selected click");
        if (type == "gift") {
            $(dom).parent().parent().addClass("selected click");
            $("#giftPackageList").removeClass("hide")
        } else {
            if (packageCode == null) {
                $(dom).parent().parent().addClass("selected");
                $("#packageList").html("");
                $("#packageCode").val("");
                $("#packageListCode").val("")
            } else {
                $(dom).parent().parent().addClass("selected click");
                $("#packageList").removeClass("hide")
            }
            $("#package-selected").html();
            $("#package-selected").html("&nbsp;/&nbsp;" + $(dom).parent().parent().attr("data-attrname"))
        }
    }
};
$("body").live("click", function (e) {
    if (!($("#package_dl").length > 0) && !$("#bundlePackage").length > 0) {
        return
    }
    if (!$("#packageList").hasClass("hide")) {
        if ($(e.target).parents("#packageList").length > 0 || $(e.target).parents("#packageSelect").length > 0) {
            return
        } else {
            if ($("#packageList").hasClass("hide")) {
                return
            }
            $("#packageSelect").find(".click").removeClass("click");
            $("#packageList").addClass("hide");
            ec.product.packageGetSkuCode()
        }
    }
    if (!$("#giftPackageList").hasClass("hide")) {
        if ($(e.target).parents("#giftPackageList").length > 0 || $(e.target).parents("#bundlePackageSelect").length > 0) {
            return
        } else {
            if ($("#giftPackageList").hasClass("hide")) {
                return
            }
            $("#bundlePackageSelect").find(".click").removeClass("click");
            $("#giftPackageList").addClass("hide");
            ec.product.packageGetSkuCode("gift")
        }
    }
});
ec.product.packageChangeColor = function (dom, type) {
    if ($(dom).parent().hasClass("selected")) {
        return
    } else {
        $(dom).parent().parent().find("dd").removeClass("selected");
        $(dom).parent().addClass("selected");
        ec.product.packageGetSkuCode(type)
    }
};
ec.product.packageGetSkuCode = function (type) {
    var packageListCode = [];
    var giftPackageListCode = [];
    if (type == "gift") {
        $("#bundlePackageSelect").find("ul").find("dl").find(".selected").find("a").each(function () {
            if ($(this).attr("attr-packageskucode") != "") {
                $(this).parent().parent().parent().attr("attr-packageskucode", $(this).attr("attr-packageskucode"));
                $(this).parent().parent().parent().find("img").attr("src", $(this).attr("attr-imgSrc"));
                $(this).parent().parent().parent().find("p").attr("title", $(this).attr("attr-name"));
                $(this).parent().parent().parent().find("p").html($(this).attr("attr-name"))
            }
        });
        $("#goodsRecommend-recommend-gift").find("li").each(function () {
            giftPackageListCode.push($(this).attr("attr-packageskucode"))
        });
        var skuId = $("#bundlePackageSelect").find(".product-recommend-main").find("a").attr("sku-id");
        ec.product.gift.packageGiftMap[skuId] = giftPackageListCode
    } else {
        $("#packageSelect").find("ul").find("dl").find(".selected").find("a").each(function () {
            if ($(this).attr("attr-packageskucode") != "") {
                $(this).parent().parent().parent().attr("attr-packageskucode", $(this).attr("attr-packageskucode"));
                $(this).parent().parent().parent().find("img").attr("src", $(this).attr("attr-imgSrc"));
                $(this).parent().parent().parent().find("p").attr("title", $(this).attr("attr-name"));
                $(this).parent().parent().parent().find("p").html($(this).attr("attr-name"))
            }
        });
        $("#goodsRecommend-recommend").find("li").each(function () {
            packageListCode.push($(this).attr("attr-packageskucode"))
        });
        $("#packageListCode").val(packageListCode)
    }
};
ec.product.newPackageSwiper = function (id) {
    if (id == null || typeof id == "undefined") {
        id = ""
    }
    var totalLen = $("#goodsRecommend-recommend" + id).find(".swiper-slide").length;
    if (totalLen <= 2) {
        $("#btn-prev" + id).addClass("disabled");
        $("#btn-next" + id).addClass("disabled")
    } else {
        $("#btn-next" + id).removeClass("disabled")
    }
    var mySwiper = new Swiper("#goodsRecommend-recommend" + id, {slidesPerView: 2, slidesPerGroup: 2});
    $("#btn-prev" + id).click(function () {
        mySwiper.swipePrev();
        ec.product.showSwiper(id)
    });
    $("#btn-next" + id).click(function () {
        mySwiper.swipeNext();
        ec.product.showSwiper(id)
    })
};
ec.product.showSwiper = function (id) {
    var slideLen = $("#goodsRecommend-recommend" + id).find("li").length;
    $.each($("#goodsRecommend-recommend" + id).find("li"), function (index, obj) {
        if (index == 0 && $(obj).hasClass("swiper-slide-visible")) {
            $("#btn-prev" + id).addClass("disabled")
        } else if (index == 0 && !$(obj).hasClass("swiper-slide-visible")) {
            $("#btn-prev" + id).removeClass("disabled")
        }
        if (index == slideLen - 1 && $(obj).hasClass("swiper-slide-visible")) {
            $("#btn-next" + id).addClass("disabled")
        } else if (index == slideLen - 1 && !$(obj).hasClass("swiper-slide-visible")) {
            $("#btn-next" + id).removeClass("disabled")
        }
    })
};
ec.product.hidebundleView = function () {
    if ($("#bundlePackage").length > 0 && $("#bundlePackage").find("li").length > 1) {
        return
    } else if ($("#bundlePackage").find("li").length == 1) {
        $("#bundlePackage").addClass("hide")
    }
};
ec.product.showSbomInterest = function (sku) {
    var showCart = true;
    if ($("#pro-operation").css("visibility") == "hidden") {
        showCart = false
    }
    $("#interestOrderNow").val("");
    $("#interestOrderNow2").val("");
    if (showCart && (sku.buttonMode == "1" || sku.buttonMode == "3" || sku.buttonMode == "10") && $("#pro-operation a:first-child").text() == "加入购物车" && !$("#pro-operation a:first-child").hasClass("disabled") || ec.product.productType == "9" && (sku.buttonMode == "12" || sku.buttonMode == "18") || $("#pro-operation").find("span.product-button-tips").text() == "限时抢购进行中") {
        $("#prd-noInterset").attr("interest-allow", "1");
        var buttonNowInterest = $("#pro-operation a:first-child").text();
        if (buttonNowInterest != "加入购物车") {
            $("#prd-noInterset").attr("interest-button", "0");
            if (ec.product.productType == "9" && (sku.buttonMode == "12" || sku.buttonMode == "18") && buttonNowInterest == "立即下单") {
                $("#prd-noInterset").attr("interest-button", "1")
            }
        }
        $("#hbShow").removeClass("selected click");
        $("#hlShow").removeClass("selected click");
        if (!$("#interestHBPayNow").hasClass("disabled")) {
            $("#interestHBPayNow").addClass("disabled")
        }
        if (!$("#interestPayHLNow").hasClass("disabled")) {
            $("#interestPayHLNow").addClass("disabled")
        }
        if (sku.hbInterestLst.length > 0 || sku.hlInterestLst.length > 0) {
            var hbList = [];
            var handLifeList = [];
            $("#prd-noInterset").removeClass("hide");
            $("#hbDetail").hide();
            $("#hlDetail").hide();
            $("#hbShow").hide();
            $("#hlShow").hide();
            if (sku.hbInterestLst.length > 0) {
                $("#hbShow").show();
                var htmlHBShow = [];
                for (var i = 0; i < sku.hbInterestLst.length; i++) {
                    htmlHBShow.push('<li><a href="javascript:;" onclick="ec.product.interest.checkOne(this);" interest-info="1:' + sku.hbInterestLst[i].num + '">');
                    htmlHBShow.push('<p class="price">&yen;&nbsp;' + sku.hbInterestLst[i].amount + "<em>x</em>" + sku.hbInterestLst[i].num + "期</p>");
                    if (sku.hbInterestLst[i].flag == 0) {
                        htmlHBShow.push("<p>手续费&yen;" + sku.hbInterestLst[i].fee + "/期</p></a></li>")
                    } else {
                        htmlHBShow.push('<p class="red">免息，0手续费</p>')
                    }
                }
                $("#hbDetail").find("ul").html(htmlHBShow.join(""));
                $("#hbShow").find(".sku").unbind("mouseover");
                $("#hbShow").unbind("mouseleave");
                $("#hbShow").find(".sku").mouseover(function () {
                    $("#hbDetail").show();
                    $("#hbShow").addClass("click")
                });
                $("#hbShow").mouseleave(function (e) {
                    if (!e.relatedTarget) {
                        return
                    }
                    $("#hbDetail").hide();
                    $("#hbShow").removeClass("click")
                })
            } else {
                $("#hbShow").hide();
                $("#hbDetail").hide()
            }
            if (sku.hlInterestLst.length > 0) {
                $("#hlShow").show();
                var htmlHLShow = [];
                for (var i = 0; i < sku.hlInterestLst.length; i++) {
                    htmlHLShow.push('<li><a href="javascript:;" onclick="ec.product.interest.checkOne(this);" interest-info="2:' + sku.hlInterestLst[i].num + '">');
                    htmlHLShow.push('<p class="price">&yen;&nbsp;' + sku.hlInterestLst[i].amount + "<em>x</em>" + sku.hlInterestLst[i].num + "期</p>");
                    if (sku.hlInterestLst[i].flag == 0) {
                        htmlHLShow.push("<p>手续费&yen;" + sku.hlInterestLst[i].fee + "/期</p></a></li>")
                    } else {
                        htmlHLShow.push('<p class="red">免息，0手续费</p>')
                    }
                }
                $("#hlDetail").find("ul").html(htmlHLShow.join(""));
                $("#hlShow").find(".sku").unbind("mouseover");
                $("#hlShow").unbind("mouseleave");
                $("#hlShow").find(".sku").mouseover(function () {
                    if (!$("#hlShow").hasClass("click")) {
                        $("#hlDetail").show();
                        $("#hlShow").addClass("click")
                    }
                });
                $("#hlShow").mouseleave(function (e) {
                    if (!e.relatedTarget) {
                        return
                    }
                    $("#hlDetail").hide();
                    $("#hlShow").removeClass("click");
                    $("#hlDetail").find("ul").children("li").each(function () {
                        $(this).removeClass("selected")
                    })
                })
            } else {
                $("#hlShow").hide();
                $("#hlDeatil").hide()
            }
            if ($("#prd-noInterset").attr("interest-button") == "0") {
                $("#interestHBPayNow").each(function () {
                    $(this).addClass("disabled");
                    this.backup = this.onclick;
                    this.onclick = ""
                });
                $("#interestPayHLNow").each(function () {
                    $(this).addClass("disabled");
                    this.backup = this.onclick;
                    this.onclick = ""
                })
            }
        } else {
            if (!$("#prd-noInterset").hasClass("hide")) {
                $("#prd-noInterset").addClass("hide")
            }
            $("#hbDetail").find("ul").html("");
            $("#hlDetail").find("ul").html("")
        }
    } else {
        $("#prd-noInterset").attr("interest-allow", "0");
        $("#hbDetail").find("ul").html("");
        $("#hlDetail").find("ul").html("");
        if (!$("#prd-noInterset").hasClass("hide")) {
            $("#prd-noInterset").addClass("hide")
        }
    }
};
ec.pkg("ec.product");
ec.load("ajax");
ec.load("ec.dh");
ec.load("ec.aes");
ec.load("ec.rc4");
var _defaultAddress = ["广东", "深圳", "龙岗区"];
var _defaultTimeOut = 10000;
var address = [];
var tree_url = domainShoppingConfig + "/data/region/tree/{id}.json";
var children_url = domainShoppingConfig + "/data/region/children/{id}.json";
var addressInfoMap = {};
var commonAddress = {};
var _tempAddress = [];
var _tempAddressIds = [];
var addressConfig = null;
var cache = {}, ajaxer;
var skuAddress;
var ipAddress = [];
var ipAddressCookie = [];
var sbomCode = null;
ec.product.parseUrl = function (a, b) {
    return a.replace(/{id}/g, b)
};
ec.product.processAddress = function (b) {
    _tempAddressIds = [];
    _tempAddress = [];
    skuAddress = b;
    var c = address[0];
    var a = [];
    a.push("<dt>选择新地址</dt>");
    if (c != null && c != "") {
        a.push('<dd id="provice" level-value="1" data-value="" class="current">' + c + "</dd>")
    } else {
        a.push('<dd id="provice" level-value="1" data-value="">请选择</dd>')
    }
    a.push('<dd id="city" level-value="2" data-value="">请选择</dd>');
    a.push('<dd id="district" level-value="3" data-value="">请选择</dd>');
    $("#provice_info").html(a.join(""));
    $("#provice_info").find("dd").bind("click", ec.product.againSelectAddress);
    ec.product.queryData(ec.product.parseUrl(tree_url, "0"), true, 1, ec.product.queryProvince)
};
ec.product.againSelectAddress = function () {
    var c = $(this).attr("data-value");
    var a = parseInt($(this).attr("level-value"));
    if ((c == null || c == "") && a != 1) {
        return
    }
    $(".address-new").find("dd").removeClass();
    switch (a) {
        case 1:
            $("#provice").addClass("current");
            $("#city").html("请选择");
            break;
        case 2:
            $("#provice").removeClass("current");
            $("#city").addClass("current");
            break;
        case 3:
            $("#provice").removeClass("current");
            $("#city").removeClass("current");
            $("#district").addClass("current");
            break
    }
    if (a == 1) {
        ec.product.queryData(ec.product.parseUrl(tree_url, "0"), true, 1, ec.product.queryProvince)
    } else {
        var b = parseInt(c);
        ec.product.queryData(ec.product.parseUrl(children_url, b), true, a, ec.product.queryProvince)
    }
};
ec.product.selectedAddress = function () {
    var c = $(this).attr("districtId");
    var a = $(this).attr("id");
    var b = skuAddress.price;
    ec.util.cookie.set("selectedAddress", $(this).attr("provinceId") + "|" + $(this).attr("cityId") + "|" + c, {
        expires: 30,
        domain: "vmall.com"
    });
    ec.util.cookie.set("shopAddressID", a, {expires: 30, domain: "vmall.com"});
    ec.product.showAddress(commonAddress[a]);
    ec.prescription.queryPreDeliveryAndArrival(ec.product.processPreDeliveryAndArrivalTime, c, b, null, sbomCode)
};
ec.product.changeAddress = function () {
    var c = $(this).attr("id");
    _tempAddressIds.push(c);
    _tempAddress.push($(this).html());
    var a = ec.product.replaceChar($(this).html());
    var b = parseInt($(this).attr("addrType"));
    $(".address-new").find("dd").removeClass();
    switch (b) {
        case 1:
            $("#provice").html(a);
            $("#city").attr("data-value", c);
            $("#provice").removeClass("current");
            $("#city").addClass("current");
            break;
        case 2:
            $("#city").html(a);
            $("#district").attr("data-value", c);
            $("#provice").removeClass("current");
            $("#city").removeClass("current");
            $("#district").addClass("current");
            break;
        case 3:
            $("#district").html(a);
            $("#district").attr("data-value", c);
            $("#provice").removeClass("current");
            $("#city").removeClass("current");
            $("#district").addClass("current");
            $("#address_table").hide();
            break
    }
    if (b < 3) {
        ec.product.queryData(ec.product.parseUrl(children_url, c), true, b + 1, ec.product.queryProvince)
    } else {
        if (b == 3 && _tempAddress.length == 3 && _tempAddressIds.length == 3) {
            address = _tempAddress;
            ec.product.showAddress(address);
            ec.prescription.queryPreDeliveryAndArrival(ec.product.processPreDeliveryAndArrivalTime, _tempAddressIds[2], skuAddress.price, null, sbomCode);
            ec.util.cookie.set("selectedAddress", _tempAddressIds[0] + "|" + _tempAddressIds[1] + "|" + _tempAddressIds[2], {
                expires: 30,
                domain: "vmall.com"
            })
        }
    }
};
ec.product.userAddress = function (g, h) {
    var f = [], d = g;
    f.push("<dt>常用地址</dt>");
    commonAddress = {};
    for (var c = 0; c < d.length; c++) {
        var e = [];
        var j = d[c].provinceName;
        var l = d[c].cityName;
        var k = ec.product.replaceChar(d[c].districtName);
        var b = d[c].streetName == null ? "" : d[c].streetName;
        addressInfoMap[d[c].id] = j + "&nbsp;" + l + "&nbsp;" + k + b + "&nbsp;" + ec.util.escapeHtml(d[c].address);
        var a = addressInfoMap[d[c].id];
        f.push('<dd title="' + a + '" id="' + d[c].id + '" provinceId="' + d[c].province + '" cityId="' + d[c].city + '" districtId = "' + d[c].district + '">' + l + "&nbsp;" + k + "</dd>");
        e.push(j);
        e.push(l);
        e.push(d[c].districtName);
        commonAddress[d[c].id] = e
    }
    $("#in_common_use_address").html(f.join(""));
    $("#in_common_use_address").find("dd").bind("click", ec.product.selectedAddress)
};
ec.product.queryTips = function (a, b) {
    $("#deatilAddress").html(addressInfoMap[a]);
    $("#deatilAddress").css("position", "absolute");
    $("#deatilAddress").css("z-index", "9999");
    $("#deatilAddress").css("top", (parseInt(b.position().top) + b.innerHeight() + 12) + "px");
    $("#deatilAddress").css("display", "block");
    $("#deatilAddress").show()
};
ec.product.queryProvince = function (f, g, h) {
    var c;
    if (g == 1) {
        c = f.data[0]
    } else {
        c = f.data
    }
    var e = [];
    var a = c.length;
    e.push('<table style="min-height=180px;" width="100%" border="0" cellpadding="0" cellspacing="0">');
    e.push("<tbody>");
    var d = 0;
    for (var b = 0; b < a; b++) {
        if (d == 0) {
            e.push("<tr>")
        }
        var j = ec.product.replaceChar(c[b].name);
        e.push('<td id="' + c[b].id + '" addrType="' + g + '">' + j + "</td>");
        d = d + 1;
        if (d == 4 || b == a - 1) {
            d = 0;
            e.push("</tr>")
        }
    }
    e.push("</tbody>");
    e.push("</table>");
    $("#address_table").css({"min-height": "180px"}).html(e.join(""));
    $("#address_table").find("td").bind("click", ec.product.changeAddress);
    $("#address_table").show();
    if (ec.account.isLogin()) {
        ec.addr.list(ec.product.userAddress)
    }
};
ec.product.queryData = function (a, c, d, e) {
    var b;
    if (c && (b = cache[a])) {
        return e(b, d)
    }
    if (ajaxer) {
        ajaxer.abort()
    }
    ajaxer = $.ajax({
        url: a, type: "get", dataType: "jsonp", success: function (f) {
            if (c) {
                cache[a] = f
            }
            e(f, d)
        }, error: function (g, f) {
            logger.warn("load data fail.")
        }
    })
};
var isSucTemp = false;
ec.product.processExpectDelivery = function (i) {
    address = [];
    skuAddress = i;
    var e = true;
    if (ec.product.status == 3) {
        ec.product.hiddenTips();
        e = false
    }
    if (ec.product.seCode != ec.product.productSeCode || parseInt(ec.product.productType) != 0) {
        ec.product.hiddenTips();
        e = false
    }
    var j = skuAddress.buttonMode;
    if (parseInt(j) != 1 && parseInt(j) != 10) {
        ec.product.hiddenTips();
        e = false
    }
    if (parseInt(j) == 11 || parseInt(j) == 16) {
        ec.product.hiddenTips();
        return
    }
    if (parseInt(j) == 10) {
        var f = ec.product.getSysDate();
        var g = ec.product.getSkuInfo(skuAddress.id || ec.product.defaultSku).endTime;
        var h = new Date();
        if (null == g || "" == g) {
            h = new Date(2999, 1, 1, 0, 0, 0)
        } else {
            h.setTime(g.parseDate("yyyy-MM-dd HH:mm:ss"))
        }
        if ((f - h) > 0) {
            ec.product.hiddenTips();
            e = false
        }
    }
    if (ec.product.isSupportDisTime == "0") {
        e = false
    }
    if (!e) {
        var d = $.parseJSON(ec.product.deliveryArrival);
        if (d != undefined && d != "") {
            ec.product.processPreDeliveryAndArrivalTime(d[skuAddress.id], false)
        } else {
            ec.prescription.queryPreDeliveryAndArrival(ec.product.processPreDeliveryAndArrivalTime, null, null, null, i.code)
        }
        return
    }
    isSucTemp = true;
    var c = ec.util.cookie.get("selectedAddress");
    if (c == null) {
        if (ec.account.isLogin()) {
            ec.product.getUserDefaultAddress()
        } else {
            ec.product.parseCookie()
        }
    } else {
        var b = c.split("|");
        if (b.length == 3) {
            var a = b[2];
            ec.product.queryData(ec.product.parseUrl(tree_url, a), true, 1, ec.product.getCitydistrict)
        }
    }
};
ec.product.processSupportDisplayDilieryTime = function (a) {
    sbomCode = a.code;
    ec.product.processExpectDelivery(a)
};
ec.product.parseCookie = function () {
    var b = ec.util.cookie.get("ipaddress");
    if (b != null) {
        var e = b.split(",");
        var a = [];
        for (var d = 0; d < 3; d++) {
            a[d] = e[d]
        }
        ec.product.showAddress(a);
        var c = skuAddress.price;
        ec.prescription.queryPreDeliveryAndArrival(ec.product.processPreDeliveryAndArrivalTime, e[3], c, "-1", sbomCode)
    } else {
        ec.product.getUserAddressByIP(ec.product.addressCall)
    }
};
ec.product.getCitydistrict = function (g) {
    address = [];
    var l = g.values;
    var b = g.data[0];
    for (var e = 0; e < b.length; e++) {
        var k = b[e];
        if (k.id == l[0]) {
            address.push(k.name)
        }
    }
    var d = g.data[1];
    for (var e = 0; e < d.length; e++) {
        var k = d[e];
        if (k.id == l[1]) {
            address.push(k.name)
        }
    }
    var j = g.data[2];
    for (var e = 0; e < j.length; e++) {
        var k = j[e];
        if (k.id == l[2]) {
            address.push(k.name)
        }
    }
    var h = l[2];
    if ($.trim(h) == "") {
        ec.product.hiddenTips();
        return
    }
    ec.product.showAddress(address);
    var f = skuAddress.price;
    var a = ec.util.cookie.get("selectedAddress");
    if (a == null) {
        var c = $.parseJSON(ec.product.deliveryArrival);
        if (c != undefined && c != "") {
            ec.product.processPreDeliveryAndArrivalTime(c[skuAddress.id], false)
        }
    } else {
        ec.prescription.queryPreDeliveryAndArrival(ec.product.processPreDeliveryAndArrivalTime, h, f, null, sbomCode)
    }
};
ec.product.addressCall = function (a) {
    var b = [];
    ipAddress = [];
    ipAddressCookie = [];
    if (a != null && a != undefined && a.success && (a.address.province != null && a.address.province != "null" && $.trim(a.address.province) != "")) {
        b.push(a.address.province);
        ipAddress.push(a.address.province);
        if (a.address.city == "null" || a.address.city == null || $.trim(a.address.city) == "") {
            b.push(null);
            ec.product.getAddressId(b, ec.product.queryAddressByName)
        } else {
            if (a.address.district == "null" || a.address.district == null || $.trim(a.address.district) == "") {
                b.push(a.address.city);
                ipAddress.push(a.address.city);
                b.push(null);
                ec.product.getAddressId(b, ec.product.queryAddressByName)
            } else {
                b.push(a.address.city);
                b.push(a.address.district);
                address = b;
                ipAddressCookie[0] = b;
                ec.product.getAddressId(address, ec.product.setIpCookie)
            }
        }
    } else {
        address = _defaultAddress;
        ec.product.getAddressId(address, ec.product.getAddressIdCallBack)
    }
};
ec.product.queryAddressByName = function (b, f) {
    var a = [];
    var d = b.provinceId;
    var e = b.cityId;
    var c = b.districtId;
    if ((e != null && e != "") && (c == null || c == "")) {
        ec.product.queryData(ec.product.parseUrl(children_url, parseInt(e)), true, 2, ec.product.queryCitydistrict)
    } else {
        ec.product.queryData(ec.product.parseUrl(children_url, parseInt(d)), true, 1, ec.product.queryCitydistrict)
    }
};
ec.product.queryCitydistrict = function (a, c) {
    var b = a.data;
    if (b == null || $.trim(b) == "" || b == undefined) {
        address = _defaultAddress;
        ec.product.getAddressId(_defaultAddress, ec.product.getAddressIdCallBack)
    } else {
        var d = b[0].id;
        ipAddress.push(b[0].name);
        if (parseInt(c) == 1) {
            ec.product.queryData(ec.product.parseUrl(children_url, parseInt(d)), true, 2, ec.product.queryCitydistrict)
        } else {
            address = ipAddress;
            ipAddressCookie.push(ipAddress);
            ec.product.getAddressId(ipAddress, ec.product.setIpCookie)
        }
    }
};
ec.product.saveIPAddressToCookie = function (a) {
    ec.util.cookie.set("ipaddress", a, {expires: 1 / 12, domain: "vmall.com"})
};
ec.product.setIpCookie = function (b) {
    var a = b.districtId;
    ipAddressCookie.push(a);
    ec.product.saveIPAddressToCookie(ipAddressCookie);
    ec.product.getAddressIdCallBack(b)
};
ec.product.getUserDefaultAddress = function () {
    var d = "13232376895198612407547930718267435757728527029623408872245156039757713029036368719146452186041204237350521785240337048752071462798273003935646236777459223";
    var e = "5421644057436475141609648488325705128047428394380474376834667300766108262613900542681289080713724597310673074119355136085795982097390670890367185141189796";
    var a = ec.encipher.randomInt(128);
    var f = ec.encipher.bigPowMod(e, a, d);
    var c = [];
    $.ajax({
        type: "get",
        url: domainShoppingConfig + "/address/getDefault.json?t=" + new Date().getTime(),
        dataType: "json",
        timeout: _defaultTimeOut,
        async: false,
        beforeSend: function (b) {
            b.withCredentials = true
        },
        success: function (b) {
            if (!b.success || b.shoppingConfg == null || b.shoppingConfg == "") {
                ec.product.parseCookie();
                return
            }
            ec.util.cookie.set("sc_p", b.pubkey);
            var g = ec.lang.json.parse(b);
            g = b.shoppingConfg;
            c.push(g.provinceName);
            c.push(g.cityName);
            c.push(g.districtName);
            if (c == null || c.length == 0) {
                ec.product.parseCookie()
            } else {
                address = c;
                ec.product.getAddressId(address, ec.product.getAddressIdCallBack)
            }
        },
        error: function () {
            address = _defaultAddress;
            ec.product.getAddressId(_defaultAddress, ec.product.getAddressIdCallBack)
        }
    })
};
ec.product.showSupportDisplayDilieryTime = function (e, d) {
    var b = "";
    if (!d) {
        if (e.length) {
            var a = e.deliveryTime;
            var c = ec.product.getEffectivenessTime(a);
            b = "23:00前完成支付，预计" + c + "送达"
        }
    }
    $("#pro-predict").find("span:first").html(b);
    ec.product.showTips();
    if (d) {
        $("#order_confirm_tips").hide()
    }
};
ec.product.getUserAddressByIP = function (a) {
    $.ajax({
        url: "/ip/location.json",
        type: "get",
        dataType: "jsonp",
        jsonpCallback: "callback",
        timeout: _defaultTimeOut,
        success: function (b) {
            if (b.success) {
                a(b)
            } else {
                address = _defaultAddress;
                ec.product.getAddressId(address, ec.product.getAddressIdCallBack)
            }
        },
        error: function () {
            address = _defaultAddress;
            ec.product.getAddressId(address, ec.product.getAddressIdCallBack)
        }
    })
};
ec.product.getAddressIdCallBack = function (c) {
    var a = c.districtId;
    if ($.trim(a) == "") {
        ec.product.hiddenTips();
        return
    }
    ec.product.showAddress(address);
    var b = skuAddress.price;
    ec.prescription.queryPreDeliveryAndArrival(ec.product.processPreDeliveryAndArrivalTime, a, b, null, sbomCode)
};
ec.product.getAddressId = function (a, b) {
    $.ajax({
        url: domainShoppingConfig + "/matchRegion.json",
        type: "get",
        dataType: "jsonp",
        data: {provinceName: a[0], cityName: a[1], districtName: a[2]},
        jsonpCallback: "addressCallback",
        timeout: _defaultTimeOut,
        success: function (c) {
            if (c.success) {
                b(c)
            } else {
                a = _defaultAddress;
                ec.product.getAddressId(_defaultAddress, ec.product.getAddressIdCallBack)
            }
        },
        error: function () {
            a = _defaultAddress;
            ec.product.getAddressId(_defaultAddress, ec.product.getAddressIdCallBack)
        }
    })
};
ec.product.showAddress = function (a) {
    $("#address").find("a").html(a[0] + "&nbsp;&gt;&nbsp;" + a[1] + "&nbsp;&gt;&nbsp;" + ec.product.replaceChar(a[2]))
};
ec.product.hiddenTips = function () {
    $("#product-pulldown1").addClass("product-description");
    $("#pro-predict").hide()
};
ec.product.showTips = function () {
    $("#product-pulldown1").removeClass("product-description");
    $("#pro-predict").show()
};
ec.product.showExpectTime = function (a) {
    $("#product-pulldown1").removeClass("product-description");
    if (a == 1) {
        $("#address").parent().hide()
    } else {
        if ($("#address").find("a").html().length > 1) {
            $("#address").parent().show()
        } else {
            $("#address").parent().hide()
        }
    }
    $("#pro-predict").show()
};
ec.product.getEffectivenessTime = function (b, c) {
    var f;
    var e = ec.product.getSysDate();
    var h = e.getHours();
    var d = e.getTime();
    var g = new Date();
    g.setTime(d);
    c = c.substring(0, 2);
    if (h >= 0 && h < c) {
        g.setHours(parseInt(c) + b)
    } else {
        g.setHours(parseInt(c) + b)
    }
    var a = (parseInt(g.getMonth()) + 1) + "月" + g.getDate() + "日（" + ec.product.getWeekByTime(g) + "）";
    return a
};
ec.product.getWeekByTime = function (a) {
    var c = a.getDay();
    var e = "";
    switch (c) {
        case 0:
            e = "周日";
            break;
        case 1:
            e = "周一";
            break;
        case 2:
            e = "周二";
            break;
        case 3:
            e = "周三";
            break;
        case 4:
            e = "周四";
            break;
        case 5:
            e = "周五";
            break;
        case 6:
            e = "周六";
            break
    }
    var d = new Date();
    var b = d.diff(a);
    if (b == 0) {
        e = "今天"
    }
    if (b == 1) {
        e = "明天"
    }
    return e
};
Date.prototype.diff = function (a) {
    return Math.floor((a.getTime() - new Date(new Date().setHours(0, 0, 0, 0)).getTime()) / (24 * 60 * 60 * 1000))
};
ec.product.replaceChar = function (a) {
    if (a != null && a != "" && a == "-") {
        return "其它地区"
    } else {
        return a
    }
};
ec.product.processPreDeliveryAndArrivalTime = function (m, c) {
    var k = false;
    var h = null, i = 0;
    var g = skuAddress.buttonMode;
    var l = ec.product.inventory.haveInventory(skuAddress.id);
    if (!c) {
        if (m && m.success) {
            var b = m.info;
            if (b.shippingDate && b.shippingDate.length > 0) {
                if (((g == 1) && (!l))) {
                    k = true
                } else {
                    i = 1;
                    h = b.shippingDate;
                    $(".product-address-prompt").find("em").eq(0).show();
                    $("#expectTimeDesc").html("订单按照支付顺序发货，预计发货时间在支付全部完成前可能变更；预计发货时间根据商品库存信息计算得出，受诸多因素影响可能会产生偏差，我们会为您积极备货。")
                }
            } else {
                if (b.estimatedArrivalTime != null && b.estimatedArrivalTime != "") {
                    i = 2;
                    var a = "";
                    var f = "";
                    var j = b.estimatedArrivalTime;
                    if (m.beforeAndAfterFlag == "1") {
                        a = j.earlyArrivalTime;
                        f = "今天"
                    } else {
                        a = j.lateArrivalTime;
                        f = "明天"
                    }
                    var e = ec.product.getEffectivenessTime(a, j.deadlineTime);
                    h = "<span class='red'>现货</span>，" + f + j.deadlineTime + "前付款，预计" + e + "送达";
                    $(".product-address-prompt").find("em").eq(0).show();
                    $("#expectTimeDesc").html("”预计送达时间”功能处于试运营，可能会略有偏差，最终以实际到货时间为准，如有疑问请您联系商城客服。感谢您对华为商城的支持和理解！")
                }
            }
            if (h != null) {
                $("#pro-predict").find("span:first").html(h);
                ec.product.showTips();
                ec.product.showExpectTime(i)
            } else {
                if (k) {
                    ec.product.hiddenTips()
                }
                if (b.arrivalTimeStatus == "1") {
                    ec.product.hiddenTips()
                }
                if (b.arrivalTimeStatus == "2") {
                    if (isSucTemp) {
                        $("#address").parent().show();
                        ec.product.showTips();
                        $("#pro-predict").find("span:first").html("<span class='red'>现货</span>");
                        $(".product-address-prompt").find("em").eq(0).hide()
                    } else {
                        ec.product.hiddenTips()
                    }
                }
            }
            ec.product.deliveryArrival = "";
            var d = ec.product.getSkuInfo(ec.product.getSku());
            if ((b.shippingDate == null || b.shippingDate == "") && b.estimatedArrivalTime != null && b.estimatedArrivalTime != "") {
                if (ec.product.productType == 4 || parseInt(d.buttonMode) == 8) {
                    ec.product.hiddenTips()
                }
            }
        } else {
            ec.product.hiddenTips()
        }
    }
};
ec.pkg("ec.product.gift");
ec.product.gift = {
    proGiftChosenImgSrc: "",
    proGiftChosenImgAlt: "",
    proGiftGallerys: [],
    giftTrees: [],
    data: "",
    giftArrays: {},
    defaultGift: [],
    mainSkuGiftMap: {},
    mainSkuGiftKeyMap: {},
    defaultGiftMap: {},
    finalMainSbomGiftMap: {},
    packageGiftMap: {},
    tempMainSbomGiftMap: {},
    isChange: "true",
    picMediaServer: ec.mediaPath,
    sku: "",
    middleImgSize: "55_55_",
    navImgSize: "55_55_",
    ITEM_WIDTH: 52,
    isChange: false,
    popupHtml: function () {
        var e = [], f = [], b = 0, a = 0;
        var k = "";
        var h = ec.product.getSku();
        defaultGift = this.defaultGiftMap[h];
        multiGiftVO = this.mainSkuGiftMap[h];
        multiGiftVOKeys = this.mainSkuGiftKeyMap[h];
        finalGift = this.finalMainSbomGiftMap[h] || {};
        giftSize = multiGiftVOKeys.length;
        var j = [], g = [];
        for (var d = 0; d < giftSize; d++) {
            var c = multiGiftVO[multiGiftVOKeys[d]];
            if (multiGiftVOKeys[d].indexOf("_") < 0) {
                if (d > 0) {
                    f.push(this.renderSingleGift(g, j));
                    j = [];
                    g = []
                }
                j.push(c);
                g.push(multiGiftVOKeys[d])
            }
            if ((multiGiftVOKeys[d].indexOf("_") > 0 && d > 0)) {
                j.push(c);
                g.push(multiGiftVOKeys[d])
            }
            if (d == (giftSize - 1)) {
                f.push(this.renderSingleGift(g, j));
                j = [];
                g = []
            }
        }
        e.push(f.join(" "));
        return e.join(" ")
    },
    renderSingleGift: function (d, c) {
        var a = c.length;
        defaultGift = c[0];
        finalGift = this.finalMainSbomGiftMap[this.sku];
        choseGift = finalGift[d[0]];
        if (d.length != c.length) {
        }
        html = [];
        if (choseGift != null && choseGift != "") {
            html.push('<div class="product-partscolor-layer">');
            html.push('<div class="product-partscolor-detail clearfix"> ');
            html.push('<a id="gift-detail-' + d[0] + '"   href="/product/' + choseGift.giftId + ".html#" + choseGift.giftSkuId + '" target="_blank">');
            html.push('<img class="product-partscolor-detailimg" src="' + ec.mediaPath + choseGift.photoPath + this.middleImgSize + choseGift.photoName + '">');
            html.push("</a>");
            html.push('<div class="product-partscolor-list"> ');
            html.push('<h2 id="gift-detail-name' + d[0] + '">' + choseGift.giftName + "</h2>");
            html.push('<ul class="clearfix">');
            for (var b = 0; b < a; b++) {
                if (choseGift.giftSkuId == c[b].giftSkuId) {
                    html.push('<li class="selected h">')
                } else {
                    html.push('<li class="h">')
                }
                html.push('<a href="javascript:;" key="' + d[b] + '" defaultGiftKey="' + d[0] + '" title="' + c[b].giftAttrVal + '">');
                html.push('<img src="' + ec.mediaPath + c[b].photoPath + this.navImgSize + c[b].photoName + '">');
                html.push("<p><span>" + c[b].giftAttrVal + "</span></p>");
                html.push('<input name= "box-value" type="hidden"  choseGiftKey="' + d[b] + '" defaultGiftKey= "' + d[0] + '"/>');
                html.push("</a>");
                html.push("</li>")
            }
            html.push("</ul>");
            html.push("</div>");
            html.push("</div> ");
            html.push("</div> ")
        }
        return html.join(" ")
    },
    ftl: function (e) {
        this.sku = ec.product.getSku();
        var c = [];
        var b = this.defaultGiftMap[e];
        var d = this.mainSkuGiftMap[e];
        var a = this.finalMainSbomGiftMap[e] || {};
        for (var f = 0; f < b.length; f++) {
            var g = d[b[f]];
            if (g) {
                a[g.giftId] = g;
                c.push('<a id="gift-' + g.giftId + '"  href="/product/' + g.giftId + ".html#" + g.giftSkuId + '" target="_blank" title="' + g.giftName + '">');
                c.push('<img src="' + ec.mediaPath + g.photoPath + this.navImgSize + g.photoName + '" alt="' + g.giftName + '"></a>')
            }
        }
        this.finalMainSbomGiftMap[e] = a;
        $("#pro-gift-list-detail").html(this.popupHtml());
        return c.join("")
    },
    init: function (j, k) {
        if (!k && !j) {
            return
        }
        var b = {};
        var d = [];
        var c = [];
        this.giftArrays = k;
        var e = [];
        var h = 0, a = 0;
        for (var g = 0; g < k.length; g++) {
            if (k[g].displayType == 1) {
                var f = b[k[g].giftId];
                if (!f) {
                    c.push(k[g].giftId);
                    b[k[g].giftId] = k[g];
                    d.push(k[g].giftId);
                    ++a
                } else {
                    b[k[g].giftId + "_" + h] = k[g];
                    d.push(k[g].giftId + "_" + h);
                    h++
                }
            }
        }
        this.mainSkuGiftMap[j] = b;
        this.mainSkuGiftKeyMap[j] = d;
        this.defaultGiftMap[j] = c
    },
    cloneObj: function (c) {
        var d, b = c.constructor === Array ? [] : {};
        if (typeof c !== "object") {
            return
        } else {
            if (window.JSON) {
                d = JSON.stringify(c), b = JSON.parse(d)
            } else {
                for (var a in c) {
                    b[a] = typeof c[a] === "object" ? cloneObj(c[a]) : c[a]
                }
            }
        }
        return b
    },
    getGiftsSize: function () {
        var c = ec.product.getSku(), a = 0;
        multiGiftVOKeys = this.mainSkuGiftKeyMap[c];
        giftSize = multiGiftVOKeys.length;
        for (var b = 0; b < giftSize; b++) {
            if ((multiGiftVOKeys[b].indexOf("_") < 0)) {
                ++a
            }
        }
        return a
    },
    showGiftPackageView: function (d, f) {
        if ($(d).parent().parent().hasClass("selected")) {
            if ($("#giftPackageList").hasClass("hide") && $("#giftPackageList").html() != "" && f) {
                $("#giftPackageList").removeClass("hide");
                $(d).parent().parent().addClass("click");
                if ($("#product-operation").css("display") != "none") {
                    $("#minButtom").html($("#pro-operation").html())
                }
                $("#minButtom").find("a").addClass("product-package-mini-btn");
                $("#minButtom").find(".product-time").remove();
                $("#minButtom").find(".product-button-tips").remove();
                $("#minButtom").find(".product-button-priority").remove();
                return
            }
        }
        var b = [];
        var c = [];
        var j = ec.product.getSku();
        var k = ec.product.getSkuInfo(j);
        var l = k.giftList;
        var g = [];
        for (var e = 0; e < l.length; e++) {
            if (l[e].displayType == 2) {
                g.push(l[e])
            }
        }
        var h = "gift";
        if (g != null && g.length > 0) {
            b.push('<div class="product-recommend product-package-mini">');
            b.push('<div class="product-recommend-con clearfix">');
            b.push('<div class="product-recommend-main">');
            b.push('<div class="product-recommend-thumbs">');
            b.push('<ul class="clearfix">');
            b.push('<li> <a sku-id="' + k.id + '"> <img src="' + ec.mediaPath + k.photoPath + "100_100_" + k.photoName + '">');
            b.push('<p title="' + k.name + '">' + k.name + "</p>");
            b.push("</a></li></ul></div></div>");
            b.push('<div class="goods-rolling product-recommend-detail">');
            b.push('<div id="btn-prev-gift" class="grid-btn btn-prev disabled">');
            b.push("<span></span></div>");
            b.push('<div id="btn-next-gift" class="grid-btn btn-next"><span></span></div>');
            b.push('<div id="goodsRecommend-recommend-gift" class="swiper-container product-recommend-thumbs">');
            b.push('<ul class=" swiper-wrapper clearfix" style="width: 1000px;">');
            for (var e = 0; e < g.length; e++) {
                if (g[e].displayType == 2) {
                    c.push('<li class="swiper-slide" attr-packageSkuCode="' + g[e].giftSkuCode + '"><a href="/product/' + g[e].giftId + ".html#" + g[e].giftSkuId + '" target="_blank"><img src="' + ec.mediaPath + g[e].photoPath + "100_100_" + g[e].photoName + '">');
                    c.push('<p title="' + g[e].giftName + '">' + g[e].giftName + "</p></a>");
                    c.push('<dl class="color clearfix">');
                    c.push('<dd><a href="javascript:;" onclick="ec.product.packageChangeColor(this,\'' + h + '\')" attr-name="' + g[e].giftName + '"interest-skuid="' + g[e].giftSkuId + '" attr-imgSrc="' + ec.mediaPath + g[e].photoPath + "100_100_" + g[e].photoName + '" attr-prdId="' + g[e].giftId + '" attr-packageskuCode="' + g[e].giftSkuCode + '">' + g[e].giftAttrVal + "</a></dd>");
                    if (e != g.length - 1) {
                        var m = e;
                        for (var a = 1; a < (g.length - m); a++) {
                            if (g[m].giftId == g[m + a].giftId) {
                                c.push('<dd><a href="javascript:;" onclick="ec.product.packageChangeColor(this,\'' + h + '\')" attr-name="' + g[(m + a)].giftName + '"interest-skuid="' + g[e].giftSkuId + '" attr-imgSrc="' + ec.mediaPath + g[m + a].photoPath + "100_100_" + g[m + a].photoName + '" attr-prdId="' + g[(m + a)].giftId + '" attr-packageskuCode="' + g[(m + a)].giftSkuCode + '">' + g[(m + a)].giftAttrVal + "</a></dd>");
                                e = m + a
                            }
                        }
                    }
                    c.push("</dl></li>")
                }
            }
            if (c != [] && c.length > 0) {
                if (f) {
                    ec.product.packageViewChange(d, "", "gift")
                } else {
                    $(d).parent().parent().removeClass("click");
                    $("#giftPackageList").addClass("hide")
                }
                b.push(c.join(""));
                b.push("</ul></div></div></div>");
                b.push('<div class="product-package-mini-tool clearfix" id="giftPackageButton">');
                b.push('<p><span class="f14">\u5957\u9910\u4ef7\uff1a</span><strong class="red">');
                if (k.price && k.price > 0) {
                    b.push("\uffe5" + k.price)
                } else {
                    b.push("\u6682\u65e0\u62a5\u4ef7")
                }
                b.push('</strong><span class="save"></span></p><div class="fr" id="minButtom">');
                if ($("#product-operation").css("display") != "none") {
                    b.push($("#pro-operation").html())
                }
                b.push("</div></div></div>");
                $("#giftPackageList").html(b.join(""));
                $("#goodsRecommend-recommend-gift").find("li").each(function () {
                    $(this).find("dd").first().addClass("selected")
                });
                $("#minButtom").find("a").addClass("product-package-mini-btn");
                $("#minButtom").find(".product-time").remove();
                $("#minButtom").find(".product-button-tips").remove();
                $("#minButtom").find(".product-button-priority").remove();
                ec.product.packageGetSkuCode("gift");
                if ($("#pro-price").html() != "" && $("#giftPackageList").html() != null) {
                    if ("\u6682\u65e0\u62a5\u4ef7" !== $("#pro-price").text()) {
                        $("#pro-price-label").html("\u5957\u9910\u4ef7");
                        $("#pro-price-label").removeClass("f24").addClass("type")
                    }
                    $("#pro-price-label").show()
                }
                ec.product.newPackageSwiper("-gift")
            }
        } else {
            $("#bundlePackageSelect").find("li").removeClass("click")
        }
    },
    updateOperationBtns: function () {
        $("#minButtom").html($("#pro-operation").html());
        $("#minButtom").find("a").addClass("product-package-mini-btn");
        $("#minButtom").find(".product-time").remove();
        $("#minButtom").find(".product-button-tips").remove();
        $("#minButtom").find(".product-button-priority").remove()
    }
};
ec.pkg("ec.product.interest");
ec.product.interest.queryFreeDetail = function (c) {
    skuForInterest = ec.product.getSku();
    if (skuForInterest.priceMode == 2) {
        return
    }
    if ($("#prd-noInterset").attr("interest-allow") != "1") {
        return
    }
    var h = 0;
    var m = "";
    m += $("#pro-sku-code2").text() + "|";
    var d = $("#pro-price").text();
    d = parseFloat(d.substring(1, d.length));
    if (!d > 0) {
        return
    }
    h += d;
    var f = ($("#packageListCode").val()).split(",");
    for (var g = 0; g < f.length; g++) {
        if (f[g] != "") {
            m += f[g] + "|"
        }
    }
    var l = ec.product.gift.packageGiftMap[ec.product.getSku()];
    if (l != null) {
        for (var g = 0; g < l.length; g++) {
            m += l[g] + "|"
        }
    }
    var k = $("#extendSelect").attr("data-scode");
    var b = $("#extendSelect").attr("interest-price");
    var e = $("#accidentSelect").attr("data-scode");
    var n = $("#accidentSelect").attr("interest-price");
    var j = $("#giftBuy_dl").children(".product-choose-detail ").children().children("li.selected").find("a").attr("data-code");
    var a = $("#giftBuy_dl").children(".product-choose-detail ").children().children("li.selected").find("a").attr("interest-price");
    if (k != null && b != null && k != "") {
        m += k + "|";
        h += parseFloat(b)
    }
    if (e != null && n != null && e != "") {
        m += e + "|";
        h += parseFloat(n)
    }
    if (j != null && a != null && j != null) {
        m += j + "|";
        a = a.substring(1, a.length);
        h += parseFloat(a)
    }
    if (h > 0 && (m != null && m != "")) {
        h = h + ""
    } else {
        return
    }
    $.ajax({
        url: "/product/queryInterest.json",
        dataType: "json",
        timeout: 10000,
        data: {price: h, skuList: m},
        timeoutFunction: function () {
            if (!$("#prd-noInterset").hasClass("hide")) {
                $("#prd-noInterset").addClass("hide")
            }
            $("#hbDetail").find("ul").html("");
            $("#hlDetail").find("ul").html("");
            $("#interestOrderNow").val("");
            $("#interestOrderNow2").val("");
            return
        },
        success: function (i) {
            if (!i.success) {
                if (!$("#prd-noInterset").hasClass("hide")) {
                    $("#prd-noInterset").addClass("hide")
                }
                $("#hbDetail").find("ul").html("");
                $("#hlDetail").find("ul").html("");
                $("#interestOrderNow").val("");
                $("#interestOrderNow2").val("");
                return
            }
            ec.product.interest.queryFreeDetailJsonShow(i);
            ec.product.refreshStyle()
        },
        error: function () {
            if (!$("#prd-noInterset").hasClass("hide")) {
                $("#prd-noInterset").addClass("hide")
            }
            $("#hbDetail").find("ul").html("");
            $("#hlDetail").find("ul").html("");
            $("#interestOrderNow").val("");
            $("#interestOrderNow2").val("");
            return
        }
    })
};
ec.product.interest.queryFreeDetailJsonShow = function (f) {
    if (f.hbNoINterestList.length > 0 || f.hlNoINterestList.length > 0) {
        var d = [];
        var a = [];
        if (!$("#interestHBPayNow").hasClass("disabled")) {
            $("#interestHBPayNow").addClass("disabled")
        }
        if (!$("#interestPayHLNow").hasClass("disabled")) {
            $("#interestPayHLNow").addClass("disabled")
        }
        $("#hbDetail").hide();
        $("#hlDetail").hide();
        $("#prd-noInterset").removeClass("hide");
        $("#hbShow").hide();
        $("#hlShow").hide();
        $("#interestOrderNow").val("");
        $("#interestOrderNow2").val("");
        if (f.hbNoINterestList.length > 0) {
            $("#hbShow").show();
            var e = [];
            for (var c = 0; c < f.hbNoINterestList.length; c++) {
                e.push('<li><a href="javascript:;" onclick="ec.product.interest.checkOne(this);" interest-info="1:' + f.hbNoINterestList[c].num + '">');
                e.push('<p class="price">&yen;&nbsp;' + f.hbNoINterestList[c].amount + "<em>x</em>" + f.hbNoINterestList[c].num + "\u671f</p>");
                if (f.hbNoINterestList[c].installmentFlag == 0) {
                    e.push("<p>\u624b\u7eed\u8d39&yen;" + f.hbNoINterestList[c].fee + "/\u671f</p></a></li>")
                } else {
                    e.push('<p class="red">\u514d\u606f\uff0c0\u624b\u7eed\u8d39</p>')
                }
            }
            $("#hbDetail").find("ul").html(e.join(""));
            $("#hbShow").find(".sku").unbind("mouseover");
            $("#hbShow").unbind("mouseleave");
            $("#hbShow").find(".sku").mouseover(function () {
                $("#hbDetail").show();
                $("#hbShow").addClass("click")
            });
            $("#hbShow").mouseleave(function () {
                $("#hbDetail").hide();
                $("#hbShow").removeClass("click")
            })
        } else {
            $("#hbShow").hide();
            $("#hbDetail").hide()
        }
        if (f.hlNoINterestList.length > 0) {
            $("#hlShow").show();
            var b = [];
            for (var c = 0; c < f.hlNoINterestList.length; c++) {
                b.push('<li><a href="javascript:;" onclick="ec.product.interest.checkOne(this);" interest-info="2:' + f.hlNoINterestList[c].num + '">');
                b.push('<p class="price">&yen;&nbsp;' + f.hlNoINterestList[c].amount + "<em>x</em>" + f.hlNoINterestList[c].num + "\u671f</p>");
                if (f.hlNoINterestList[c].installmentFlag == 0) {
                    b.push("<p>\u624b\u7eed\u8d39&yen;" + f.hlNoINterestList[c].fee + "/\u671f</p></a></li>")
                } else {
                    b.push('<p class="red">\u514d\u606f\uff0c0\u624b\u7eed\u8d39</p>')
                }
            }
            $("#hlDetail").find("ul").html(b.join(""));
            $("#hlShow").find(".sku").unbind("mouseover");
            $("#hlShow").unbind("mouseleave");
            $("#hlShow").find(".sku").mouseover(function () {
                if (!$("#hlShow").hasClass("click")) {
                    $("#hlDetail").show();
                    $("#hlShow").addClass("click")
                }
            });
            $("#hlShow").mouseleave(function () {
                $("#hlDetail").hide();
                $("#hlShow").removeClass("click")
            })
        } else {
            $("#hlShow").hide();
            $("#hlDeatil").hide()
        }
        if ($("#prd-noInterset").attr("interest-button") == "0") {
            $("#interestHBPayNow").each(function () {
                $(this).addClass("disabled");
                this.backup = this.onclick;
                this.onclick = ""
            });
            $("#interestPayHLNow").each(function () {
                $(this).addClass("disabled");
                this.backup = this.onclick;
                this.onclick = ""
            })
        }
    }
};
ec.product.interest.checkOne = function (a) {
    if ($(a).parent().hasClass("selected")) {
        $(a).parent().siblings().removeClass("selected");
        $(a).parent().removeClass("selected");
        $("#interestOrderNow").val("");
        if (!$(a).parents(".product-stages-con").siblings(".product-package-mini-tool").find("a").hasClass("disabled")) {
            $(a).parents(".product-stages-con").siblings(".product-package-mini-tool").find("a").addClass("disabled")
        }
        return
    } else {
        $(a).parent().siblings().removeClass("selected");
        $(a).parent().addClass("selected");
        $("#interestOrderNow").val($(a).attr("interest-info"));
        $(a).parents(".product-stages-con").siblings(".product-package-mini-tool").find("a").removeClass("disabled")
    }
};
ec.product.interest.payByInterest = function (c) {
    var f = "HB";
    if (c == 2) {
        f = "HL";
        if ($("#interestPayHLNow").hasClass("disabled")) {
            return
        }
    } else {
        if ($("#interestHBPayNow").hasClass("disabled")) {
            return
        }
    }
    var b = [];
    b = $("#interestOrderNow").val().split(":");
    var e = "";
    if (b[0] != null && b[0] != "") {
        if (b[0] == "1") {
            e = "\u82b1\u5457\u5206\u671f"
        } else {
            if (b[0] == "2") {
                e = "\u638c\u4e0a\u751f\u6d3b\u5206\u671f"
            }
        }
    } else {
        alert("\u8bf7\u9009\u62e9\u5206\u671f");
        return
    }
    var d = {
        UID: ec.util.cookie.get("uid"),
        TID: getPtid(),
        TIME: getTime(),
        CONTENT: {SKUCode: $("#pro-sku-code2").html(), name: e, number: b[1], click: "1"}
    };
    ec.account.dapPushMsg("300021001", d, "click");
    var a = "";
    if (c == 2) {
        a = $("#hlDetail").find("ul").children("li").attr("interest-info")
    } else {
        a = $("#hbDetail").find("ul").children("li").attr("interest-info")
    }
    ec.product.orderNow("2", f)
};
ec.pkg("deposit");
ec.product.depositInfo = {};
ec.product.depositInit = function (a) {
    if (ec.product.runningSkuId != a) {
        return
    }
    ec.product.depositInfo = {};
    if ($("#product-deposit-agreement-area")) {
        $("#product-deposit-agreement-area").hide()
    }
    $("#pro-quantity-area").hide();
    $("#pro-quantity-area-nochange").hide();
    $("#pro-operation").css("visibility", "hidden");
    $("#buyProcessIDD").hide();
    $("#pro-price-label-deposit").html("\u8ba2\u91d1");
    $("#pro-price-label-deposit").show();
    $("#pro-price-deposit").html("\u6682\u65e0\u62a5\u4ef7");
    $("#pro-price-old").html("");
    $("#pro-price-deposit").show();
    $("#pro-price-old").hide();
    $("#pro-operation").css("visibility", "hidden");
    $("#tab-notice-button").hide();
    $("#tab-addcart-button").hide()
};
ec.product.isDespositSku = 0;
ec.product.runningSkuId = 0;
deposit.business = {
    offsetTime: 0, setOffsetTime: function (b, a) {
        deposit.business.offsetTime = a - b
    }, getSysDate: function () {
        return new Date(new Date().getTime() + deposit.business.offsetTime)
    }
};
ec.product.depositActivity = function (a) {
    var b = ec.product.getSkuInfo(a);
    $("#product-recommend-all").hide();
    if ($("#product-deposit-agreement-area")) {
        $("#product-deposit-agreement-area").hide()
    }
    $("#pro-operation").css("visibility", "hidden");
    ec.product.isDespositSku = 0;
    ec.product.runningSkuId = a;
    $("#pro-operation").html("");
    new ec.ajax().get({
        url: "/product/queryDeposit.json",
        data: {sbomCode: b.code},
        timeout: 10000,
        timeoutFunction: function () {
            if (ec.product.runningSkuId != a) {
                return
            }
            ec.product.isDespositSku = 2;
            if (b && b.buttonMode == 7) {
                $("#pro-operation").css("visibility", "visible");
                return
            }
            if (b && b.buttonMode == 8) {
                ec.product.rushbuyActivity(1)
            } else {
                ec.product.depositInit(a);
                alert("\u67e5\u8be2\u9884\u4ed8\u5b9a\u91d1\u6d3b\u52a8\u4fe1\u606f\u8d85\u65f6\uff0c\u8bf7\u91cd\u65b0\u5237\u65b0\u9875\u9762\u3002")
            }
            $("#pro-price").html("\u6682\u65e0\u62a5\u4ef7");
            $("#pro-price-deposit").html("\u6682\u65e0\u62a5\u4ef7");
            $("#pro-price-label-amount").html("");
            $("#pro-price-label-amount").hide();
            $("#pro-price-amount").hide();
            $("#pro-price-amount").html("")
        },
        beforeSendFunction: ec.ui.loading.show,
        afterSendFunction: ec.ui.loading.hide,
        successFunction: function (e) {
            $("#package_dl").remove();
            _updateSelect();
            if (ec.product.runningSkuId != a) {
                return
            }
            if (e.isSuccess == "false" || (e.resultCode == 0 && e.promoActivity == null) || (e.resultCode == 0 && e.promoActivity == "")) {
                ec.product.isDespositSku = 2;
                if (b && b.buttonMode == 7) {
                    $("#pro-operation").css("visibility", "visible");
                    return
                }
                $("#pro-price").html("\u6682\u65e0\u62a5\u4ef7");
                $("#pro-price-label-deposit").html("\u8ba2\u91d1");
                $("#pro-price-label-deposit").show();
                $("#pro-price-deposit").show();
                $("#pro-price-deposit").html("\u6682\u65e0\u62a5\u4ef7");
                $("#buyProcessIDD").hide();
                $("#pro-price-label-amount").html("");
                $("#pro-price-label-amount").hide();
                $("#pro-price-amount").hide();
                $("#pro-price-amount").html("");
                if (b && b.buttonMode == 8) {
                    ec.product.rushbuyActivity(1)
                } else {
                    ec.product.depositInit(a)
                }
                return
            }
            ec.product.isDespositSku = 1;
            ec.product.depositInit(a);
            var g = e.promoActivity.depositSkuList;
            var d = "";
            if (g != "") {
                d = g[0]
            }
            if (d.isSurePrice < 1) {
                $("#pro-price").html("\u6682\u65e0\u62a5\u4ef7")
            } else {
                $("#pro-price").html("<em>&yen;</em>" + $("#pro-price-hide").val())
            }
            ec.product.depositInfo = e;
            if (e.promoActivity.description.length > 0) {
                if ($("#pro-parts-area").length > 0) {
                    $("#pro-parts-area").find("dt").text("")
                }
            }
            $("#buyProcessIDD").show();
            $("#balanceStartDateIDD").html(timestampToTime(e.deposit.balanceStartTime) + "&nbsp;~&nbsp;" + timestampToTime(e.deposit.balanceEndTime));
            if (b && b.buttonMode != 8) {
                $("#startDateIDD").html(timestampToTime(e.deposit.startTime) + "&nbsp;~&nbsp;" + timestampToTime(e.deposit.endTime))
            } else {
                $("#startDateIDD").html("\u63d0\u524d\u9501\u5b9a\u8d2d\u4e70\u8d44\u683c")
            }
            $("#pro-price-label-deposit").html("\u8ba2\u91d1");
            $("#pro-price-label-deposit").removeClass("f24").addClass("type");
            $("#pro-price-label-deposit").show();
            $("#pro-price-deposit").html("<em>&yen;</em>" + d.depositPrice.toFixed(2));
            $("#pro-price-deposit").show();
            if (d.amountPrice > 0) {
                $("#pro-price-label-amount").html("\u53ef\u62b5");
                $("#pro-price-label-amount").show();
                $("#pro-price-amount").html("<em>&yen;</em>" + d.amountPrice.toFixed(2));
                $("#pro-price-amount").show()
            } else {
                $("#pro-price-label-amount").html("");
                $("#pro-price-label-amount").hide();
                $("#pro-price-amount").hide();
                $("#pro-price-amount").html("")
            }
            if (ec.product.inventory.haveInventory(a)) {
                $("#pro-operation").html('<a href="javascript:;" class="product-button02" onclick="ec.product.payDeposit(1);">\u652f\u4ed8\u8ba2\u91d1</a>');
                $("#pro-quantity-area").show();
                $("#pro-operation").css("visibility", "visible");
                $("#product-operation").show()
            } else {
                $("#pro-operation").html('<a href="javascript:;" class="product-button02" onclick="ec.product.arrival()">\u5230\u8d27\u901a\u77e5</a>');
                $("#pro-quantity-area").show();
                $("#pro-operation").css("visibility", "visible");
                $("#product-operation").show()
            }
            ec.product.refreshStyle();
            deposit.business.setOffsetTime(new Date().getTime(), e.serverCurrentTime);
            var c = deposit.business.getSysDate();
            if (e.unStart == "unStart") {
                $("#pro-operation").html('<a href="javascript:;" class="product-button02 disabled">\u6d3b\u52a8\u5373\u5c06\u5f00\u59cb</a><div id="pro-operation-countdown" class="product-time"></div>');
                $("#pro-operation").css("visibility", "visible");
                $("#product-operation").show();
                var i = new Date(e.deposit.startTime).format("yyyy-MM-dd HH:mm:ss");
                var f = new Date(e.deposit.startTime).format("MM\u6708dd\u65e5 HH:mm");
                var c = deposit.business.getSysDate();
                ec.ui.countdown2($("#pro-operation-countdown"), {
                    html: "<p>" + f + "\u5f00\u552e:	</p><ul><li><span>{#day}</span></li><li><em>\u5929</em></li><li><span>{#hours}</span></li><li><em>:</em></li><li><span>{#minutes}</span></li><li><em>:</em></li><li><span>{#seconds}</span></li>",
                    now: c,
                    endTime: i,
                    callback: function (j) {
                        $("#pro-operation").html('<a href="javascript:;" class="product-button02" onclick="ec.product.payDeposit(1);">\u652f\u4ed8\u8ba2\u91d1</a>');
                        ec.product.gift.updateOperationBtns();
                        if (rush.business.timer) {
                            clearInterval(rush.business.timer);
                            rush.business.timer = null
                        }
                    }
                });
                rush.business.timer = $($("#pro-operation-countdown")).data("countdown");
                if (!rush.business.timer) {
                    $("#pro-operation").html('<a href="javascript:;" class="product-button02" onclick="ec.product.payDeposit(1);">\u652f\u4ed8\u8ba2\u91d1</a>');
                    if (rush.business.timer) {
                        clearInterval(rush.business.timer);
                        rush.business.timer = null
                    }
                }
                ec.product.refreshStyle()
            }
            if (e.end == "end") {
                $("#pro-operation").html('<a href="javascript:;" class="product-button02 disabled">\u6d3b\u52a8\u5df2\u7ed3\u675f</a>');
                $("#pro-operation").css("visibility", "visible");
                $("#product-operation").show();
                ec.product.refreshStyle()
            }
            if (b && b.buttonMode == 8) {
                ec.product.rushbuyActivity(2)
            } else {
                $("#goAddressId").hide()
            }
            ec.product.gift.updateOperationBtns()
        }
    })
};

function timestampToTime(b) {
    var a = new Date(b);
    Y = a.getFullYear() + ".";
    M = (a.getMonth() + 1 < 10 ? "0" + (a.getMonth() + 1) : a.getMonth() + 1) + ".";
    D = (a.getDate() < 10 ? "0" + a.getDate() : a.getDate()) + " ";
    h = (a.getHours() < 10 ? "0" + a.getHours() : a.getHours()) + ":";
    m = (a.getMinutes() < 10 ? "0" + a.getMinutes() : a.getMinutes());
    return Y + M + D + h + m
}

ec.product.showDepositAgreement = function () {
    var a = '<div class="box-agreement-area">' + ec.product.depositInfo.promoActivity.ruleText + "</div>";
    new ec.box(a, {
        boxclass: "ol_box_4 ol_box_agreement",
        title: "\u8ba2\u91d1\u652f\u4ed8\u534f\u8bae",
        width: 678,
        height: 350,
        autoHeight: false
    }).open()
};
ec.product.pushAddress = function () {
    var a = "";
    if (ec.account.isLogin()) {
        a = "0"
    } else {
        a = "1"
    }
    var b = {
        UID: ec.util.cookie.get("uid"),
        TID: getPtid(),
        TIME: getTime(),
        CONTENT: {SKUCode: $("#pro-sku-code2").text(), login: a}
    };
    ec.code.addAnalytics({hicloud: true});
    _paq.push(["trackLink", "3000020503", "link", b])
};
ec.product.payDeposit = function (a) {
    if (!$("#pro-agreement-area-check").attr("checked")) {
        var b = '<div class="box-prompt-error-area"><div class="b"><p>\u60a8\u5fc5\u987b\u5148\u52fe\u9009\u540c\u610f\u8ba2\u91d1\u652f\u4ed8\u534f\u8bae\uff0c\u624d\u53ef\u4ee5\u8fdb\u884c\u8ba2\u91d1\u652f\u4ed8\u3002</p></div></div>';
        new ec.box(b, {boxclass: "ol_box_4", title: "\u6e29\u99a8\u63d0\u793a", showCancel: false}).open();
        return
    }
    ec.account.afterLogin(function () {
        ec.binding.cart.withPhone(function () {
            dealDepositInfo(a)
        })
    })
};
dealDepositInfo = function (e) {
    var i = $("#pro-quantity").val();
    var g = ec.product.getSku() || ec.product.defaultSku;
    var j = [];
    var r = {};
    r.itemId = $("#pro-sku-code").val();
    r.qty = $("#pro-quantity").val();
    r.itemType = "S0";
    var p = ec.product.gift.finalMainSbomGiftMap[ec.product.getSku()];
    var l = ec.product.getSku();
    if ((p || ec.product.gift.packageGiftMap[l]) && e == 1) {
        var f = [];
        if (p) {
            for (var t in p) {
                var o = {sbomCode: p[t].giftSkuCode};
                f.push(o)
            }
        }
        if (ec.product.gift.packageGiftMap[l]) {
            for (var c = 0; c < ec.product.gift.packageGiftMap[l].length; c++) {
                var a = {sbomCode: ec.product.gift.packageGiftMap[l][c]};
                f.push(a)
            }
        }
        r.gifts = f
    }
    if (e == 2) {
        $('[id="comb-pro-' + g + '"]').find("input[name=skuId]:checked").each(function () {
            var u = {};
            u.itemId = $(this).attr("data-scode");
            u.qty = 1;
            u.itemType = "S0";
            j.push(u)
        })
    }
    var d = $("#extendSelect").attr("data-scode");
    var s = $("#accidentSelect").attr("data-scode");
    r.subOrderItemReqArgs = [];
    var n = {};
    var q = {};
    if (d.length > 0) {
        n.itemId = d;
        n.qty = $("#pro-quantity").val();
        n.itemType = "S1";
        n.mainSkuCode = $("#pro-sku-code").val();
        r.subOrderItemReqArgs.push(n);
        if (s.length > 0) {
            q.itemId = s;
            q.qty = $("#pro-quantity").val();
            q.itemType = "S6";
            q.mainSkuCode = $("#pro-sku-code").val();
            r.subOrderItemReqArgs.push(q)
        }
    } else {
        if (s.length > 0) {
            q.itemId = s;
            q.qty = $("#pro-quantity").val();
            q.itemType = "S6";
            q.mainSkuCode = $("#pro-sku-code").val();
            r.subOrderItemReqArgs.push(q)
        }
    }
    j.push(r);
    var b = ec.lang.json.stringify(j);
    var k = "";
    k += '<input name="orderReqJson" type="text" value=\'' + b + "'>";
    k += '<input name="state" type="text" value="0">';
    k += '<input name="CsrfToken" id="CsrfToken" type="hidden" value="' + csrftoken + '"/>';
    $("#order-confirm-deposit-form").html(k).submit()
};
ec.pkg("ec.product.coupon");
ec.load("ec.box");
ec.product.coupon = {
    sbomCouponList: {}, applyResultList: {}, loadCoupon: function (a) {
        ec.product.coupon.loadCouponEx(a, function (d) {
            if (d && d.success && d.couponList && d.couponList.length > 0) {
                ec.product.coupon.sbomCouponList[a] = d.couponList;
                $("#couponBtn").show();
                $("#couponTag").html("");
                var b = [];
                if (d.couponList.length > 3) {
                    for (var c = 0; c < d.couponList.length; c++) {
                        if (c < 3) {
                            if (d.couponList[c].couponTag != null) {
                                b.push("<span onclick=\"ec.product.coupon.clickBtn('" + a + '\')" class="product-ticket">' + d.couponList[c].couponTag + "</span>")
                            }
                        }
                        if (c >= 3) {
                            break
                        }
                    }
                } else {
                    for (var c = 0; c < d.couponList.length; c++) {
                        if (d.couponList[c].couponTag != null) {
                            b.push("<span onclick=\"ec.product.coupon.clickBtn('" + a + '\')" class="product-ticket">' + d.couponList[c].couponTag + "</span>")
                        }
                    }
                }
                b.push(' <a href="javascript:;" id="immediatelyReceiveID" class="product-ticket-link" onclick="ec.product.coupon.clickBtn(\'' + a + "')\">\u7acb\u5373\u9886\u53d6&nbsp;&gt;</a>");
                $("#couponTag").html(b.join(" "))
            } else {
                $("#couponBtn").hide()
            }
        }, function (b) {
        }, function () {
        })
    }, loadCouponEx: function (d, a, c, b) {
        new ec.ajax().get({
            url: "/product/queryCoupon.json?sbom=" + d,
            type: "get",
            timeout: 10000,
            timeoutFunction: function () {
                b()
            },
            successFunction: function (e) {
                a(e)
            },
            errorFunction: function (e) {
                c(e)
            }
        })
    }, clickBtn: function (a) {
        ec.product.coupon.showDialog(a)
    }, closeDialog: function () {
        $("#pro-roll-page").hide()
    }, showDialog: function (a) {
        $("#pro-roll-message").html("");
        $("#pro-roll-list").html("");
        $("#pro-roll-page").hide();
        var b = ec.product.coupon.sbomCouponList[a];
        if (b) {
            ec.product.coupon.showDialogEx(a, b)
        } else {
            ec.product.coupon.loadCouponEx(a, function (c) {
                if (c && c.success && c.couponList && c.couponList.length > 0) {
                    ec.product.coupon.sbomCouponList[a] = c.couponList;
                    ec.product.coupon.showDialogEx(a, c.couponList)
                } else {
                }
            }, function () {
            }, function () {
            })
        }
    }, showDialogEx: function (a, c) {
        var b = new ec.box($("#pro-roll-textarea").val(), {
            boxid: "successBox",
            boxclass: "ol_box_4 ol_box_title",
            width: 700,
            title: "\u9886\u53d6\u4f18\u60e0\u5238",
            showButton: false,
            onopen: function (d) {
                ec.product.coupon.couponBuildText(a, c);
                d.setPosition()
            },
            onclose: function (d) {
                ec.product.coupon.closeDialog()
            }
        });
        b.open()
    }, couponBuildText: function (j, g) {
        var d = [];
        for (var c = 0; c < g.length; c++) {
            paramsReceiveCoupon = "'" + g[c].activityCode + "','" + g[c].batchCode + "','" + j + "'";
            var b = g[c].activityCode + "-" + g[c].batchCode;
            var a = "";
            var h = "";
            var e = "";
            var f = "";
            if (g[c].couponType == 1 && g[c].deliveryFree == 0) {
                e = "<span>" + g[c].amount + "</span><p><strong>\u4f18\u60e0\u5238</strong></p>";
                f = "<em>&yen;</em>"
            } else {
                if (g[c].couponType == 2 && g[c].deliveryFree == 0) {
                    h = " roll-discount";
                    e = "<span>" + g[c].discount * 10 + "</span><p><b>\u6298</b></p>"
                } else {
                    h = " roll-type";
                    e = "<span>\u514d\u90ae\u5238</span>"
                }
            }
            switch (g[c].state) {
                case -1:
                    d.push('<li id="roll-detail-' + b + '" class="roll-detail receive' + h + '" title="' + g[c].batchName + '">');
                    d.push(' <a id="roll-link-' + b + '" href="javascript:;" >' + f);
                    a = "\u5df2<br>\u9886<br>\u5b8c";
                    break;
                case 1:
                    d.push('<li id="roll-detail-' + b + '" class="roll-detail' + h + '" title="' + g[c].batchName + '">');
                    d.push(' <a id="roll-link-' + b + '" href="javascript:;"  onclick="ec.product.coupon.receiveCoupon(' + paramsReceiveCoupon + ')">' + f);
                    a = "\u7acb<br>\u5373<br>\u9886<br>\u53d6";
                    break;
                case 2:
                    d.push('<li id="roll-detail-' + b + '" class="roll-detail receive' + h + '" title="' + g[c].batchName + '">');
                    d.push(' <a id="roll-link-' + b + '" href="javascript:;" >' + f);
                    a = "\u5df2<br>\u9886<br>\u53d6";
                    break;
                case 3:
                    d.push('<li id="roll-detail-' + b + '" class="roll-detail begin' + h + '" title="' + g[c].batchName + '">');
                    d.push(' <a id="roll-link-' + b + '" href="javascript:;" >' + f);
                    a = "\u5373<br>\u5c06<br>\u5f00<br>\u59cb";
                    break;
                case 4:
                    d.push('<li id="roll-detail-' + b + '" class="roll-detail disabled' + h + '" title="' + g[c].batchName + '">');
                    d.push(' <a id="roll-link-' + b + '" href="javascript:;" >' + f);
                    a = "\u5df2<br>\u7ed3<br>\u675f";
                    break;
                default:
                    d.push('<li id="roll-detail-' + b + '" class="roll-detail' + h + '" title="' + g[c].batchName + '">');
                    d.push(' <a id="roll-link-' + b + '" href="javascript:;" >' + f);
                    a = "";
                    break
            }
            d.push(' <div class="roll-info">');
            d.push('  <div class="roll-price clearfix">');
            d.push(e);
            d.push("  </div>");
            d.push(' <p class="roll-word">' + g[c].batchName + "</p>");
            d.push(' <p class="roll-time">' + new Date(g[c].beginDate).format("yyyy.MM.dd") + " - " + new Date(g[c].endDate).format("yyyy.MM.dd") + "</p>");
            d.push("</div>");
            d.push('<div id="roll-state-' + b + '" class="roll-btn">' + a + "</div>");
            d.push("</a></li>")
        }
        var d = '<ul class="clearfix">' + d.join(" ") + "</ul>";
        $("#pro-roll-list").html(d);
        if (g.length == 1) {
            $("#pro-roll-list ul li").removeClass("disabled");
            $("#pro-roll-list ul li").addClass("roll-detail-one")
        }
        $("#pro-roll-page").show()
    }, goLogin: function () {
        $(".box-cancel").click();
        var a = domainMain + encodeURIComponent(window.location.pathname + "#" + ec.product.getSku());
        ec.account.afterLogin(function () {
            $("#immediatelyReceiveID").click()
        })
    }, showMsg: function (c, b) {
        b = "" + b;
        var a = "";
        a = "<span>" + c + "</span>";
        switch (b) {
            case"9206":
                a += '<a href="javascript:;" onclick="ec.product.coupon.goLogin()" >\u9a6c\u4e0a\u767b\u5f55</a>';
                break;
            case"9208":
                a += '<a href="' + $("#accountCenterUrl").val() + '" target="_blank" >\u53bb\u7ed1\u5b9a</a>';
                break;
            case"9209":
                a += '<a href="' + $("#authUrl").val() + '" target="_blank" >\u53bb\u8ba4\u8bc1</a>';
                break;
            case"9210":
                a += '<a href="' + $("#notFinishAllUPDataURL").val() + '" target="_blank" >\u5b8c\u5584\u8d44\u6599</a>';
                break;
            default:
                a += ""
        }
        $("#pro-roll-message").html(a);
        $("#pro-roll-message").addClass("product-layer-tips")
    }, receiveCoupon: function (b, d, a) {
        var c = b + "-" + d;
        ec.product.syncCustomSession();
        $("#pro-roll-message").html("");
        $("#pro-roll-message").removeClass();
        $.ajax({
            url: openApiDomain + "/ams/coupon/receive?t=" + new Date().getTime(),
            type: "POST",
            dataType: "json",
            data: JSON.stringify({activityCode: b, batchCode: d}),
            timeout: 10000,
            beforeSend: function (e) {
                e.withCredentials = true;
                e.setRequestHeader("CsrfToken", csrftoken)
            },
            success: function (e) {
                if (e && e.state) {
                    switch (e.state) {
                        case -1:
                            $("#roll-detail-" + c).addClass("receive");
                            $("#roll-state-" + c).html("\u5df2<br>\u9886<br>\u5b8c");
                            $("#roll-link-" + c).removeAttr("onclick");
                            break;
                        case 1:
                            break;
                        case 2:
                            $("#roll-detail-" + c).addClass("receive");
                            $("#roll-state-" + c).html("\u5df2<br>\u9886<br>\u53d6");
                            $("#roll-link-" + c).removeAttr("onclick");
                            break;
                        case 3:
                            $("#roll-detail-" + c).addClass("begin");
                            $("#roll-state-" + c).html("\u5373<br>\u5c06<br>\u5f00<br>\u59cb");
                            $("#roll-link-" + c).removeAttr("onclick");
                            break;
                        case 4:
                            $("#roll-detail-" + c).addClass("disabled");
                            $("#roll-state-" + c).html("\u5df2<br>\u7ed3<br>\u675f");
                            $("#roll-link-" + c).removeAttr("onclick");
                            break;
                        default:
                            break
                    }
                }
                if (e && e.success) {
                    $("#pro-roll-message").html("<span>" + e.pcReviceSuccTip + "</span>");
                    $("#pro-roll-message").addClass("product-layer-tips product-layer-success");
                    delete ec.product.coupon.sbomCouponList[a];
                    return
                }
                if (!e.code) {
                    $("#pro-roll-message").addClass("product-layer-tips");
                    $("#pro-roll-message").html("<span>\u4eb2\uff0c\u77ac\u95f4\u88ab\u4f60\u7684\u70ed\u60c5\u5413\u5230\u4e86\uff0c\u5bb9\u6211\u7f13\u7f13\uff0c\u8bf7\u7a0d\u5019\u518d\u6765\u54e6~</span>");
                    return
                }
                ec.product.coupon.showMsg(e.errorTip, e.code)
            },
            error: function () {
                $("#pro-roll-message").addClass("product-layer-tips");
                $("#pro-roll-message").html("<span>\u4eb2\uff0c\u77ac\u95f4\u88ab\u4f60\u7684\u70ed\u60c5\u5413\u5230\u4e86\uff0c\u5bb9\u6211\u7f13\u7f13\uff0c\u8bf7\u7a0d\u5019\u518d\u6765\u54e6~</span>")
            }
        })
    }
};
